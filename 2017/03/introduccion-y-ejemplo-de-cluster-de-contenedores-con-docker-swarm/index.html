<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Las funcionalidades de Docker Swarm están incorporadas en Docker para gestionar clusters de nodos con contenedores de los servicios que deseemos. En artículo comentaré algunas de las propiedades de networkning distribuido incorporado en Docker, como crear un cluster de nodos Docker usando VirtualBox con máquinas virtuales para simular múltiples máquinas junto con como lanzar un servicio en el cluster que en este caso consistirá en un servidor web nginx. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Introducción y ejemplo de cluster de contenedores con Docker Swarm</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.3.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery-3.4.1.slim.min','bootstrap':'libs/bootstrap-4.3.1/js/bootstrap.min','bowser':'libs/bowser-2.3.0','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="blog-stack, gnu-linux, planeta-codigo, planeta-linux"><h1 itemprop=name>Introducción y ejemplo de cluster de contenedores con Docker Swarm</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2017-03-19>19/03/2017</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/gnu-linux/>gnu-linux</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/planeta-linux/>planeta-linux</a><br><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/#comments>Comentarios</a></p><p class=summary itemprop=about>Las funcionalidades de Docker Swarm están incorporadas en Docker para gestionar <em>clusters</em> de nodos con contenedores de los servicios que deseemos. En artículo comentaré algunas de las propiedades de <em>networkning</em> distribuido incorporado en Docker, como crear un <em>cluster</em> de nodos Docker usando VirtualBox con máquinas virtuales para simular múltiples máquinas junto con como lanzar un servicio en el <em>cluster</em> que en este caso consistirá en un servidor web nginx.</p><div><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=1561><div class=logotypes style=float:right><img src=assets/images/logotipos/docker.svg class=right width=200 alt=Docker title=Docker></div><p>En <a href=https://picodotdev.github.io/blog-bitix/series/docker/>artículos anteriores de la serie sobre Docker</a> comentaba varias de las herramientas de <a href=https://www.docker.com/>Docker</a> como <a href=https://docs.docker.com/compose/>Docker Compose</a>, Dockerfile o <a href=https://docs.docker.com/machine/>Docker Machine</a> con ejemplos de como usarlo en local. Una de las herramientas que me quedaba por investigar era <a href=https://docs.docker.com/swarm/>Docker Swarm</a> para crear <em>clusters</em> de nodos para contenedores Docker en un entorno de producción. A partir de la versión 1.12 de Docker se han incorporado varias características a Docker para usaar contenedores de forma distribuida y que a pesar de la complejidad subjacente que debe haber es realmente simple usarlo.</p><p>Una de las características es el <em>networking</em> que hace trasnparente la comunicación en red distribuida que se hace entre los nodos y los contenedores de esos nodos. Además permite crear redes por software para que los contenedores conectados a esas redes se comuniquen de forma privada. Otra característica interesante de Docker Swarm es que se encarga de monitorizar el estado de los servicios recreando contendores si alguno deja de funcionar. También a través del denominado <em>routing mesh</em> da igual al nodo del <em>cluster</em> por el que se acceda y da igual en que nodo esté el contenedor que Docker Swarm con esta propiedad se encargará de hacer llegar la petición al contenedor. Además, a lo que en Docker Swarm se denomina servicio se realiza balanceo de carga entre la instancias del mismo que haya en el <em>cluster</em> y al servicio se le asigna un DNS y dirección IP por el que puede ser accedido por otros servicios.</p><p>En el siguiente ejemplo para crear el <em>cluster</em> de nodos Docker usaré Docker Machine para crear las máquinas de los nodos en máquinas virtuales de <a href=https://www.virtualbox.org/>VirtualBox</a> aunque su funcionamiento es similar si usásemos la nube de <a href=http://aws.amazon.com/es/ec2/>Amazon EC2</a>, <a href=https://www.digitalocean.com/>Digital Ocean</a> u otros.</p><p>El siguiente <em>script</em> crea primeramente varios nodos cada uno en una máquina virtual, luego establece el nodo 01 como <em>manager</em> y los nodos 02 y 03 como <em>workers</em> usando un <em>token</em> para unirlos al <em>cluster</em> según su rol. Los nodos <em>manager</em> se encargan de mantener el estado del <em>cluster</em> y los que a través de ellos los comandos de los servicios deben ser lanzados, en un entorno de producción posiblemente tendríamos 3 nodos <em>manager</em> para soportar tolerancia a fallos. Finalmente, se obtiene lista los nodos del <em>cluster</em>. El comando <code>docker-machine env node-01</code> permite establecer el entorno contra el que el comando <code>docker</code> lanzará las operaciones como si de la máquina local se tratase.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1>#export MACHINE_STORAGE_PATH=&#34;/run/media/picodotdev/BMOVE ROJO/docker-machine/&#34;</span>

<span class=k>for</span> i in <span class=s2>&#34;01&#34;</span> <span class=s2>&#34;02&#34;</span> <span class=s2>&#34;03&#34;</span><span class=p>;</span> <span class=k>do</span>
    docker-machine create -d virtualbox node-<span class=nv>$i</span>
<span class=k>done</span>

<span class=nv>MANAGER_IP</span><span class=o>=</span><span class=k>$(</span>docker-machine ip node-01<span class=k>)</span>
<span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-01<span class=k>)</span>

docker swarm init --advertise-addr <span class=nv>$MANAGER_IP</span>

<span class=nv>MANAGER_TOKEN</span><span class=o>=</span><span class=k>$(</span>docker swarm join-token -q manager<span class=k>)</span>
<span class=nv>WORKER_TOKEN</span><span class=o>=</span><span class=k>$(</span>docker swarm join-token -q worker<span class=k>)</span>

<span class=k>for</span> i in <span class=s2>&#34;02&#34;</span> <span class=s2>&#34;03&#34;</span><span class=p>;</span><span class=k>do</span>
    <span class=nv>WORKER_IP</span><span class=o>=</span><span class=k>$(</span>docker-machine ip node-<span class=nv>$i</span><span class=k>)</span>
    <span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-<span class=nv>$i</span><span class=k>)</span>

    docker swarm join --token <span class=nv>$WORKER_TOKEN</span> --advertise-addr <span class=nv>$WORKER_IP</span> <span class=nv>$MANAGER_IP</span>:2377
<span class=k>done</span>

<span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-01<span class=k>)</span>

docker-machine ls
docker node ls</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/01-cluster-create.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/01-cluster-create.sh target=_blank>01-cluster-create.sh</a></div></div><p>Una vez creado los nodos es cuando podemos empezar a crear servicios en el <em>cluster</em>. Los servicios son una definición de los contenedores de Docker que queremos que el <em>cluster</em> ejecute. En el ejemplo definiré el servicio de un servidor web <a href=https://nginx.org/>nginx</a>, primeramente crearé una red por software en el <em>cluster</em> a la que los servicios pueden conectarse que en el ejemplo (aunque para este no es necesario) utilizaré para hacer una consulta DNS con la herramienta <a href=https://linux.die.net/man/1/drill>drill</a> para ver el nombre de dominio y dirección IP que asigna Docker Swarm al servicio del servidor web. Con <em>docker service create</em> se crean los servicios, algunos de los parámetros del comando son el nombre del servicio que queremos asignarle, los puertos que expone en este caso el 80 y 443 en el <em>host</em> para que sea accesible desde fuera del <em>cluster</em>, la redes a las que está conectado y finalmente la imagen del contenedor del servicio que en este caso será la versión de <a href=https://hub.docker.com/_/nginx/>nginx con Alpine para Docker</a>. Se pueden listar los servicios que contiene el <em>cluster</em> con <em>docker service ls</em> y los procesos de cada nodo donde podemos ver en que nodos se está ejecutando los contenedores con <em>docker ps</em>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1>#export MACHINE_STORAGE_PATH=&#34;/run/media/picodotdev/BMOVE ROJO/docker-machine/&#34;</span>
<span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-01<span class=k>)</span>

docker network create --driver overlay nginx
docker network ls -f <span class=s2>&#34;driver=overlay&#34;</span>

docker service create --name nginx -p <span class=m>80</span>:80 -p <span class=m>443</span>:443 --network nginx nginx:stable-alpine
sleep 1m

docker service create --name util --network nginx --mode global alpine sleep <span class=m>1000000000</span>
sleep 1m

docker service ls
docker service ps nginx
docker service ps util

<span class=nv>UTIL_CONTAINER_ID</span><span class=o>=</span><span class=k>$(</span>docker ps -q --filter <span class=nv>label</span><span class=o>=</span>com.docker.swarm.service.name<span class=o>=</span>util<span class=k>)</span>
docker <span class=nb>exec</span> -it <span class=nv>$UTIL_CONTAINER_ID</span> apk add --update drill
docker <span class=nb>exec</span> -it <span class=nv>$UTIL_CONTAINER_ID</span> drill nginx
docker service rm util

sleep 5s

<span class=k>for</span> i in <span class=s2>&#34;01&#34;</span> <span class=s2>&#34;02&#34;</span> <span class=s2>&#34;03&#34;</span><span class=p>;</span> <span class=k>do</span>
    <span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-<span class=nv>$i</span><span class=k>)</span>
    docker ps
<span class=k>done</span>

<span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-01<span class=k>)</span>

<span class=k>for</span> i in <span class=s2>&#34;01&#34;</span> <span class=s2>&#34;02&#34;</span> <span class=s2>&#34;03&#34;</span><span class=p>;</span> <span class=k>do</span>
    <span class=nv>NODE_IP</span><span class=o>=</span><span class=k>$(</span>docker-machine ip node-<span class=nv>$i</span><span class=k>)</span>
    curl http://<span class=nv>$NODE_IP</span>/
<span class=k>done</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/06-nginx-create.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/06-nginx-create.sh target=_blank>06-nginx-create.sh</a></div></div><p>Una de las propiedades interesantes del <em>networking</em> de Docker Swarm es que ofrece incorporado balanceo de carga, esto es, si el servicio de nginx del ejemplo estuviese formado por dos instancias las peticiones se distribuirían entre las instancias usando el método <em>round-robin</em>. Otra característica interesante si se observa el ejemplo con detalle es que da igual el nodo al que hagamos la petición que la respuesta se obtendrá igualmente, esto es, aunque la petición se haga al nodo 01 y realmente el contenedor del servidor nginx se esté ejecutando en el nodo 02 la petición se realizará correctamente gracias al <em>routing mesh</em> del <em>neworking</em> de Docker Swarm, esto es gracias a que cada servicio tiene asignada una dirección IP, como se ha visto anteriormente en la salida del comando <code>drill</code>.</p><p>En este vídeo de <a href=https://asciinema.org/>asciinema</a> se ve en funcionamiento todos los anteriores comandos. Y en la aplicación de VirtualBox estarán las máquinas virtuales de cada uno de los nodos que crea el ejemplo. En el vídeo se aprecia que el servicio de nginx se está ejecutando en el nodo 02 cuando se listan los procesos de Docker de cada nodo con <em>docker ps</em>, nótese sin embargo que al hacer un petición HTTP a cualquiera de los nodos se devuelve la página de inicio de nginx ya que gracias al <em>routing mesh</em> de Docker Swarm la petición se redirige de forma transparente para el cliente y el servicio al nodo donde realmente se está ejecutando el contenedor de nginx.</p><div class=media style=text-align:center><figure><script type=text/javascript src=https://asciinema.org/a/107868.js id=asciicast-107868 async></script><noscript><a href=https://asciinema.org/a/107868 target=_blank><img src=https://asciinema.org/a/107868.png width=734></a></noscript><figcaption>Introducción y ejemplo de cluster de contenedores con Docker Swarm</figcaption></figure></div><div class=media style=text-align:center><figure><a href=assets/images/posts/2017/216/maquinas-virtuales-cluster.png title="Máquinas virtuales de los nodos del _cluster_ de Docker Swarm" data-gallery><img src=assets/images/posts/2017/216/maquinas-virtuales-cluster-thumb.png></a><figcaption>Máquinas virtuales de los nodos del cluster de Docker Swarm</figcaption></figure></div><p>Los comandos para eliminar un servicio del <em>cluster</em> y eliminar completamente el <em>cluster</em> son los siguientes.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1>#export MACHINE_STORAGE_PATH=&#34;/run/media/picodotdev/BMOVE ROJO/docker-machine/&#34;</span>
<span class=nb>eval</span> <span class=k>$(</span>docker-machine env node-01<span class=k>)</span>

docker service rm nginx
docker network rm nginx
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/nginx-remove.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/nginx-remove.sh target=_blank>nginx-remove.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1>#export MACHINE_STORAGE_PATH=&#34;/run/media/picodotdev/BMOVE ROJO/docker-machine/&#34;</span>

<span class=k>for</span> i in <span class=s2>&#34;01&#34;</span> <span class=s2>&#34;02&#34;</span> <span class=s2>&#34;03&#34;</span><span class=p>;</span> <span class=k>do</span>
    docker-machine rm -f node-<span class=nv>$i</span>
<span class=k>done</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/cluster-remove.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/cluster-remove.sh target=_blank>cluster-remove.sh</a></div></div><p>Un libro que me ha gustado mucho y que recomiendo leer sobre Docker Swarm es <a href=https://amzn.to/2mIirti>The Devops 2.1 Toolkit</a> que lo explica detalladamente y todo el libro está orientado a como usarlo en un entorno de producción. Un libro más introductorio que también he leído y que está bastante bien es <a href=https://amzn.to/2mF3Xtj>Docker in Action</a>.</p><div class=media-amazon style=text-align:center><iframe style=width:120px;height:240px marginwidth=0 marginheight=0 scrolling=no frameborder=0 src="//rcm-eu.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=blobit-21&o=30&p=8&l=as4&m=amazon&f=ifr&ref=as_ss_li_til&asins=1633430235&linkId=a6c4acab72c208d29232f2e0a8edb8ee"></iframe>
<iframe style=width:120px;height:240px marginwidth=0 marginheight=0 scrolling=no frameborder=0 src="//rcm-eu.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=blobit-21&o=30&p=8&l=as4&m=amazon&f=ifr&ref=as_ss_li_til&asins=1542468914&linkId=2101ae950cfcfe9e69b6cc1210e4bf2c"></iframe></div><p>Finalmente, quizás si estás usando GNU/Linux y VirtualBox como yo al crear los nodos con el comando <code>docker-machine</code> te produzca el siguiente error (quizá se corrija en futuras versiones de Docker o VirtualBox).</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>Setting Docker configuration on the remote daemon...

This machine has been allocated an IP address, but Docker Machine could not
reach it successfully.

SSH for the machine should still work, but connecting to exposed ports, such as
the Docker daemon port (usually &lt;ip&gt;:2376), may not work properly.

You may need to add the route manually, or use another related workaround.

This could be due to a VPN, proxy, or host file configuration issue.

You also might want to clear any VirtualBox host only interfaces you are not using.
Checking connection to Docker...
Error creating machine: Error checking the host: Error checking and/or regenerating the certs: There was an error validating certificates for host &#34;192.168.99.100:2376&#34;: dial tcp 192.168.99.100:2376: i/o timeout
You can attempt to regenerate them using &#39;docker-machine regenerate-certs [name]&#39;.
Be advised that this will trigger a Docker daemon restart which might stop running containers.</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/vboxnet0-error.out target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/vboxnet0-error.out target=_blank>vboxnet0-error.out</a></div></div><p>La solución que he encontrado para que funcione es asignar una dirección IP al adaptador puente solo-anfitrión y levantar la interfaz que usa Docker para comunicarse con las máquinas virtuales previamente a crear el nodo. En <a href=https://www.archlinux.org/>Arch Linux</a> con los siguientes comandos.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
sudo ip addr add <span class=m>192</span>.168.99.1/24 dev vboxnet0
sudo ip link <span class=nb>set</span> dev vboxnet0 up</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/01-vboxnet0-configure.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/code/01-vboxnet0-configure.sh target=_blank>01-vboxnet0-configure.sh</a></div></div><p>Se puede definir un conjunto de servicios como una unidad en un archivo en <em>stacks</em> de forma similar a como es posible hacer con Docker Compose cosa que mostraré en otro artículo.</p><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/DockerSwarm>código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en <a href=https://github.com/>GitHub</a>.</p></div></article><div class="row serie"><div class=col-md-12><h3>Este artículo forma parte de la serie <strong>docker</strong>:</h3><ol class=serie-articles><li><a href=https://picodotdev.github.io/blog-bitix/2014/10/introduccion-y-caracteristicas-de-docker/>Introducción y características de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/inicio-basico-de-docker/>Inicio básico de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/como-crear-una-imagen-para-docker-usando-un-dockerfile/>Cómo crear una imagen para Docker usando un Dockerfile</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/integracion-entre-ansible-y-docker/>Integración entre Ansible y Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/aplicaciones-multicontenedor-con-docker-compose/>Aplicaciones multicontenedor con Docker Compose</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/crear-y-usar-un-repositorio-en-docker-hub/>Crear y usar un repositorio en Docker Hub</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/usar-docker-con-docker-machine-en-linux-windows-o-mac/>Usar docker con Docker Machine en Linux, Windows o Mac</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/cambiar-la-ruta-raiz-del-entorno-de-docker/>Cambiar la ruta raíz del entorno de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/>Introducción y ejemplo de cluster de contenedores con Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/iniciar-un-stack-de-servicios-en-un-cluster-de-docker-swarm/>Iniciar un stack de servicios en un cluster de Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/escalar-y-actualizar-un-servicio-de-un-cluster-de-docker-swarm/>Escalar y actualizar un servicio de un cluster de Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/contenedores-en-docker-swarm-con-volumenes-de-datos-persistentes-usando-rex-ray-y-virtualbox/>Contenedores en Docker Swarm con volúmenes de datos persistentes usando REX-Ray y VirtualBox</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/informacion-sensible-en-los-contenedores-con-docker-secrets/>Información sensible en los contenedores con Docker Secrets</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/imagenes-de-docker-con-alpine-linux/>Imágenes de Docker con Alpine Linux</a></li></ol></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/03\/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/03\/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
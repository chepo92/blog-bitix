<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Nunca hasta ahora había tenido necesidad de crear un programa que no estuviese completamente escrito en el lenguaje Java. La API de Java ofrece multitud de clases para cualquier funcionalidad que necesitemos desde estructuras de datos hasta algoritmos de búsqueda o criptografía. También porque el rendimiento de un programa en Java es suficiente y similar a un programa equivalente escrito en C o C&#43;&#43; gracias a las optimizaciones que implementa la máquina virtual de Java o JVM aún siendo los programas Java compilados a una representación intermedia de bytecode independiente de la arquitectura de procesador y sistema operativo en archivos de extensión class y posteriormente interpretados y traducidos a la arquitectura de ejecución, lo que le proporciona a Java la conocida frase &ldquo;Write once, run anywhere&rdquo;. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Ejemplo de JNI, usar código en C desde Java</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,700italic,700,400italic"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.2.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery.slim.min','bootstrap':'libs/bootstrap-4.2.1/js/bootstrap.min','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class="col-12 col-lg-8"><div class=row><div class=col-12><article itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="blog-stack, gnu-linux, java, planeta-codigo, planeta-linux, programacion"><h1 itemprop=name>Ejemplo de JNI, usar código en C desde Java</h1><p class=information>Escrito por
<span itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2017-03-25>25/03/2017</time>, actualizado el <time itemprop=dateModified datetime=2017-03-25>25/03/2017</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/gnu-linux/>gnu-linux</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/planeta-linux/>planeta-linux</a> <a href=tags/programacion/>programacion</a><br><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/#comments>Comentarios</a></p><p class=summary itemprop=about>Para tareas muy específicas que requieran alto rendimiento, baja latencia, tiempo real o haya restricciones de tiempo el lenguaje Java y la JVM pueden mostrar algunas limitaciones obligando a escribir alguna sección crítica de un programa en un lenguaje nativo como C o C++. Para hacer posible la integración entre Java y C existe en Java la API JNI. En este artículo mostraré como realizar un programa Java que emite el mensaje Hola Mundo desde una biblioteca compartida en C y usando JNI.</p><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div class=content itemprop=articleBody><meta itemprop=wordCount content=1254><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/gnu.svg class=right width=200 alt=SVG title=SVG></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/linux.svg class=right width=200 alt=Linux title=Linux></div><p>Nunca hasta ahora había tenido necesidad de crear un programa que no estuviese completamente escrito en el lenguaje Java. La <a href=https://docs.oracle.com/javase/8/docs/api/>API de Java</a> ofrece multitud de clases para cualquier funcionalidad que necesitemos desde estructuras de datos hasta algoritmos de búsqueda o criptografía. También porque el rendimiento de un programa en Java es suficiente y similar a un programa equivalente escrito en C o C++ gracias a las optimizaciones que implementa la máquina virtual de Java o <abbr title="Java Virtual Machine">JVM</abbr> aún siendo los programas Java compilados a una representación intermedia de <em>bytecode</em> independiente de la arquitectura de procesador y sistema operativo en archivos de extensión <em>class</em> y posteriormente interpretados y traducidos a la arquitectura de ejecución, lo que le proporciona a Java la conocida frase <em>&ldquo;Write once, run anywhere&rdquo;</em>.</p><p>Sin embargo, en casos que se necesita un alto rendimiento para tareas muy específicas o evitar las imposiciones de la máquina virtual como las paradas que realiza para el recolector de basura una solución es escribir esa funcionalidad crítica en lenguaje C, C++ e incluso en <a href=https://golang.org/>Go</a>. El caso de necesidad que me he encontrado es acceder a un sensor de temperatura DHT11 del <a href=https://picodotdev.github.io/blog-bitix/2017/02/desempaquetado-del-kit-de-iniciacion-a-la-electronica-para-la-raspberry-pi/>kit de iniciación a la electrónica para la Raspberry Pi</a> para leer de él la temperatura y humedad. La forma que tiene el sensor DHT11 de proporcionar los datos tiene restricciones de tiempo, cuando se le requieren los valores envía 80 bits de datos donde un pulso de 27μs significa un 0 y un pulso de más de ese tiempo hasta 70μs significa un 1. Estas restricciones de tiempo del sensor y el hecho de que es en una modesta en potencia <a href=https://www.raspberrypi.org/>Raspberry Pi</a> 1 donde lo usaré hace que Java no sea capaz de leer correctamente los valores del sensor.</p><p>Acceder desde Java a código nativo en C requiere usar <a href=https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html>Java Native Interface o por sus siglas JNI</a>. Lo primero que hay que realizar es crear una clase que declare los métodos que serán implementados de forma nativa declarando estos métodos usando la palabra reservada <em>native</em> y que serán enlazados por la JVM cargando una librería compartida con <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#loadLibrary-java.lang.String->System.loadLibrary()</a>. Creada la clase Java se ha de generar el archivo de cabecera <em>.h</em> propia del lenguaje C con el programa de utilidad del JDK <em>javah</em>. Con el archivo de cabecera se implementa la función y se crea una librería compartida en <a href=https://www.gnu.org/>GNU</a>/<a href=https://www.linux.com/>Linux</a> usando el <a href=https://gcc.gnu.org/>compilador gcc</a>. Con la librería compartida se puede iniciar el programa Java. Si la biblioteca compartida no se encuentra se lanzará una excepción del tipo <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/UnsatisfiedLinkError.html>UnsatisfiedLinkError</a>.</p><div class=media style=text-align:center><figure><a href=assets/images/posts/2017/217/UnsatisfiedLinkError.png title="Excepción UnsatisfiedLinkError cuando no se encuentra la librería de código nativo" data-gallery><img src=assets/images/posts/2017/217/UnsatisfiedLinkError-thumb.png></a><figcaption>Excepción UnsatisfiedLinkError cuando no se encuentra la librería de código nativo</figcaption></figure></div><p>Algunas otras necesidades para hacer uso de JNI son:</p><ul><li>Acceder a características dependientes de la plataforma necesitadas por la aplicación que no están soportadas en la librería estándar de Java.</li><li>Ya hay una librería escrita en otro lenguaje y se quiere hacer accesible a código Java a través de JNI.</li><li>Se quiere implementar una pequeña parte de código crítico en un lenguaje de bajo nivel como ensamblador.</li></ul><p>Desde los métodos de código nativo se puede:</p><ul><li>Crear, inspeccionar y actualizar objetos Java (incluyendo arrays y strings).</li><li>Llamar a métodos Java.</li><li>Capturar y lanzar excepciones.</li><li>Cargar y obtener información de clases.</li><li>Realizar validación de tipos en tiempo de ejecución.</li></ul><p>Los comandos para generar el archivo de cabecera de C y compilarlo con el código nativo en una librería compartida con gcc son:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ javah -d src/main/c -classpath buil/classes/main io.github.picodotdev.blogbitix.javaraspberrypi.JniHelloWorld
$ gcc -I<span class=s2>&#34;/usr/lib/jvm/java-8-openjdk/include&#34;</span> -I<span class=s2>&#34;/usr/lib/jvm/java-8-openjdk/include/linux&#34;</span> -shared -fPIC -L/usr/lib -o src/main/resources/libjnihelloworld-amd64.so src/main/c/JniHelloWorld.c</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/build.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/build.sh target=_blank>build.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;java&#39;</span>
<span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;idea&#39;</span>

<span class=n>sourceCompatibility</span> <span class=o>=</span> <span class=mf>1.8</span>
<span class=n>targetCompatibility</span> <span class=o>=</span> <span class=mf>1.8</span>

<span class=n>repositories</span> <span class=o>{</span>
    <span class=n>mavenCentral</span><span class=o>()</span>
<span class=o>}</span>

<span class=o>...</span>

<span class=n>task</span> <span class=nf>javah1</span><span class=o>(</span><span class=nl>type:</span><span class=n>Exec</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>commandLine</span> <span class=s2>&#34;javah&#34;</span><span class=o>,</span> <span class=s2>&#34;-d&#34;</span><span class=o>,</span> <span class=s2>&#34;src/main/c&#34;</span><span class=o>,</span> <span class=s2>&#34;-classpath&#34;</span><span class=o>,</span> <span class=n>sourceSets</span><span class=o>.</span><span class=na>main</span><span class=o>.</span><span class=na>output</span><span class=o>.</span><span class=na>classesDir</span><span class=o>,</span> <span class=s2>&#34;io.github.picodotdev.blogbitix.javaraspberrypi.JniHelloWorld&#34;</span>
<span class=o>}</span>

<span class=o>...</span>

<span class=n>task</span> <span class=nf>javah</span><span class=o>(</span><span class=nl>dependsOn:</span> <span class=o>[</span><span class=s1>&#39;javah1&#39;</span><span class=o>,</span> <span class=s1>&#39;javah2&#39;</span><span class=o>]){</span>
<span class=o>}</span>

<span class=n>task</span> <span class=nf>gcc1</span><span class=o>(</span><span class=nl>type:</span><span class=n>Exec</span><span class=o>,</span> <span class=nl>dependsOn:</span> <span class=s1>&#39;javah&#39;</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>commandLine</span> <span class=s2>&#34;gcc&#34;</span><span class=o>,</span> <span class=s2>&#34;-shared&#34;</span><span class=o>,</span> <span class=s2>&#34;-fPIC&#34;</span><span class=o>,</span> <span class=s2>&#34;-I/usr/lib/jvm/java-8-openjdk/include&#34;</span><span class=o>,</span> <span class=s2>&#34;-I/usr/lib/jvm/java-8-openjdk/include/linux&#34;</span><span class=o>,</span> <span class=s2>&#34;-o&#34;</span><span class=o>,</span> <span class=s2>&#34;src/main/resources/libjnihelloworld-amd64.so&#34;</span><span class=o>,</span> <span class=s2>&#34;src/main/c/JniHelloWorld.c&#34;</span>
<span class=o>}</span>

<span class=n>task</span> <span class=nf>gcc</span><span class=o>(</span><span class=nl>dependsOn:</span> <span class=o>[</span><span class=s1>&#39;gcc1&#39;</span><span class=o>]){</span>
<span class=o>}</span>

<span class=o>...</span>

<span class=n>task</span> <span class=nf>executeJniHelloWorldLocal</span><span class=o>(</span><span class=nl>type:</span> <span class=n>JavaExec</span><span class=o>,</span> <span class=nl>dependsOn:</span> <span class=o>[</span><span class=s1>&#39;build&#39;</span><span class=o>,</span> <span class=s1>&#39;gcc&#39;</span><span class=o>])</span> <span class=o>{</span>
    <span class=n>main</span> <span class=o>=</span> <span class=s1>&#39;io.github.picodotdev.blogbitix.javaraspberrypi.JniHelloWorld&#39;</span>
    <span class=n>classpath</span> <span class=o>=</span> <span class=n>sourceSets</span><span class=o>.</span><span class=na>main</span><span class=o>.</span><span class=na>runtimeClasspath</span>
<span class=o>}</span>

<span class=o>...</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/build.gradle target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/build.gradle target=_blank>build.gradle</a></div></div><p>La cabecera usa varias definiciones de tipos definidas en los archivos <em>jni.h</em> y el archivo que variará según el sistema operativo <em>jni_md.h</em>. En la <a href=http://xdprof.sourceforge.net/doxygen/structJNIEnv__.html>estructura JNIEnv</a> con múltiples funciones de integración en C y Java, también varias definiciones de los tipos Java para usarlos en C como <em>jobject</em>, <em>jstring</em>, <em>jint</em>, <em>jboolean</em>, <em>jlong</em>, <em>jdouble</em>, <em>jchar</em>, etc.</p><p>El programa que emite el mensaje <em>Hello World!</em> desde código nativo en C debe cargar y enlazar la librería de código nativo con el código de la clase Java. Esto se muestra en el bloque de inicialización <em>static</em> de la clase, en este caso usándo el método <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#load-java.lang.String->System.load()</a>, la librería de código nativo de extensión <em>.so</em> en GNU/Linux como en este caso al construirse el proyecto se incluye en el archivo <em>.jar</em> del artefacto resultante se extráe al directorio temporal y se carga desde esa ubicación temporal. En el programa se llama al método <em>print</em> implementado en código nativo y en el código C se usa la función <em>printf</em> de la librería <em>stdio</em> para emitir el mensaje:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaraspberrypi</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.File</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStream</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.Files</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.Path</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.StandardCopyOption</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>JniHelloWorld</span> <span class=o>{</span>

    <span class=kd>static</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>architecture</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;os.arch&#34;</span><span class=o>);</span>
        <span class=n>String</span> <span class=n>library</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;/libjnihelloworld-%s.so&#34;</span><span class=o>,</span> <span class=n>architecture</span><span class=o>);</span>
        <span class=k>try</span> <span class=o>(</span><span class=n>InputStream</span> <span class=n>is</span> <span class=o>=</span> <span class=n>JniHelloWorld</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getResourceAsStream</span><span class=o>(</span><span class=n>library</span><span class=o>))</span> <span class=o>{</span>
            <span class=n>Path</span> <span class=n>path</span> <span class=o>=</span> <span class=n>File</span><span class=o>.</span><span class=na>createTempFile</span><span class=o>(</span><span class=s>&#34;libjnihelloworld&#34;</span><span class=o>,</span> <span class=s>&#34;so&#34;</span><span class=o>).</span><span class=na>toPath</span><span class=o>();</span>
            <span class=n>Files</span><span class=o>.</span><span class=na>copy</span><span class=o>(</span><span class=n>is</span><span class=o>,</span> <span class=n>path</span><span class=o>,</span> <span class=n>StandardCopyOption</span><span class=o>.</span><span class=na>REPLACE_EXISTING</span><span class=o>);</span>
            <span class=n>System</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>path</span><span class=o>.</span><span class=na>toAbsolutePath</span><span class=o>().</span><span class=na>toString</span><span class=o>());</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kd>native</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>();</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>new</span> <span class=n>JniHelloWorld</span><span class=o>().</span><span class=na>print</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.java target=_blank>JniHelloWorld.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&#34;io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld.h&#34;</span><span class=cp>
</span><span class=cp></span>
<span class=n>JNIEXPORT</span> <span class=kt>void</span> <span class=n>JNICALL</span> <span class=nf>Java_io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld_print</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Hello World!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=k>return</span><span class=p>;</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.c target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.c target=_blank>JniHelloWorld.c</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=cm>/* DO NOT EDIT THIS FILE - it is machine generated */</span>
<span class=cp>#include</span> <span class=cpf>&lt;jni.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=cm>/* Header for class io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld */</span>

<span class=cp>#ifndef _Included_io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld
</span><span class=cp>#define _Included_io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld
</span><span class=cp>#ifdef __cplusplus
</span><span class=cp></span><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=p>{</span>
<span class=cp>#endif
</span><span class=cp></span><span class=cm>/*
</span><span class=cm> * Class:     io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld
</span><span class=cm> * Method:    print
</span><span class=cm> * Signature: ()V
</span><span class=cm> */</span>
<span class=n>JNIEXPORT</span> <span class=kt>void</span> <span class=n>JNICALL</span> <span class=n>Java_io_github_picodotdev_blogbitix_javaraspberrypi_JniHelloWorld_print</span>
  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>);</span>

<span class=cp>#ifdef __cplusplus
</span><span class=cp></span><span class=p>}</span>
<span class=cp>#endif
</span><span class=cp>#endif
</span><span class=cp></span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.h target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/JniHelloWorld.h target=_blank>JniHelloWorld.h</a></div></div><p>La librería compartida para un sistema <em>amd64</em> la he compilado en mi equipo de escritorio y para la versión <em>arm</em> en la Raspberry Pi e incluido en el directorio <em>src/main/resources</em> de código fuente del ejemplo.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ ./gradlew build
$ java -classpath build/classes/main:build/resources/main io.github.picodotdev.blogbitix.javaraspberrypi.JniHelloWorld
$ ssh -t <span class=m>192</span>.168.1.101 <span class=s1>&#39;cd /home/raspberrypi/scripts/javaraspberrypi &amp;&amp; java -classpath &#34;*&#34; io.github.picodotdev.blogbitix.javaraspberrypi.JniHelloWorld&#39;</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/execute.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/code/execute.sh target=_blank>execute.sh</a></div></div><div class=media style=text-align:center><figure><a href=assets/images/posts/2017/217/JniHelloWorld-amd64.png title="Mensaje en la terminal emitido desde código nativo (amd64)" data-gallery><img src=assets/images/posts/2017/217/JniHelloWorld-amd64-thumb.png></a>
<a href=assets/images/posts/2017/217/JniHelloWorld-arm.png title="Mensaje en la terminal emitido desde código nativo (ARM)" data-gallery><img src=assets/images/posts/2017/217/JniHelloWorld-arm-thumb.png></a><figcaption>Mensaje en la terminal emitido desde código nativo en un sistema amd64 y ARM</figcaption></figure></div><p>Ente ejemplo usa Java 8 y requiere instalar el compilador gcc para compilar la librería con código nativo. <a href=https://gradle.org/>Gradle</a> ofrece soporte para <a href=https://docs.gradle.org/3.4.1/userguide/native_software.html>compilar código nativo con su plugin</a>, sin embargo, he preferido usar y conocer los comandos javah y gcc sin usar Gradle. En el siguiente artículo mostraré el ejemplo del sensor DHT11 usando JNI y código nativo en C llamando a métodos de un objeto Java desde código C.</p><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/JavaRaspberryPi>código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en <a href=https://github.com/>GitHub</a> y probarlo en tu equipo ejecutando el comando <code>./gradlew executeJniHelloWorldLocal</code>.</p><div class=reference>Referencia:<br><ul><li><a href=https://blog.dogan.io/2015/08/15/java-jni-jnr-go/>GO: Call me maybe, Java!</a></li><li><a href=https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html>Java Native Interface Specification</a></li><li><a href=http://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html>Java Programming Tutorial, Java Native Interface (JNI)</a></li></ul></div></div></article></div></div><div class="row serie"><div class=col-md-12><h3>Este artículo forma parte de la serie <strong>electronica</strong>:</h3><ol class=serie-articles><li><a href=https://picodotdev.github.io/blog-bitix/2017/02/desempaquetado-del-kit-de-iniciacion-a-la-electronica-para-la-raspberry-pi/>Desempaquetado del kit de iniciación a la electrónica para la Raspberry Pi</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/ejemplo-hello-world-con-java-en-la-raspberry-pi/>Ejemplo Hello World con Java en la Raspberry Pi</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/ejemplo-encender-y-apagar-diodo-led-con-la-raspberry-pi-en-java/>Ejemplo encender y apagar diodo LED con la Raspberry Pi en Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/controlar-un-display-lcd-1602-para-mostrar-texto-con-la-raspberry-pi-y-java/>Controlar un display LCD 1602 para mostrar texto con la Raspberry Pi y Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/ejemplo-de-jni-usar-codigo-en-c-desde-java/>Ejemplo de JNI, usar código en C desde Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/obtener-la-temperatura-y-humedad-con-el-sensor-dht11-la-raspberry-pi-c-y-java/>Obtener la temperatura y humedad con el sensor DHT11, la Raspberry Pi, C y Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/como-usar-un-diodo-led-un-pulsador-y-un-zumbador-con-la-raspberry-pi-y-java/>Cómo usar un diodo LED, un pulsador y un zumbador con la Raspberry Pi y Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/ejemplo-sensor-de-golpes-y-detector-de-movimiento-en-la-raspberry-pi-con-java/>Ejemplo sensor de golpes y detector de movimiento en la Raspberry Pi con Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/05/controlar-un-servomotor-con-la-raspberry-pi-y-java/>Controlar un servomotor con la Raspberry Pi y Java</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/05/luces-navidenas-con-la-raspberry-pi-y-java/>Luces navideñas con la Raspberry Pi y Java</a></li></ol></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/03\/ejemplo-de-jni-usar-codigo-en-c-desde-java\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/03\/ejemplo-de-jni-usar-codigo-en-c-desde-java\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div><div class="col-12 col-lg-4"><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class="row text-center banner"><div class=col-12><a href=https://picodotdev.github.io/blog-bitix/2015/12/yo-apoyo-al-software-libre-tu-tambien/><img src=assets/images/i-support-fs_red-bg-es.png alt="Yo apoyo al software libre"></a></div></div><div class=row><div class=col-md-12><hr></div></div><div class=row><div class=col-md-12><ul class="list-unstyled recents"><li><span class="glyphicon glyphicon-hand-right"></span><a href=archive/>Más artículos recientes en el archivo</a></li></ul></div></div></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
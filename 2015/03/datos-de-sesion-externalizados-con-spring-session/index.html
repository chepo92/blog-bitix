<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=pico.dev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Por defecto los datos de la sesión de una aplicación web Java se guardan en el servidor de aplicaciones y en memoria, esto produce que al reiniciar el servidor por un despliegue los datos de la sesión se pierdan y provoque en los usuarios alguna molestia como tener que volver a iniciar sesión. En Tomcat existe la posibilidad de que los datos de las sesiones sean persistidas en disco con la opción saveOnRestart del elemento de configuración Manager que evita que los datos de las sesiones se pierdan en los reinicios, al menos para los servicios formados por una única instancia. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Datos de sesión externalizados con Spring Session</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet href="//fonts.googleapis.com/css?family=PT+Serif:400,700italic,700,400italic"><link rel=stylesheet href=assets/libs/bootstrap-4.0.0/css/bootstrap.min.css><link rel=stylesheet href=assets/libs/Gallery-2.30.0/css/blueimp-gallery.min.css><link rel=stylesheet href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js async></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script async>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script src=assets/libs/require.js></script><script src=assets/js/main.js></script><script src=assets/js/theme.js async></script><script src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" async></script><script src=assets/js/app.js async></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://plus.google.com/114317443908384387611/ title="¡Sigue a Blog Bitix en Google&#43;!"><img src=assets/images/google-plus.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary">Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class="col-12 col-lg-8"><div class=row><div class=col-12><article itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="blog-stack, java, planeta-codigo, programacion"><h1 itemprop=name>Datos de sesión externalizados con Spring Session</h1><p class=information>Escrito por <span itemscope itemtype=http://schema.org/Person><span itemprop=name>pico.dev</span></span> el <time itemprop=datePublished datetime=2015-03-07>07/03/2015</time>, actualizado el <time itemprop=dateModified datetime=2015-03-08>08/03/2015</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/programacion/>programacion</a><br><a href=/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/#comments>Comentarios</a></p><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div class=content itemprop=articleBody><meta itemprop=wordCount content=987><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>Por defecto los datos de la sesión de una aplicación web Java se guardan en el servidor de aplicaciones y en memoria, esto produce que al reiniciar el servidor por un despliegue los datos de la sesión se pierdan y provoque en los usuarios alguna molestia como tener que volver a iniciar sesión. En <a href=https://tomcat.apache.org/>Tomcat</a> existe la posibilidad de que los datos de las sesiones sean persistidas en disco con la opción <em>saveOnRestart</em> del <a href=http://tomcat.apache.org/tomcat-8.0-doc/config/manager.html>elemento de configuración <em>Manager</em></a> que evita que los datos de las sesiones se pierdan en los reinicios, al menos para los servicios formados por una única instancia. Para evitar que los usuarios perciban los reinicios o caídas del servidor hay varias soluciones algunas tratando de diferentes formas externalizar las sesiones del servidor de aplicaciones. Con estas soluciones se pueden hacer despliegues sin caídas, sin que las perciban los usuarios, siendo útil para hacer actualizaciones frecuentemente, continuos, y en cualquier momento cuando tengamos una nueva versión de la aplicación.<p>Las soluciones más comentadas son:<ul><li><em>Cluster</em> de servidores: para evitar las caídas podemos formar un <em>cluster</em> de máquinas de forma que si una se reinicia las peticiones sean atendidas por el resto de servidores del <em>cluster</em>. Añadiendo una poca configuración se puede formar un <a href=http://tomcat.apache.org/tomcat-8.0-doc/cluster-howto.html><em>cluster</em> de servidores Tomcat</a>. Si el <em>cluster</em> está formado por unos pocos servidores esta solución es válida pero si el <em>cluster</em> es grande (¿media docena de máquinas?) el tráfico que se genera para sincronizar los datos de sesión en todas las máquinas puede ser significativo, momento en el cual se opta por otras soluciones.<li>Sesión en base de datos relacional: los datos de la sesión se pueden guardar en una base de datos relacional, al llegar una petición al servidor se recupera de la base de datos la sesión con una consulta y al finalizar la petición se lanza otra consulta de actualización. En las aplicaciones la base de datos suele ser un cuello de botella prefiriéndose guardar la sesión en otro servidor que no sea el servidor de base de datos para no generarle más carga.<li>Caché externa: en esta opción los datos se guardan en un servidor externo al servidor de aplicaciones de forma que todos los servidores del <em>cluster</em> las compartan pero no en la base de datos relacional, algunas opciones que se pueden utilizar son <a href=https://memcached.org/>memcached</a> o <a href=https://redis.io/>redis</a> que almacenan los datos en memoria y son muy rápidas. Esta opción añade una pieza más a la infraestructura de la aplicación que hay que mantener. En este artículo pondré un ejemplo usando esta opción utilizando Spring Session y un servidor Redis.<li>Sesión en <em>cookie</em>: para no añadir una pieza más a la infraestructura del servidor se puede externalizar la sesión en el cliente mediante una <em>cookie</em>. Como la <em>cookie</em> es enviada por el navegador cliente en cada petición el servidor puede recuperar los datos de la sesión. Sin embargo, como los datos son guardados en el cliente los datos de la <em>cookie</em> han de ser cifrados y firmados digitalmente para evitar problemas de seguridad ante modificaciones de los datos. También deberemos evitar guardar muchos datos y tendremos cierta limitación para que la <em>cookie</em> no sea grande, el tamaño recomendado no exceder es 4096 bytes si lo hacemos puede que ocasionemos errores con el mensaje <em>400 bad request, request header or cookie too large</em> y consuma mucho ancho de banda, hay que tener en cuenta que las <em>cookies</em> son enviadas en cada petición al servidor origen no solo para las peticiones dinámicas sino también para los recursos estáticos como imágenes u hojas de estilos, si las <em>cookies</em> son grandes y el número de usuarios también el ancho de banda consumido por las <em>cookies</em> puede ser significativo, en estos últimos casos <a href=https://picodotdev.github.io/blog-bitix/2014/07/servir-recursos-estaticos-desde-un-cdn-en-apache-tapestry/>empleando un CDN</a> puede aliviarse el tráfico generado. En la siguiente página podemos encontrar los <a href=http://browsercookielimits.squawky.net/>límites de las cookies para cada navegador y el número máximo por dominio</a>.</ul><p>Usando <a href=https://projects.spring.io/spring-session/>Spring Session</a> podemos externalizar los datos de la sesión en un servidor Redis usándolo como caché externa. Para demostrar y enseñar el código necesario he creado una pequeña aplicación web con <a href=https://projects.spring.io/spring-framework/>Spring MCV</a>. El controlador no tiene nada especial, obtiene la sesión y guarda los datos que necesita. Usando la anotación <em>@EnableRedisHttpSession</em> activamos la infraestructura necesaria en el contenedor de Spring para guardar los datos de la sesión en Redis. Por supuesto deberemos añadir las dependencias que necesitemos en la herramienta de construcción que usemos.</p><script type=application/javascript src="//gist.github.com/picodotdev/69e8c57980f6c9d0f1b8.js?file=SessionController.java"></script><script type=application/javascript src="//gist.github.com/picodotdev/69e8c57980f6c9d0f1b8.js?file=Initializer.java"></script><script type=application/javascript src="//gist.github.com/picodotdev/69e8c57980f6c9d0f1b8.js?file=Config.java"></script><p>Descargado el <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/SpringSession>código fuente de la aplicación de ejemplo</a> se puede iniciar con:</p><script type=application/javascript src="//gist.github.com/picodotdev/69e8c57980f6c9d0f1b8.js?file=gradlew.sh"></script><p>Lanzando una petición se puede ver como el Redis se guardan los datos de la sesión. Podemos detener el servidor y volverlo a iniciar y comprobaremos que los datos de la sesión no se han perdido al estar persistidos en redis.<div class=media style=text-align:center><figure><a href=assets/images/posts/2015/70/dato-en-sesion.png title="Dato en sesión" data-gallery><img src=assets/images/posts/2015/70/dato-en-sesion-thumb.png></a>
<a href=assets/images/posts/2015/70/cookie-navegador.png title="Cookie de sesión en el navegador" data-gallery><img src=assets/images/posts/2015/70/cookie-navegador-thumb.png></a><figcaption></figcaption></figure></div><p>Examinando los datos en redis podemos ver que se ha creado una clave con el mismo identificativo de la cookie <em>SESSION</em>, en la clave están guardados los valores serializados entre ellos el nombre del atributo y su valor y otros datos como la fecha de creación, el último acceso y el intervalo máximo de inactividad antes de la expiración.<div class=media style=text-align:center><figure><a href=assets/images/posts/2015/70/contenido-sesion-redis.png title="Contenido sesión en redis" data-gallery><img src=assets/images/posts/2015/70/contenido-sesion-redis-thumb.png></a><figcaption></figcaption></figure></div><p>En el momento de escribir este artículo Spring Session es un proyecto reciente y solo soporta la opción de Redis como caché externa pero seguramente con nuevas versiones soporte otras opciones como memcached, guardar la sesión en una <em>cookie</em> o en una base de datos relacional. La solución propuesta por Spring Session es válida para cualquier servidor de aplicaciones ya que se basa en crear un filtro en la aplicación que proporciona una versión modificada de <a href=http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html>HttpSession</a> mediante el cual se guardan los datos de forma externa.<p>Otras posibilidades ofrecidas por Spring Session son múltiples sesiones en la misma instancia del navegador y soporte para aplicaciones RESTful y WebSocket.<p>Otra posibilidad similar es usar memcached mediante la librería <a href=https://code.google.com/p/memcached-session-manager/>memcached-session-manager</a> aunque es una solución específica para Tomcat.<div class=reference>Referencia:<br><ul><li><a href=https://projects.spring.io/spring-session/>Spring Session</a><li><a href=http://blog.shinetech.com/2012/12/18/simple-session-sharing-in-tomcat-cluster-using-the-session-in-cookie-pattern/>Simple Session-Sharing in Tomcat Cluster Using the Session-in-Cookie</a><li><a href=http://tomcat.apache.org/tomcat-8.0-doc/cluster-howto.html>Tomcat Cluster</a><li><a href=https://code.google.com/p/memcached-session-manager/>Memcached Session Manager</a></ul></div></div></article></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/03\/datos-de-sesion-externalizados-con-spring-session\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/03\/datos-de-sesion-externalizados-con-spring-session\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div><div class="col-12 col-lg-4"><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class="row text-center banner"><div class=col-12><a href=https://picodotdev.github.io/blog-bitix/2015/12/yo-apoyo-al-software-libre-tu-tambien/><img src=//static.fsf.org/nosvn/images/badges/badges_es/i-support-fs_red-bg-es.png alt="Yo apoyo al software libre"></a></div></div><div class=row><div class=col-md-12><hr></div></div><div class=row><div class=col-md-12><ul class="list-unstyled recents"><li><span class="glyphicon glyphicon-hand-right"></span><a href=archive/>Más artículos recientes en el archivo</a></ul></div></div></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.<p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a><li><a href=/blog-bitix/tags/javascript/>JavaScript</a><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a><li><a href=/blog-bitix/pages/links/>Enlaces</a><li><a href=/blog-bitix/pages/advertising/>Publicidad</a><li><a href=/blog-bitix/pages/donate/>Donaciones</a><li><a href=/blog-bitix/pages/about/>Acerca de...</a></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://plus.google.com/114317443908384387611/ title="¡Sigue a Blog Bitix en Google&#43;!"><img src=assets/images/google-plus.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2018 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Los class loaders del servidor de aplicaciones JBoss/WildFly habitualmente han dado algún problema en la ejecución de las aplicaciones y la carga de clases. En versiones antiguas como la 4 se podían producir conflictos entre las librerías de las aplicaciones y las librerías instaladas en el servidor ya que en JBoss se buscaba las clases por defecto y primero en el class loader del servidor en vez de en el classloader de la aplicación (war). &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Ejecutar Apache Tapestry en el servidor de aplicaciones WildFly</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.2.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery.slim.min','bootstrap':'libs/bootstrap-4.2.1/js/bootstrap.min','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="software, java, programacion, tapestry, planeta-codigo, blog-stack"><h1 itemprop=name>Ejecutar Apache Tapestry en el servidor de aplicaciones WildFly</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2014-06-06>06/06/2014</time>, actualizado el <time itemprop=dateModified datetime=2015-05-27>27/05/2015</time>.<br><a href=tags/software/>software</a> <a href=tags/java/>java</a> <a href=tags/programacion/>programacion</a> <a href=tags/tapestry/>tapestry</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/blog-stack/>blog-stack</a><br><a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/#comments>Comentarios</a></p><div class=text-center><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=1010><div class=logotypes style=float:right><img src=assets/images/logotipos/apache-tapestry-5.svg class=right width=400 alt="Apache Tapestry" title="Apache Tapestry"></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/wildfly.png class=right alt=WildFly title=WildFly></div><p>Los class loaders del <a href=https://picodotdev.github.io/blog-bitix/2014/02/servidor-de-aplicaciones-jboss-slash-wildfly/>servidor de aplicaciones JBoss/WildFly</a> habitualmente han dado algún problema en la ejecución de las aplicaciones y la carga de clases. En versiones antiguas como la 4 se podían producir conflictos entre las librerías de las aplicaciones y las librerías instaladas en el servidor ya que en <a href=http://jbossas.jboss.org/>JBoss</a> se buscaba las clases por defecto y primero en el class loader del servidor en vez de en el classloader de la aplicación (war). Ya en las últimas versiones como JBoss 7 y <a href=http://wildfly.org/>WildFly</a> la forma de cargar las clases es más parecido al modelo habitual que se sigue en las aplicaciones Java EE y en servidores como Tomcat buscando primero en el directorio classes WEB-INF/classes y entre las librerías de la carpeta WEB-INF/lib del archivo war. Además, con la inclusión de JBoss Modules se puede seguir un esquema OSGi con lo que incluso podríamos usar simultaneamente en el servidor diferentes versiones de la misma librería.</p><p>Sin embargo, a pesar de seguir el esquema estándar de buscar las clases y usar OSGi para que Tapestry encuentre los archivos que necesita, como plantillas, imágenes, literales que pueden estar embebidos en los archivos jar de librerías es necesario hacer algunas modificaciones. En una <a href=http://wiki.apache.org/tapestry/HowToRunTapestry5OnJBoss7Dot1>guía de uso de Tapestry con JBoss</a> se explica como conseguir hacer funcionar una aplicación Tapestry tanto en JBoss 7 como en WildFly 8. La solución consiste en proporcionar una clase para que encuentre correctamente los archivos que Tapestry necesita y esta clase será la que veremos en el siguiente ejemplo.</p><p>Con la clase que permite funcionar las aplicaciones Tapestry en JBoss/WildFly junto con un poco de configuración para el contenedor de dependencias definido en un módulo será suficiente. La clase es la siguiente:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.misc</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.File</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.URL</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.URLConnection</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.apache.tapestry5.ioc.services.ClasspathURLConverter</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.jboss.vfs.VFSUtils</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.jboss.vfs.VirtualFile</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>WildFlyClasspathURLConverter</span> <span class=kd>implements</span> <span class=n>ClasspathURLConverter</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>WildFlyClasspathURLConverter</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>URL</span> <span class=nf>convert</span><span class=o>(</span><span class=kd>final</span> <span class=n>URL</span> <span class=n>url</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>url</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=o>.</span><span class=na>getProtocol</span><span class=o>().</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;vfs&#34;</span><span class=o>))</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=kd>final</span> <span class=n>URL</span> <span class=n>realURL</span><span class=o>;</span>
                <span class=kd>final</span> <span class=n>String</span> <span class=n>urlString</span> <span class=o>=</span> <span class=n>url</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
                <span class=c1>// If the virtual URL involves a JAR file,
</span><span class=c1></span>             <span class=c1>// we have to figure out its physical URL ourselves because
</span><span class=c1></span>             <span class=c1>// in JBoss 7.0.2 the JAR files exploded into the VFS are empty
</span><span class=c1></span>             <span class=c1>// (see https://issues.jboss.org/browse/JBAS-8786).
</span><span class=c1></span>             <span class=c1>// Our workaround is that they are available, unexploded,
</span><span class=c1></span>             <span class=c1>// within the otherwise exploded WAR file.
</span><span class=c1></span>             <span class=k>if</span> <span class=o>(</span><span class=n>urlString</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;.jar&#34;</span><span class=o>))</span> <span class=o>{</span>
                    <span class=c1>// An example URL:
</span><span class=c1></span>                 <span class=c1>// &#34;vfs:/devel/jboss-as-7.1.1.Final/standalone/deployments/myapp.ear/myapp.war/WEB-INF/\
</span><span class=c1></span>                 <span class=c1>// lib/tapestry-core-5.3.2.jar/org/apache/tapestry5/corelib/components/&#34;
</span><span class=c1></span>                 <span class=c1>// Break the URL into its WAR part, the JAR part,
</span><span class=c1></span>                 <span class=c1>// and the Java package part.
</span><span class=c1></span>                 <span class=kd>final</span> <span class=kt>int</span> <span class=n>warPartEnd</span> <span class=o>=</span> <span class=n>urlString</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>&#34;.war&#34;</span><span class=o>)</span> <span class=o>+</span> <span class=n>4</span><span class=o>;</span>
                    <span class=kd>final</span> <span class=n>String</span> <span class=n>warPart</span> <span class=o>=</span> <span class=n>urlString</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>warPartEnd</span><span class=o>);</span>
                    <span class=kd>final</span> <span class=kt>int</span> <span class=n>jarPartEnd</span> <span class=o>=</span> <span class=n>urlString</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>&#34;.jar&#34;</span><span class=o>)</span> <span class=o>+</span> <span class=n>4</span><span class=o>;</span>
                    <span class=kd>final</span> <span class=n>String</span> <span class=n>jarPart</span> <span class=o>=</span> <span class=n>urlString</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>warPartEnd</span><span class=o>,</span> <span class=n>jarPartEnd</span><span class=o>);</span>
                    <span class=kd>final</span> <span class=n>String</span> <span class=n>packagePart</span> <span class=o>=</span> <span class=n>urlString</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>jarPartEnd</span><span class=o>);</span>
                    <span class=c1>// Ask the VFS where the exploded WAR is.
</span><span class=c1></span>                 <span class=kd>final</span> <span class=n>URL</span> <span class=n>warURL</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=o>(</span><span class=n>warPart</span><span class=o>);</span>
                    <span class=kd>final</span> <span class=n>URLConnection</span> <span class=n>warConnection</span> <span class=o>=</span> <span class=n>warURL</span><span class=o>.</span><span class=na>openConnection</span><span class=o>();</span>
                    <span class=kd>final</span> <span class=n>VirtualFile</span> <span class=n>jBossVirtualWarDir</span> <span class=o>=</span> <span class=o>(</span><span class=n>VirtualFile</span><span class=o>)</span> <span class=n>warConnection</span><span class=o>.</span><span class=na>getContent</span><span class=o>();</span>
                    <span class=kd>final</span> <span class=n>File</span> <span class=n>physicalWarDir</span> <span class=o>=</span> <span class=n>jBossVirtualWarDir</span><span class=o>.</span><span class=na>getPhysicalFile</span><span class=o>();</span>
                    <span class=kd>final</span> <span class=n>String</span> <span class=n>physicalWarDirStr</span> <span class=o>=</span> <span class=n>physicalWarDir</span><span class=o>.</span><span class=na>toURI</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
                    <span class=c1>// Return a &#34;jar:&#34; URL constructed from the parts
</span><span class=c1></span>                 <span class=c1>// eg.
</span><span class=c1></span>                 <span class=c1>// &#34;jar:file:/devel/jboss-as-7.1.1.Final/standalone/tmp/vfs/deployment40a6ed1db5eabeab/\
</span><span class=c1></span>                 <span class=c1>// myapp.war-43e2c3dfa858f4d2/WEB-INF/lib/tapestry-core-5.3.2.jar!/org/apache/tapestry5/corelib/components/&#34;.
</span><span class=c1></span>                 <span class=kd>final</span> <span class=n>String</span> <span class=n>actualJarPath</span> <span class=o>=</span> <span class=s>&#34;jar:&#34;</span> <span class=o>+</span> <span class=n>physicalWarDirStr</span> <span class=o>+</span> <span class=n>jarPart</span> <span class=o>+</span> <span class=s>&#34;!&#34;</span> <span class=o>+</span> <span class=n>packagePart</span><span class=o>;</span>
                    <span class=k>return</span> <span class=k>new</span> <span class=n>URL</span><span class=o>(</span><span class=n>actualJarPath</span><span class=o>);</span>
                <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                    <span class=c1>// Otherwise, ask the VFS what the physical URL is...
</span><span class=c1></span>                 <span class=kd>final</span> <span class=n>URLConnection</span> <span class=n>connection</span> <span class=o>=</span> <span class=n>url</span><span class=o>.</span><span class=na>openConnection</span><span class=o>();</span>
                    <span class=kd>final</span> <span class=n>VirtualFile</span> <span class=n>virtualFile</span> <span class=o>=</span> <span class=o>(</span><span class=n>VirtualFile</span><span class=o>)</span> <span class=n>connection</span><span class=o>.</span><span class=na>getContent</span><span class=o>();</span>
                    <span class=n>realURL</span> <span class=o>=</span> <span class=n>VFSUtils</span><span class=o>.</span><span class=na>getPhysicalURL</span><span class=o>(</span><span class=n>virtualFile</span><span class=o>);</span>
                <span class=o>}</span>
                <span class=k>return</span> <span class=n>realURL</span><span class=o>;</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=kd>final</span> <span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Unable to convert URL&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=k>return</span> <span class=n>url</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/WildFlyClasspathURLConverter.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/WildFlyClasspathURLConverter.java target=_blank>WildFlyClasspathURLConverter.java</a></div></div><p>La configuración adicional para el contenedor de dependencias es para que Tapestry use esta nueva clase:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services</span><span class=o>;</span>
<span class=o>...</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AppModule</span> <span class=o>{</span>
    <span class=o>...</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>contributeServiceOverride</span><span class=o>(</span><span class=n>MappedConfiguration</span><span class=o>&lt;</span><span class=n>Class</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>configuration</span><span class=o>,</span> <span class=nd>@Local</span> <span class=n>HibernateSessionSource</span> <span class=n>hibernateSessionSource</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>configuration</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>HibernateSessionSource</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>hibernateSessionSource</span><span class=o>);</span>
        
        <span class=k>if</span> <span class=o>(</span><span class=n>isServidorJBoss</span><span class=o>(</span><span class=n>ContextListener</span><span class=o>.</span><span class=na>SERVLET_CONTEXT</span><span class=o>))</span> <span class=o>{</span>
            <span class=n>configuration</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>ClasspathURLConverter</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=k>new</span> <span class=n>WildFlyClasspathURLConverter</span><span class=o>());</span>          
        <span class=o>}</span>
    <span class=o>}</span>
    <span class=o>...</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>isServidorJBoss</span><span class=o>(</span><span class=n>ServletContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>si</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=na>getServerInfo</span><span class=o>();</span>

        <span class=k>if</span> <span class=o>(</span><span class=n>si</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;WildFly&#34;</span><span class=o>)</span> <span class=o>||</span> <span class=n>si</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;JBoss&#34;</span><span class=o>))</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
        <span class=o>}</span>
        
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=o>...</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/AppModule.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/AppModule.java target=_blank>AppModule.java</a></div></div><p>El ContextListener que nos permite acceder al ServletContext es el siguiente:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.misc</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.servlet.ServletContext</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.servlet.ServletContextEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.servlet.ServletContextListener</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ContextListener</span> <span class=kd>implements</span> <span class=n>ServletContextListener</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>ServletContext</span> <span class=n>SERVLET_CONTEXT</span><span class=o>;</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>contextInitialized</span><span class=o>(</span><span class=n>ServletContextEvent</span> <span class=n>sce</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>SERVLET_CONTEXT</span> <span class=o>=</span> <span class=n>sce</span><span class=o>.</span><span class=na>getServletContext</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>contextDestroyed</span><span class=o>(</span><span class=n>ServletContextEvent</span> <span class=n>sce</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/ContextListener.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/ContextListener.java target=_blank>ContextListener.java</a></div></div><p>Además hemos de incluir en el proyecto un par de librerías y usar al menos la versión 16 de guava si se incluye como dependencia en el war:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=n>dependencies</span> <span class=o>{</span>
    <span class=o>...</span>
    <span class=n>compile</span> <span class=s1>&#39;com.google.guava:guava:16.0.1&#39;</span>
    <span class=n>providedCompile</span> <span class=s1>&#39;org.jboss:jboss-vfs:3.2.1.Final&#39;</span>
    <span class=n>runtime</span> <span class=s1>&#39;org.jboss.logging:jboss-logging:3.1.4.GA&#39;</span>
    <span class=o>...</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/build.gradle target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/06/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly/code/build.gradle target=_blank>build.gradle</a></div></div><p>En la <a href=https://github.com/picodotdev/elblogdepicodev/tree/master/PlugInTapestry>aplicación de ejemplo</a> también deberemos actualizar la versión de guava al menos a la versión 16. Y esta clase y configuración es suficiente para que &ldquo;mágicamente&rdquo; se solucionen los problemas de las aplicaciones Tapestry con el servidor de aplicaciones JBoss/WildFly. Si no usamos lo indicado en este artículo al acceder al acceder a la aplicación fallaría con una excepción.</p><div class="alert alert-warning"><img src=assets/images/posts/2014/12/portada-PugInTapestry-thumb.png alt="Portada libro: PlugIn Tapestry" title="Portada libro: PlugIn Tapestry" style=float:left;margin-right:1.5em><h3>Libro PlugIn Tapestry</h3><p>Si te interesa Apache Tapestry descarga gratis el libro de más de 300 páginas que he escrito sobre este <i>framework</i> en el formato que prefieras, <a href=https://picodotdev.github.io/blog-bitix/2014/02/libro-sobre-desarrollo-de-aplicaciones-con-apache-tapestry/>PlugIn Tapestry: Desarrollo de aplicaciones y páginas web con Apache Tapestry</a>, y el código de ejemplo asociado. En el libro comento detalladamente muchos aspectos que son necesarios en una aplicación web como persistencia, pruebas unitarias y de integración, inicio rápido, seguridad, formularios, internacionalización (i18n) y localización (l10n), AJAX, ... y como abordarlos usando Apache Tapestry.</p><br style=clear:both><div class=buttons><a href=https://picodotdev.github.io/blog-bitix/assets/custom/PlugInTapestry.pdf class="btn btn-lg btn-success">PDF</a>
<a href=https://picodotdev.github.io/blog-bitix/assets/custom/PlugInTapestry.epub class="btn btn-lg btn-success">EPUB</a>
<a href=https://picodotdev.github.io/blog-bitix/assets/custom/PlugInTapestry.mobi class="btn btn-lg btn-success">MOBI</a>
<a href=https://picodotdev.github.io/blog-bitix/assets/custom/PlugInTapestry.zip class="btn btn-lg btn-success">HTML</a></div><div class=buttons><a href=https://github.com/picodotdev/blog-ejemplos/tree/master/PlugInTapestry class="btn btn-lg btn-success">Código fuente ejemplos</a></div></div><div class=reference>Referencia:<br><ul><li><a href=https://picodotdev.github.io/blog-bitix/2014/02/libro-sobre-desarrollo-de-aplicaciones-con-apache-tapestry/>Libro PlugIn Tapestry</a></li><li><a href=https://elblogdepicodev.blogspot.com.es/2010/05/documentacion-sobre-apache-tapestry.html>Documentación sobre Apache Tapestry</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/02/servidor-de-aplicaciones-jboss-slash-wildfly/>Servidor de aplicaciones JBoss/WildFly</a></li><li><a href=http://wiki.apache.org/tapestry/HowToRunTapestry5OnJBoss7Dot1>http://wiki.apache.org/tapestry/HowToRunTapestry5OnJBoss7Dot1</a></li></ul></div></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2014/05/arquitectura-y-hospedaje-de-blog-stack/>Arquitectura y hospedaje de Blog Stack</a></li><li><a href=/blog-bitix/2014/02/presentacion-sobre-apache-tapestry/>Presentación sobre Apache Tapestry</a></li><li><a href=/blog-bitix/2014/05/detectar-problema-n-plus-1-y-obtener-estadisticas-de-hibernate-con-grails/>Detectar problema N&#43;1 y obtener estadísticas de Hibernate con Grails</a></li><li><a href=/blog-bitix/2014/05/pagina-de-excepcion-de-grails/>Página de excepción de Grails</a></li><li><a href=/blog-bitix/2014/05/presentacion-blog-stack/>Presentación de Blog Stack</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class="col-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2014\/06\/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2014\/06\/ejecutar-apache-tapestry-en-el-servidor-de-aplicaciones-wildfly\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="picodotdev"><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Las aplicaciones están pasando de ser elementos aislados, grandes y monolíticos a ser desarrolladas como varios microservicios que colaboran entre si para en conjunto ofrecer la funcionalidad deseada. Aunque los microservicios presentan sus propias problemáticas resuelven algunas que poseen los sistemas monolíticos, entre algunas de sus caracteríticas deseables están: mayor cohesión, menor acoplamiento, menor tamaño, mayor independencia de la tecnología usando la más adecuada en cada situación, más fácilmente reemplazables y despliegues más sencillos. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Introducción y ejemplo de API RPC con Apache Thrift</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href=assets/css/font.css><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.3.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script type=text/javascript src=assets/js/require-config.js data-main=js/main defer></script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col-12><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class="col-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><div class=adblock-sidebar-container><ins class="adsbygoogle adblock-sidebar-vertical" style=display:block data-ad-client=ca-pub-3533636310991304 data-ad-slot=9933840986 data-ad-format="vertical, rectangle" data-type=auto></ins></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content="es"><meta itemprop=keywords content="blog-stack, java, planeta-codigo, programacion"><h1 itemprop=name>Introducción y ejemplo de API RPC con Apache Thrift</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2015-03-20>20/03/2015</time>, actualizado el <time itemprop=dateModified datetime=2015-11-10>10/11/2015</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/programacion/>programacion</a><br><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/#comments>Comentarios</a></p><div class=content itemprop=articleBody><meta itemprop=wordCount content="1571"><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>Las aplicaciones están pasando de ser elementos aislados, grandes y monolíticos a ser desarrolladas como varios microservicios que colaboran entre si para en conjunto ofrecer la funcionalidad deseada. Aunque los microservicios presentan sus propias problemáticas resuelven algunas que poseen los sistemas monolíticos, entre algunas de sus caracteríticas deseables están: mayor cohesión, menor acoplamiento, menor tamaño, mayor independencia de la tecnología usando la más adecuada en cada situación, más fácilmente reemplazables y despliegues más sencillos. También, la funcionalidad ofrecida por una aplicación puede quererse consumirse desde otra aplicación surgiendo de esta forma una API. Para ofrecer una API de una aplicación que pueda consumirse internamente, desde diferentes dispositivos o por terceras partes podemos usar <a href=https://es.wikipedia.org/wiki/Simple_Object_Access_Protocol>SOAP</a> o <a href=https://es.wikipedia.org/wiki/Representational_State_Transfer>REST</a> pero también han surgido algunas alternativas como <a href=https://thrift.apache.org/>Apache Thrift</a> supliendo algunas carencias de las anteriores aún basándose en el mismo concepto de llamada a código en una máquina remota (Remote Procedure Call, <a href=https://es.wikipedia.org/wiki/Remote_Procedure_Call>RPC</a>) ya visto en algunas opciones más antiguas como la misma SOAP, <a href=https://en.wikipedia.org/wiki/Java_remote_method_invocation>RMI</a> o <a href=https://es.wikipedia.org/wiki/CORBA>CORBA</a>. En este artículo explicaré algunas diferencias entre SOAP, REST y Apache Thrift y mostraré un ejemplo sencillo con código de cómo empezar a usar Apache Thrift.</p><p>En los modelos RPC las llamadas a métodos se hacen a través de la red de forma transparente aunque tendremos que tener en cuenta que se utilizando un medio no fiable y con un rendimiento menor que llamadas en la misma máquina que notaremos más si se usan muchas llamadas. SOAP es una forma de RPC en la que se utiliza XML, algunas críticas a SOAP son que el XML utilizado para la comunicación es complejo y los servicios SOAP no son fácilmente consumibles desde por ejemplo un navegador. Por otra parte, las API REST tratan de solventar algunas de las deficiencias de SOAP como por ejemplo estar expuestas como recursos fácilmente accesibles utilizando los mismos mecanismos de la web y un formato para el intercambio de datos como <a href=http://json.org/>JSON</a> más sencillo y fácilmente consumible que XML. Sin embargo, algunas críticas que se le están haciendo REST son:</p><ul><li>APIs asíncronas: el modelo RESTful de petición y respuesta no se adapta bien a un modelo donde hay necesidad de enviar datos de forma asíncrona evitando sondear continuamente el servidor con peticiones que consumen recursos de red y de servidor. El modelo asíncrono envía nuevos datos únicamente cuando estos se hacen disponibles.</li><li>Orquestación y experiencia de la API: la granularidad de una API REST no se adapta correctamente a algunas situaciones haciendo necesario realizar varias peticiones HTTP lo que añade carga al cliente, servidor y la red. Orquestando APIs internas en el servidor y publicando una que esté adaptada a lo que necesitan los diferentes clientes supone un mejor rendimiento y simplicidad.</li><li>SDKs vs APIs: los usuarios de las APIs finalmente las consumen desde un lenguaje de alto nivel como <a href=https://es.wikipedia.org/wiki/JavaScript>JavaScript</a>, <a href=https://www.python.org/>Python</a>, <a href=https://www.ruby-lang.org/es/>Ruby</a>, <a href=https://www.oracle.com/technetwork/java/index.html>Java</a>, <a href=https://secure.php.net/>PHP</a>, <a href=https://dotnet.microsoft.com/>C#</a>, etc. con lo que los proveedores de las APIs necesitan ofrecer librerías cliente para algunos de estos lenguajes.</li><li>Protocolos binarios: los formatos binarios son más eficientes que el texto plano, lo que es útil en dispositivos limitados como los utilizados en el internet de las cosas (IoT).</li><li>Alta latencia: la sobrecarga que introduce el protocolo http en cada petición no lo hace adecuado en situaciones en que una baja latencia es necesaria para proporcionar un rendimiento óptimo.</li></ul><p>Por otra parte algunos otros puntos a favor de RPC son:</p><ul><li>Se tiene <em>type safety</em> y puede enviar excepciones que puede ser manejadas con la misma infraestructura ofrecida por el lenguaje de programación usado.</li><li>Si se hacen grandes volúmenes de llamadas y datos o hay requerimientos de ancho de banda se pueden usar protocolos de transporte más eficientes que HTTP.</li></ul><p>Apache Thrift es un <em>framework</em> para desarrollar servicios eficientes e interoperables en diferentes lenguajes. Los lenguajes soportados en cualquier combinación de cliente y servidor son C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, OCaml y Delphi y alguno más. Para generar el código del servidor o cliente lo primero que debemos hacer es definir la interfaz del servicio en la que estén incluidas las operaciones, parámetros y retornos junto con sus tipos. A partir de esta interfaz Apache Thrift generará el cliente o servidor en el lenguaje que deseemos. Una vez publicada una versión de la interfaz podremos modificarla sin provocar problemas de compatibilidad en los clientes como ocurría en RMI. Una desventaja de Apache Thrift es que obliga a usar esta tecnología para consumir los servicios, en este sentido una API REST es más agnóstica en la que basta con el protocolo HTTP y JSON. Se puede optar por un modelo en el que de cara al exterior se ofrece una API REST pero internamente se usan APIs RPC. Veamos un ejemplo con Apache Thrift.</p><p>Primeramente, para usar Apache Thrift debemos instalar el paquete en la distribución que usemos. En Arch Linux con:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ sudo pacman -S thrift
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/pacman.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/pacman.sh target=_blank>pacman.sh</a></div></div><p>A continuación deberemos definir la interfaz del servicio, supongamos que queremos hacer un servicio que nos ofrezca un mensaje de ping, la hora del servidor y la suma de dos números. La interfaz de este servicio usando el DSL es:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>namespace java io.github.picodotdev.blogbitix.thrift

service Service {

   string ping()
   i32 add(1:i32 op1, 2:i32 op2)
   string date()
}
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Service.thrift target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Service.thrift target=_blank>Service.thrift</a></div></div><p>Podemos elegir cualesquiera lenguajes deseemos de la amplia lista soportada anterior, en este caso usaré Java tanto para el servidor como para el cliente. Usando el comando <code>thrift</code> e indicando el lenguaje y la interfaz generamos los artefactos:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ thrift -out src/main/java --gen java src/main/thrift/Service.thrift
$ gradlew trift</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/gradlew.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/gradlew.sh target=_blank>gradlew.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=n>description</span> <span class=o>=</span> <span class=s1>&#39;HolaMundoApacheThrift&#39;</span>
<span class=n>version</span> <span class=o>=</span> <span class=s1>&#39;0.1&#39;</span>

<span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;eclipse&#39;</span>
<span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;java&#39;</span>

<span class=n>repositories</span> <span class=o>{</span>
    <span class=n>mavenCentral</span><span class=o>()</span>
<span class=o>}</span>

<span class=n>dependencies</span> <span class=o>{</span>
    <span class=n>compile</span> <span class=s1>&#39;org.apache.thrift:libthrift:0.9.2&#39;</span>
    <span class=n>runtime</span> <span class=s1>&#39;org.apache.logging.log4j:log4j-core:2.1&#39;</span>
    <span class=n>runtime</span> <span class=s1>&#39;org.apache.logging.log4j:log4j-slf4j-impl:2.1&#39;</span>
<span class=o>}</span>

<span class=n>task</span> <span class=nf>wrapper</span><span class=o>(</span><span class=nl>type:</span> <span class=n>Wrapper</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>gradleVersion</span> <span class=o>=</span> <span class=s1>&#39;2.3&#39;</span>
<span class=o>}</span>

<span class=n>task</span> <span class=nf>thrift</span><span class=o>()</span> <span class=o>{</span>
    <span class=n>exec</span> <span class=o>{</span>
        <span class=n>commandLine</span> <span class=s1>&#39;thrift&#39;</span><span class=o>,</span> <span class=s1>&#39;-out&#39;</span><span class=o>,</span> <span class=s1>&#39;src/main/java&#39;</span><span class=o>,</span> <span class=s1>&#39;--gen&#39;</span><span class=o>,</span> <span class=s1>&#39;java&#39;</span><span class=o>,</span> <span class=s1>&#39;src/main/thrift/Service.thrift&#39;</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/build.gradle target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/build.gradle target=_blank>build.gradle</a></div></div><p>Esto nos genera unas clases en Java y una interfaz que implementaremos para proporcionar la funcionalidad del servicio, en el caso del ejemplo la interfaz es <em>Service.Iface</em>. Para que los clientes puedan consumir este servicio debemos iniciar el servidor que no será más que un programa Java que escucha las peticiones de los clientes en un puerto.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=err>package io</span><span class=p>.</span><span class=na>github</span><span class=p>.</span><span class=na>picodotdev</span><span class=p>.</span><span class=na>blogbitix</span><span class=p>.</span><span class=na>thrift</span><span class=p>;</span>

<span class=err>import java</span><span class=p>.</span><span class=na>text</span><span class=p>.</span><span class=na>SimpleDateFormat</span><span class=p>;</span>
<span class=err>import java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>Date</span><span class=p>;</span>

<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>TException</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>TServer</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>TServer</span><span class=p>.</span><span class=na>Args</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>TSimpleServer</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>transport</span><span class=p>.</span><span class=na>TServerSocket</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>transport</span><span class=p>.</span><span class=na>TServerTransport</span><span class=p>;</span>

<span class=err>public class </span><span class=n>Server</span> <span class=p>{</span>

    <span class=err>public static void main</span><span class=p>(</span><span class=err>String[] args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=err>final Service</span><span class=p>.</span><span class=na>Processor</span><span class=o>&lt;</span><span class=err>Service.Iface&gt; processor </span><span class=o>=</span> <span class=k>new</span> <span class=n>Service</span><span class=p>.</span><span class=na>Processor</span><span class=o>&lt;</span><span class=n>Service</span><span class=p>.</span><span class=na>Iface</span><span class=o>&gt;</span><span class=p>(</span><span class=k>new</span> <span class=n>Server</span><span class=p>.</span><span class=na>ServiceImpl</span><span class=p>());</span>

            <span class=err>Runnable simple </span><span class=o>=</span> <span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
                <span class=err>public void </span><span class=n>run</span><span class=p>()</span> <span class=p>{</span>
                    <span class=n>simple</span><span class=p>(</span><span class=n>processor</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>};</span>

            <span class=k>new</span> <span class=n>Thread</span><span class=p>(</span><span class=n>simple</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=err>Exception e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=err>public static void simple</span><span class=p>(</span><span class=err>Service.Processor&lt;Service.Iface&gt; processor</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=err>TServerTransport serverTransport </span><span class=o>=</span> <span class=k>new</span> <span class=n>TServerSocket</span><span class=p>(</span><span class=n>9090</span><span class=p>);</span>
            <span class=err>TServer server </span><span class=o>=</span> <span class=k>new</span> <span class=n>TSimpleServer</span><span class=p>(</span><span class=k>new</span> <span class=n>Args</span><span class=p>(</span><span class=n>serverTransport</span><span class=p>).</span><span class=na>processor</span><span class=p>(</span><span class=n>processor</span><span class=p>));</span>

            <span class=c1>// Use this for a multithreaded server
</span><span class=c1></span>         <span class=c1>// TServer server = new TThreadPoolServer(new
</span><span class=c1></span>         <span class=c1>// TThreadPoolServer.Args(serverTransport).processor(processor));
</span><span class=c1></span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Starting the service server...&#34;</span><span class=p>);</span>
            <span class=n>server</span><span class=p>.</span><span class=na>serve</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=err>Exception e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    
    <span class=err>private static class ServiceImpl implements Service</span><span class=p>.</span><span class=na>Iface</span> <span class=p>{</span>

        <span class=nd>@Override</span>
        <span class=err>public String </span><span class=n>ping</span><span class=p>()</span> <span class=err>throws TException </span><span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Me han llamado ¡que ilusión! ^^&#34;</span><span class=p>);</span>
            
            <span class=k>return</span> <span class=s>&#34;¡Hola mundo!&#34;</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=nd>@Override</span>
        <span class=err>public int </span><span class=n>add</span><span class=p>(</span><span class=err>int op1</span><span class=p>,</span> <span class=err>int op2</span><span class=p>)</span> <span class=err>throws TException </span><span class=p>{</span>
            <span class=k>return</span> <span class=n>op1</span> <span class=o>+</span> <span class=n>op2</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=nd>@Override</span>
        <span class=err>public String </span><span class=n>date</span><span class=p>()</span> <span class=err>throws TException </span><span class=p>{</span>
            <span class=k>return</span> <span class=k>new</span> <span class=n>SimpleDateFormat</span><span class=p>(</span><span class=s>&#34;dd-MM-yyyy HH:mm:ss Z&#34;</span><span class=p>).</span><span class=na>format</span><span class=p>(</span><span class=k>new</span> <span class=n>Date</span><span class=p>());</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Server.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Server.java target=_blank>Server.java</a></div></div><p>Una vez están los servicios disponibles podemos consumirlos con las siguientes siguientes líneas de código de una implementación de cliente, basta hacer uso de las clase <em>Service.Client</em> generada a partir de la interfaz del servicio.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=err>package io</span><span class=p>.</span><span class=na>github</span><span class=p>.</span><span class=na>picodotdev</span><span class=p>.</span><span class=na>blogbitix</span><span class=p>.</span><span class=na>thrift</span><span class=p>;</span>

<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>TException</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>protocol</span><span class=p>.</span><span class=na>TBinaryProtocol</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>protocol</span><span class=p>.</span><span class=na>TProtocol</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>transport</span><span class=p>.</span><span class=na>TSocket</span><span class=p>;</span>
<span class=err>import org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>thrift</span><span class=p>.</span><span class=na>transport</span><span class=p>.</span><span class=na>TTransport</span><span class=p>;</span>

<span class=err>public class </span><span class=n>Client</span> <span class=p>{</span>

    <span class=err>public static void main</span><span class=p>(</span><span class=err>String[] args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
          <span class=err>TTransport transport </span><span class=o>=</span> <span class=k>new</span> <span class=n>TSocket</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>9090</span><span class=p>);</span>
          <span class=n>transport</span><span class=p>.</span><span class=na>open</span><span class=p>();</span>

          <span class=err>TProtocol protocol </span><span class=o>=</span> <span class=k>new</span>  <span class=n>TBinaryProtocol</span><span class=p>(</span><span class=n>transport</span><span class=p>);</span>
          <span class=err>Service.Client client </span><span class=o>=</span> <span class=k>new</span> <span class=n>Service</span><span class=p>.</span><span class=na>Client</span><span class=p>(</span><span class=n>protocol</span><span class=p>);</span>

          <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;Ping: %s&#34;</span><span class=p>,</span> <span class=n>client</span><span class=p>.</span><span class=na>ping</span><span class=p>()));</span>
          <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;Add: %d&#34;</span><span class=p>,</span> <span class=n>client</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>4</span><span class=p>,</span> <span class=n>7</span><span class=p>)));</span>
          <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;Date: %s&#34;</span><span class=p>,</span> <span class=n>client</span><span class=p>.</span><span class=na>date</span><span class=p>()));</span>

          <span class=n>transport</span><span class=p>.</span><span class=na>close</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=err>TException e</span><span class=p>)</span> <span class=p>{</span>
          <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
        <span class=p>}</span> 
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Client.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/code/Client.java target=_blank>Client.java</a></div></div><p>Ejecutando el cliente y llamando a los métodos de la interfaz del servicio veremos en la terminal la siguiente salida:</p><div class=media style=text-align:center><figure><a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/images/cliente.png title="Salida de consola del cliente" data-gallery><img src=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/images/cliente-thumb.png width=650></a>
<a href=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/images/servidor.png title="Salida de consola del servidor" data-gallery><img src=/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/images/servidor-thumb.png width=650></a></figure></div><p>Si te interesan las arquitecturas de aplicaciones con microservicios ya sea con API RPC o REST un libro muy interesante y recomendable es <a href="https://www.amazon.es/gp/product/1491950358/ref=as_li_ss_tl?ie=UTF8&camp=3626&creative=24822&creativeASIN=1491950358&linkCode=as2&tag=blobit-21">Building Microservices</a><img src="https://ir-es.amazon-adsystem.com/e/ir?t=blobit-21&l=as2&o=30&a=1491950358" width=1 height=1 border=0 alt style=border:none!important;margin:0!important>. Proporciona una visión detallada de los diferentes aspectos que deben tratar este tipo de aplicaciones.</p><div class=media-amazon style=text-align:center><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=blobit-21&o=30&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=1491950358&internal=1" style=width:120px;height:240px scrolling=no marginwidth=0 marginheight=0 frameborder=0></iframe></div><p>Apache Thrift no es la única herramienta para hacer llamadas RPC, una muy similar es <a href=https://grpc.io/>gRPC</a> de <a href=https://www.google.es/>Google</a> e igualmente interesante al hacer uso de HTTP/2 y Protocol Buffers.</p><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/HolaMundoThrift>código fuente completo del ejemplo</a> lo puedes encontrar en mi repositorio de GitHub.</p><div class=reference>Referencia:<br><ul><li><a href=http://www.programmableweb.com/news/rest-losing-its-flair-rest-api-alternatives/analysis/2013/12/19>Is REST losing its flair? REST API Alternatives</a></li><li><a href=http://www.quora.com/What-is-the-advantage-of-using-Thrift-as-opposed-to-exposing-an-HTTP-REST-API>What is the advantage of using Thrift, as opposed to exposing an HTTP REST API?</a></li><li><a href=http://willwarren.com/2012/01/24/creating-a-public-api-with-apache-thrift/>Creating a public API with Apache Thrift</a></li><li><a href=http://es.slideshare.net/IgorAnishchenko/pb-vs-thrift-vs-avro>Thrift vs Protocol Buffers vs Avro - Biased Comparison</a></li></ul></div></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2015/03/aplicacion-web-java-autocontenida-con-tomcat-embedded/>Aplicación web Java autocontenida con Tomcat Embedded</a></li><li><a href=/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/>Datos de sesión externalizados con Spring Session</a></li><li><a href=/blog-bitix/2015/02/listener-de-eventos-de-hibernate-con-servicios-de-spring/>Listener de eventos de Hibernate con servicios de Spring</a></li><li><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/>Ejemplo de listener de eventos de Hibernate</a></li><li><a href=/blog-bitix/2015/02/la-palabra-clave-assert-de-java-y-un-ejemplo/>La palabra clave assert de Java y un ejemplo</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class="col-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/03\/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/03\/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property="dct:title"><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property="cc:attributionName" rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
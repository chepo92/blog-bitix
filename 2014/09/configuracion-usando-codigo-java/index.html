<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="En las dos últimas entradas he explicado como compilar un archivo de código fuente Java desde una aplicación y como cargar esa clase compilada de forma dinámica para ser utilizada en un programa, la segunda entrada trataba el como monitorizar un directorio o archivo para ver si han tenido cambios con la nueva API que a partir de Java 7 disponemos.
En esta entrada quiero explicar un ejemplo de como aprovechar estas dos funcionalidades diferentes en un caso práctico y que nos puede ser útil en algún caso. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Configuración usando código Java</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2014/09/configuracion-usando-codigo-java/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.3.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery-3.4.1.slim.min','bootstrap':'libs/bootstrap-4.3.1/js/bootstrap.min','bowser':'libs/bowser-2.3.0','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="programacion, java, planeta-codigo, blog-stack"><h1 itemprop=name>Configuración usando código Java</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2014-09-26>26/09/2014</time>, actualizado el <time itemprop=dateModified datetime=2015-11-10>10/11/2015</time>.<br><a href=tags/programacion/>programacion</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/blog-stack/>blog-stack</a><br><a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/#comments>Comentarios</a></p><div><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=1164><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>En las dos últimas entradas he explicado <a href=https://picodotdev.github.io/blog-bitix/2014/09/compilar-y-cargar-de-forma-dinamica-una-clase-java/>como compilar un archivo de código fuente Java desde una aplicación</a> y como cargar esa clase compilada de forma dinámica para ser utilizada en un programa, la segunda entrada trataba el <a href=https://picodotdev.github.io/blog-bitix/2014/09/monitorizar-archivos-con-java/>como monitorizar un directorio o archivo para ver si han tenido cambios</a> con la nueva API que a partir de Java 7 disponemos.</p><p>En esta entrada quiero explicar un ejemplo de como aprovechar estas dos funcionalidades diferentes en un caso práctico y que nos puede ser útil en algún caso. La idea del ejemplo es definir la configuración de una aplicación como podría ser una aplicación web en un archivo de código fuente Java y que cuando se produjese algún cambio se recargase de forma dinámica.</p><p>Algunas ventajas de definir la configuración de la aplicación de esta manera son las siguientes:</p><ul><li>Al ser el archivo de configuración código Java que se compila podemos aprovecharnos de la validación que hace el compilador para estar seguros de que está libre de errores léxicos y sintácticos, el archivo solo se cargará cuando está libre de errores de compilación. Al compilarlo el compilador nos advertirá de los errores que contenga de forma precisa.</li><li>Por otra parte al ser código en el archivo de configuración podemos usar el lenguaje Java para hacer ciertas operaciones que en un xml u otro formato de archivo de texto plano no podemos hacer. Podríamos hacer un cálculo o conectarnos a la base de datos u otro sistema para recuperar cierta información. En algunos casos el lenguaje Java puede ser mejor opción para describir la configuración que los archivos de texto, son los mismos <a href=https://elblogdepicodev.blogspot.com.es/2012/03/herramienta-de-construccion-gradle.html>problemas de ant y maven comparados con gradle</a>. También el código Java puede ser la forma más breve y útil para describir la configuración de la aplicación que archivos de texto, usando código Java podremos devolver objetos, listas, &hellip; en vez de Strings o números.</li><li>La recarga del archivo de configuración cuando se produzcan cambios en él nos evitará tener que reiniciar la aplicación, simplemente haremos el cambio y la configuración se aplicaría. Esto puede ser útil en las aplicaciones web evitándonos tener que hacer un reinicio de la aplicación.</li></ul><p>Una de las razones de la existencia de los archivos de configuración es tener esa configuración de forma externalizada a la aplicación de tal forma que podamos cambiar la configuración sin tener que modificar la aplicación ni tener que recompilarla. Con la compilación y carga dinámica de la clase Java de la configuración podemos tener estas mismas propiedades de los archivos de configuración. Si a esto le sumamos la recarga dinámica evitamos tener caídas de servicio en la aplicación por modificaciones en el archivo de configuración.</p><p>Todo esto es algo que se comenta en el <a href="https://www.amazon.es/gp/product/020161622X/ref=as_li_ss_tl?ie=UTF8&camp=3626&creative=24822&creativeASIN=020161622X&linkCode=as2&tag=blobit-21">libro The Pragmatic Programmer</a><img src="https://ir-es.amazon-adsystem.com/e/ir?t=blobit-21&l=as2&o=30&a=020161622X" width=1 height=1 border=0 alt style=border:none!important;margin:0!important> con las siguientes lineas:</p><blockquote><p>Many programs will scan such things only at startup, which is unfortunate. If you need to change the configuration, this forces you to
restart the application. A more flexible approach is to write programs that can reload their
configuration while they’re running. This flexibility comes at a cost: it
is more complex to implement. If it is a long-running server process, you will want to provide some way to reread and apply
metadata while the program is running.</p></blockquote><p>Esta es la teoría, veamos el código del ejemplo de configuración en Java con recarga dinámica. La mayor parte del código está en la clase ConfiguracionManager. Esta tiene dos métodos que son usados en la clase Main de la aplicación, el método load carga la clase y la compila, y el método monitor que monitoriza el archivo en busca de cambios y llama al método load cuando los detecte.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.config</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.nio.file.FileSystems</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.Path</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>Path</span> <span class=n>path</span> <span class=o>=</span> <span class=n>FileSystems</span><span class=o>.</span><span class=na>getDefault</span><span class=o>().</span><span class=na>getPath</span><span class=o>(</span><span class=s>&#34;src/main/java/io/github/picodotdev/blogbitix/config/AppConfiguracion.java&#34;</span><span class=o>);</span>
        <span class=n>ConfiguracionManager</span> <span class=n>manager</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConfiguracionManager</span><span class=o>(</span><span class=s>&#34;io.github.picodotdev.blogbitix.config.AppConfiguracion&#34;</span><span class=o>,</span> <span class=n>path</span><span class=o>).</span><span class=na>load</span><span class=o>().</span><span class=na>monitor</span><span class=o>();</span>
        
        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
        <span class=k>while</span> <span class=o>(</span><span class=n>n</span> <span class=o>&lt;</span> <span class=n>20</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>2000</span><span class=o>);</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>manager</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/code/Main.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/code/Main.java target=_blank>Main.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.config</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.FileReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.Reader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.FileSystems</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.Path</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.StandardWatchEventKinds</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.WatchEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.WatchKey</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.WatchService</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Map</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.tools.JavaCompiler</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.tools.JavaFileManager</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.tools.JavaFileObject</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.tools.ToolProvider</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ConfiguracionManager</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>fullName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Path</span> <span class=n>path</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Configuracion</span> <span class=n>configuracion</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Thread</span> <span class=n>thread</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>closed</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>ConfiguracionManager</span><span class=o>(</span><span class=n>String</span> <span class=n>fullName</span><span class=o>,</span> <span class=n>Path</span> <span class=n>path</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>fullName</span> <span class=o>=</span> <span class=n>fullName</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>path</span> <span class=o>=</span> <span class=n>path</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Configuracion</span> <span class=nf>getConfiguracion</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>configuracion</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Map</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>configuracion</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>ConfiguracionManager</span> <span class=nf>load</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>l</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>fullName</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;\\.&#34;</span><span class=o>));</span>
        <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>l</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>l</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>-</span> <span class=n>1</span><span class=o>);</span>
        <span class=n>String</span> <span class=n>source</span> <span class=o>=</span> <span class=n>loadSource</span><span class=o>();</span>

        <span class=n>JavaCompiler</span> <span class=n>compiler</span> <span class=o>=</span> <span class=n>ToolProvider</span><span class=o>.</span><span class=na>getSystemJavaCompiler</span><span class=o>();</span>
        <span class=n>JavaFileManager</span> <span class=n>manager</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassFileManager</span><span class=o>(</span><span class=n>compiler</span><span class=o>.</span><span class=na>getStandardFileManager</span><span class=o>(</span><span class=kc>null</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=kc>null</span><span class=o>));</span>

        <span class=n>List</span><span class=o>&lt;</span><span class=n>JavaFileObject</span><span class=o>&gt;</span> <span class=n>files</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>JavaFileObject</span><span class=o>&gt;();</span>
        <span class=n>files</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>CharSequenceJavaFileObject</span><span class=o>(</span><span class=n>fullName</span><span class=o>,</span> <span class=n>source</span><span class=o>));</span>

        <span class=n>compiler</span><span class=o>.</span><span class=na>getTask</span><span class=o>(</span><span class=k>new</span> <span class=n>NullWriter</span><span class=o>(),</span> <span class=n>manager</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=n>files</span><span class=o>).</span><span class=na>call</span><span class=o>();</span>
        <span class=n>configuracion</span> <span class=o>=</span> <span class=o>(</span><span class=n>Configuracion</span><span class=o>)</span> <span class=n>manager</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(</span><span class=kc>null</span><span class=o>).</span><span class=na>loadClass</span><span class=o>(</span><span class=n>fullName</span><span class=o>).</span><span class=na>newInstance</span><span class=o>();</span>

        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>ConfiguracionManager</span> <span class=nf>monitor</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>closed</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>

        <span class=n>Runnable</span> <span class=n>task</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Runnable</span><span class=o>()</span> <span class=o>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
                <span class=k>while</span> <span class=o>(!</span><span class=n>closed</span><span class=o>)</span> <span class=o>{</span>
                    <span class=k>try</span> <span class=o>(</span><span class=n>WatchService</span> <span class=n>watchService</span> <span class=o>=</span> <span class=n>FileSystems</span><span class=o>.</span><span class=na>getDefault</span><span class=o>().</span><span class=na>newWatchService</span><span class=o>())</span> <span class=o>{</span>
                        <span class=n>path</span><span class=o>.</span><span class=na>getParent</span><span class=o>().</span><span class=na>register</span><span class=o>(</span><span class=n>watchService</span><span class=o>,</span> <span class=n>StandardWatchEventKinds</span><span class=o>.</span><span class=na>ENTRY_MODIFY</span><span class=o>);</span>
                        <span class=n>WatchKey</span> <span class=n>watchKey</span> <span class=o>=</span> <span class=n>watchService</span><span class=o>.</span><span class=na>take</span><span class=o>();</span>
                        <span class=k>if</span> <span class=o>(</span><span class=n>watchKey</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
                            <span class=k>return</span><span class=o>;</span>
                        <span class=o>}</span>
                        <span class=k>for</span> <span class=o>(</span><span class=n>WatchEvent</span><span class=o>&lt;?&gt;</span> <span class=n>event</span> <span class=o>:</span> <span class=n>watchKey</span><span class=o>.</span><span class=na>pollEvents</span><span class=o>())</span> <span class=o>{</span>
                            <span class=n>Path</span> <span class=n>p</span> <span class=o>=</span> <span class=o>(</span><span class=n>Path</span><span class=o>)</span> <span class=n>event</span><span class=o>.</span><span class=na>context</span><span class=o>();</span>                         
                            <span class=n>Path</span> <span class=n>pp</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=na>getParent</span><span class=o>().</span><span class=na>resolve</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
                            <span class=k>if</span> <span class=o>(</span><span class=n>path</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>pp</span><span class=o>))</span> <span class=o>{</span>
                                <span class=n>load</span><span class=o>();</span>
                            <span class=o>}</span>
                        <span class=o>}</span>
                    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
                    <span class=o>}</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>};</span>

        <span class=n>thread</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
        <span class=n>thread</span><span class=o>.</span><span class=na>setDaemon</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
        <span class=n>thread</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>

        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>close</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>closed</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=nf>loadSource</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>StringBuffer</span> <span class=n>source</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuffer</span><span class=o>();</span>
        <span class=kt>char</span><span class=o>[]</span> <span class=n>buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=o>[</span><span class=n>128</span> <span class=o>*</span> <span class=n>1024</span><span class=o>];</span>
        <span class=n>Reader</span> <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileReader</span><span class=o>(</span><span class=n>path</span><span class=o>.</span><span class=na>toFile</span><span class=o>());</span>
        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=na>read</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
        <span class=k>while</span> <span class=o>(</span><span class=n>n</span> <span class=o>!=</span> <span class=o>-</span><span class=n>1</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>source</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>buffer</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>n</span><span class=o>);</span>
            <span class=n>n</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=na>read</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=k>return</span> <span class=n>source</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/code/ConfiguracionManager.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2014/09/configuracion-usando-codigo-java/code/ConfiguracionManager.java target=_blank>ConfiguracionManager.java</a></div></div><div class=media style=text-align:center><figure><a href=assets/images/posts/2014/44/main.png title="Salida programa Main.java" data-gallery><img src=assets/images/posts/2014/44/main.png></a></figure></div><p>Esta idea de no utilizar archivos de configuración sino emplear código como la mejor forma y más breve de definirla es algo que hace <a href=https://gradle.org/>gradle</a> con los archivos de configuración del proyecto y <a href=https://tapestry.apache.org/>apache tapestry</a> para definir los módulos y la configuración del contenedor de inversión de control, parece una tendencia por el hecho de tener las propiedades y ventajas comentadas sobre otro tipo de archivos ya sean xml o sus sustitutos más recientes como yaml, json, &hellip; que son más compactos y legibles que xml pero que siguen adoleciendo de algunos de los mismos defectos.</p><p>El código fuente completo puede encontrarse en el <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/ConfiguracionJava>siguiente repositorio de GitHub</a>.</p></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2014/09/monitorizar-archivos-con-java/>Monitorizar archivos con Java</a></li><li><a href=/blog-bitix/2014/09/compilar-y-cargar-de-forma-dinamica-una-clase-java/>Compilar y cargar de forma dinámica una clase Java</a></li><li><a href=/blog-bitix/2014/08/actualizacion-del-libro-plugin-tapestry/>Actualización del libro PlugIn Tapestry</a></li><li><a href=/blog-bitix/2014/08/doble-barra-de-botones-con-apache-tapestry/>Doble barra de botones con Apache Tapestry</a></li><li><a href=/blog-bitix/2014/08/forzar-el-uso-del-protocolo-https-en-apache-tapestry/>Forzar el uso del protocolo https en Apache Tapestry</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2014\/09\/configuracion-usando-codigo-java\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2014\/09\/configuracion-usando-codigo-java\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
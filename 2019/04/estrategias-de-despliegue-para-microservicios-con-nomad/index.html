<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="El ciclo de vida de una aplicación no consiste solo en desarrollarla, incluye también su puesta en producción o despliegue en un entorno de pruebas, pero también una vez la aplicación está desplegada en algún momento será necesario actualizarla con una nueva versión.
Las aplicaciones monolíticas tienen otros problemas pero en el aspecto de despliegue es sencillo ya que solo hay una aplicación, basta con desplegar la nueva versión. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Estrategias de despliegue para microservicios con Nomad</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.2.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery.slim.min','bootstrap':'libs/bootstrap-4.2.1/js/bootstrap.min','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class="col-12 col-lg-8"><div class=row><div class=col-12><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="planeta-codigo, programacion, software"><h1 itemprop=name>Estrategias de despliegue para microservicios con Nomad</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2019-04-18>18/04/2019</time>, actualizado el <time itemprop=dateModified datetime=2019-04-18>18/04/2019</time>.<br><a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/programacion/>programacion</a> <a href=tags/software/>software</a><br><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/#comments>Comentarios</a></p><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div class=content itemprop=articleBody><meta itemprop=wordCount content=1834><div class=logotypes style=float:right><img src=assets/images/logotipos/nomad.svg class=right width=200 alt=Nomad title=Nomad></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/consul.svg class=right width=200 alt=Consul title=Consul></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/hashicorp.svg class=right width=200 alt=HashiCorp title=HashiCorp></div><p>El ciclo de vida de una aplicación no consiste solo en desarrollarla, incluye también su puesta en producción o despliegue en un entorno de pruebas, pero también una vez la aplicación está desplegada en algún momento será necesario actualizarla con una nueva versión.</p><p>Las aplicaciones monolíticas tienen otros problemas pero en el aspecto de despliegue es sencillo ya que solo hay una aplicación, basta con desplegar la nueva versión. En una aplicación con arquitectura de microservicios es un reto mayor debido a que hay múltiples aplicaciones.</p><p>En cualquiera de ellas puede darse el caso de que para ganar en escalabilidad o para aumentar la disponibilidad o tolerancia a fallos es posible que haya varias instancias, las cuales han de ser actualizadas con el requisito si es necesario de que el servicio no deje de prestar su servicio, es decir que el despliegue no suponga una caída del servicio.</p><p>Hay varias estrategias para desplegar una nueva versión de una aplicación:</p><ul><li><em>Rolling update</em>: actualizar todas las instancias de forma progresiva. Una vez se termina de actualizar una se espera un tiempo y se actualiza la siguiente hasta que todas estén actualizadas.</li><li><em>Blue/Green</em>: manteniendo en funcionamiento las instancias con la versión antigua se crea el mismo número de instancias con la nueva versión y se redirige tráfico hacia ellas. Una vez se ha comprobado que la nueva versión funciona correctamente se promociona la nueva versión y se eliminan las instancias de con la versión antigua. Esta estrategia permite volver a la versión anterior rápidamente si se detecta algún problema.</li><li><em>Canary</em>: se siguen manteniendo las instancias con la versión antigua, a diferencia de la estrategia <em>blue/green</em> se crea un número menor de instancias con la versión nueva que el número de instancias con la versión antigua. Una vez comprobado que la nueva versión es correcta se promociona la nueva versión y se actualizan todas las instancias restantes mediante <em>rolling update</em> a la nueva versión. También permite volver a la versión antigua si se detecta algún problema.</li></ul><p><a href=https://docs.docker.com/swarm/>Docker Swarm</a> permite la estrategia de despliegue <em>rolling update</em> sin embargo las estrategias <em>blue/green</em> y <em>canary</em> son interesante para tratar de que un error en una versión nueva no afecte al funcionamiento de la aplicación y obligue hacer un <em>rollback</em> que posiblemente tarde más tiempo durante el cual el servicio funcionará con el defecto descubierto. <a href=https://www.nomadproject.io/>Nomad</a> permite despliegues con las estrategias <em>blue/gree</em> y <em>canary</em>.</p><p>Para actualizar un servicio en Nomad basta con modificar la definición del <em>job</em> y enviarlo a <em>Nomad</em>, y este se encarga de orquestar la actualización en las instancias según la estrategia de despliegue
configurada. En este caso se actualiza la versión de <em>nginx</em> de la versión <em>nginx:stable-alpine</em> a <em>nginx:alpine</em> usando una estrategia <em>rolling update</em> para las cinco instancias del servicio.</p><p>La estrategia de despliegue en <em>Nomad</em> se define en la <a href=https://www.nomadproject.io/docs/job-specification/update.html>sección de configuración <em>update</em></a>. El parámetro <em>min_healthy_time</em> es el tiempo que se espera cuando se hace un <em>rolling update</em> para considerar una instancia como sana y continuar la actualización con la siguiente, <em>max_parallel</em> indica el número de instancias que se migran al mismo tiempo. El parámetro <em>canary</em> indica el número de instancias que se crean en las estrategias <em>blue/green</em> y <em>canary</em>, en la primera el número de instancias coincidirá con el parámetro <em>canary</em> que indica el número de instancias de un servicio. Nomad con los parámetros <em>health_check</em>, <em>min_healthy_time</em>, <em>healthy_deadline</em>, <em>progress_deadline</em>, <em>stagger</em> y <em>auto_revert</em> se puede poner unos límites para considerar válido un despliegue y en caso de no serlo realizar un <em>rollback</em> de forma autmática.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>job &#34;nginx&#34; {
  datacenters = [&#34;localhost&#34;]

  type = &#34;service&#34;

  update {
    stagger      = &#34;30s&#34;
    max_parallel = 1
  }

  group &#34;services&#34; {
    count = 5

    task &#34;nginx&#34; {
      driver = &#34;docker&#34;

      config {
        image = &#34;nginx:stable-alpine&#34;
        port_map {
          http = 80
        }
      }

      resources {
        memory = 1024 # MB

        network {
          port &#34;http&#34; {}
        }
      }
    }
  }
}
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nginx.nomad target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nginx.nomad target=_blank>nginx.nomad</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ nomad job run nginx.nomad

</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-run.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-run.sh target=_blank>nomad-run.sh</a></div></div><p>En el caso de los despliegues <em>blue/green</em> y <em>canary</em> una vez comprobado que la versión de los nuevos servicios funcionan correctamente se promocionan y actualizan el resto de instancias en el caso de <em>canary</em> o se detienen las instancias antiguas en el caso de <em>blue/green</em>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ nomad job promote nginx

</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-promote.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-promote.sh target=_blank>nomad-promote.sh</a></div></div><p>Desde la línea de comandos se puede observar el estado del servicio y el proceso de actualización, el primero es el estado previo a realizar el despliegue, el segundo durante el proceso de actualización con <em>rolling update</em> y el tercero una vez finalizado el proceso de despliegue y marcado como exitoso en el que todas las instancias han pasado de la versión 0 a la 1.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ nomad job status nginx
<span class=nv>ID</span>            <span class=o>=</span> nginx
<span class=nv>Name</span>          <span class=o>=</span> nginx
Submit <span class=nv>Date</span>   <span class=o>=</span> <span class=m>2019</span>-04-18T10:50:11+02:00
<span class=nv>Type</span>          <span class=o>=</span> service
<span class=nv>Priority</span>      <span class=o>=</span> <span class=m>50</span>
<span class=nv>Datacenters</span>   <span class=o>=</span> localhost
<span class=nv>Status</span>        <span class=o>=</span> running
<span class=nv>Periodic</span>      <span class=o>=</span> <span class=nb>false</span>
<span class=nv>Parameterized</span> <span class=o>=</span> <span class=nb>false</span>

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
services    <span class=m>0</span>       <span class=m>0</span>         <span class=m>5</span>        <span class=m>0</span>       <span class=m>0</span>         <span class=m>0</span>

Latest Deployment
<span class=nv>ID</span>          <span class=o>=</span> 67d4497a
<span class=nv>Status</span>      <span class=o>=</span> successful
<span class=nv>Description</span> <span class=o>=</span> Deployment completed successfully

Deployed
Task Group  Desired  Placed  Healthy  Unhealthy  Progress Deadline
services    <span class=m>5</span>        <span class=m>5</span>       <span class=m>5</span>        <span class=m>0</span>          <span class=m>2019</span>-04-18T11:00:22+02:00

Allocations
ID        Node ID   Task Group  Version  Desired  Status   Created  Modified
0bee3ae1  1806498b  services    <span class=m>0</span>        run      running  25s ago  14s ago
295f72ec  1806498b  services    <span class=m>0</span>        run      running  25s ago  14s ago
6b2dcff1  1806498b  services    <span class=m>0</span>        run      running  25s ago  14s ago
94a1a79b  1806498b  services    <span class=m>0</span>        run      running  25s ago  14s ago
f163316f  1806498b  services    <span class=m>0</span>        run      running  25s ago  14s ago

$ nomad alloc status 0bee3ae1
<span class=nv>ID</span>                  <span class=o>=</span> 0bee3ae1
Eval <span class=nv>ID</span>             <span class=o>=</span> 2c63f7a1
<span class=nv>Name</span>                <span class=o>=</span> nginx.services<span class=o>[</span><span class=m>0</span><span class=o>]</span>
Node <span class=nv>ID</span>             <span class=o>=</span> 1806498b
Job <span class=nv>ID</span>              <span class=o>=</span> nginx
Job <span class=nv>Version</span>         <span class=o>=</span> <span class=m>0</span>
Client <span class=nv>Status</span>       <span class=o>=</span> running
Client <span class=nv>Description</span>  <span class=o>=</span> Tasks are running
Desired <span class=nv>Status</span>      <span class=o>=</span> run
Desired <span class=nv>Description</span> <span class=o>=</span> &lt;none&gt;
<span class=nv>Created</span>             <span class=o>=</span> 39s ago
<span class=nv>Modified</span>            <span class=o>=</span> 28s ago
Deployment <span class=nv>ID</span>       <span class=o>=</span> 67d4497a
Deployment <span class=nv>Health</span>   <span class=o>=</span> healthy

Task <span class=s2>&#34;nginx&#34;</span> is <span class=s2>&#34;running&#34;</span>
Task Resources
CPU        Memory            Disk     Addresses
<span class=m>0</span>/100 MHz  <span class=m>1004</span> KiB/1.0 GiB  <span class=m>300</span> MiB  http: <span class=m>127</span>.0.0.1:27902

Task Events:
Started <span class=nv>At</span>     <span class=o>=</span> <span class=m>2019</span>-04-18T08:50:12Z
Finished <span class=nv>At</span>    <span class=o>=</span> N/A
Total <span class=nv>Restarts</span> <span class=o>=</span> <span class=m>0</span>
Last <span class=nv>Restart</span>   <span class=o>=</span> N/A

Recent Events:
Time                       Type        Description
<span class=m>2019</span>-04-18T10:50:12+02:00  Started     Task started by client
<span class=m>2019</span>-04-18T10:50:11+02:00  Task Setup  Building Task Directory
<span class=m>2019</span>-04-18T10:50:11+02:00  Received    Task received by client</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-before.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-before.sh target=_blank>nomad-status-before.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ nomad job status nginx
<span class=nv>ID</span>            <span class=o>=</span> nginx
<span class=nv>Name</span>          <span class=o>=</span> nginx
Submit <span class=nv>Date</span>   <span class=o>=</span> <span class=m>2019</span>-04-18T10:55:59+02:00
<span class=nv>Type</span>          <span class=o>=</span> service
<span class=nv>Priority</span>      <span class=o>=</span> <span class=m>50</span>
<span class=nv>Datacenters</span>   <span class=o>=</span> localhost
<span class=nv>Status</span>        <span class=o>=</span> running
<span class=nv>Periodic</span>      <span class=o>=</span> <span class=nb>false</span>
<span class=nv>Parameterized</span> <span class=o>=</span> <span class=nb>false</span>

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
services    <span class=m>0</span>       <span class=m>0</span>         <span class=m>5</span>        <span class=m>0</span>       <span class=m>1</span>         <span class=m>0</span>

Latest Deployment
<span class=nv>ID</span>          <span class=o>=</span> 8b96049d
<span class=nv>Status</span>      <span class=o>=</span> running
<span class=nv>Description</span> <span class=o>=</span> Deployment is running

Deployed
Task Group  Desired  Placed  Healthy  Unhealthy  Progress Deadline
services    <span class=m>5</span>        <span class=m>1</span>       <span class=m>0</span>        <span class=m>0</span>          <span class=m>2019</span>-04-18T11:05:59+02:00

Allocations
ID        Node ID   Task Group  Version  Desired  Status    Created    Modified
d9e3a0c9  1806498b  services    <span class=m>1</span>        run      running   4s ago     4s ago
0bee3ae1  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  5m53s ago  4s ago
295f72ec  1806498b  services    <span class=m>0</span>        run      running   5m53s ago  5m42s ago
6b2dcff1  1806498b  services    <span class=m>0</span>        run      running   5m53s ago  5m42s ago
94a1a79b  1806498b  services    <span class=m>0</span>        run      running   5m53s ago  5m42s ago
f163316f  1806498b  services    <span class=m>0</span>        run      running   5m53s ago  5m42s ago
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-while.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-while.sh target=_blank>nomad-status-while.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ nomad job status nginx
<span class=nv>ID</span>            <span class=o>=</span> nginx
<span class=nv>Name</span>          <span class=o>=</span> nginx
Submit <span class=nv>Date</span>   <span class=o>=</span> <span class=m>2019</span>-04-18T10:55:59+02:00
<span class=nv>Type</span>          <span class=o>=</span> service
<span class=nv>Priority</span>      <span class=o>=</span> <span class=m>50</span>
<span class=nv>Datacenters</span>   <span class=o>=</span> localhost
<span class=nv>Status</span>        <span class=o>=</span> running
<span class=nv>Periodic</span>      <span class=o>=</span> <span class=nb>false</span>
<span class=nv>Parameterized</span> <span class=o>=</span> <span class=nb>false</span>

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
services    <span class=m>0</span>       <span class=m>0</span>         <span class=m>5</span>        <span class=m>0</span>       <span class=m>5</span>         <span class=m>0</span>

Latest Deployment
<span class=nv>ID</span>          <span class=o>=</span> 8b96049d
<span class=nv>Status</span>      <span class=o>=</span> successful
<span class=nv>Description</span> <span class=o>=</span> Deployment completed successfully

Deployed
Task Group  Desired  Placed  Healthy  Unhealthy  Progress Deadline
services    <span class=m>5</span>        <span class=m>5</span>       <span class=m>5</span>        <span class=m>0</span>          <span class=m>2019</span>-04-18T11:06:59+02:00

Allocations
ID        Node ID   Task Group  Version  Desired  Status    Created    Modified
a6a1423a  1806498b  services    <span class=m>1</span>        run      running   33s ago    22s ago
c529ec57  1806498b  services    <span class=m>1</span>        run      running   45s ago    34s ago
1cda0083  1806498b  services    <span class=m>1</span>        run      running   57s ago    46s ago
aff0eaf9  1806498b  services    <span class=m>1</span>        run      running   1m9s ago   58s ago
d9e3a0c9  1806498b  services    <span class=m>1</span>        run      running   1m21s ago  1m11s ago
6b2dcff1  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  7m10s ago  1m9s ago
94a1a79b  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  7m10s ago  44s ago
0bee3ae1  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  7m10s ago  1m21s ago
295f72ec  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  7m10s ago  32s ago
f163316f  1806498b  services    <span class=m>0</span>        stop     <span class=nb>complete</span>  7m10s ago  57s ago
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-after.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-status-after.sh target=_blank>nomad-status-after.sh</a></div></div><p>El proceso de despliegue también se puede monitorizar desde la interfaz web que ofrece Nomad.</p><div class=media style=text-align:center><figure><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-before_hu67a332684efae6ed992319050f36f296_119290_2560x1440_fit_box_2.png title="Antes del proceso de despliegue rolling update en Nomad" data-gallery><img src=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-before_hu67a332684efae6ed992319050f36f296_119290_300x200_fit_box_2.png width=196></a>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-while_hu1bb43ff17075cacd6588f52ea91a2b44_119731_2560x1440_fit_box_2.png title="Durante el proceso de despliegue rolling update en Nomad" data-gallery><img src=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-while_hu1bb43ff17075cacd6588f52ea91a2b44_119731_300x200_fit_box_2.png width=196></a>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-after_hu07bde1516a5a8318da3a99b05cb30d02_122603_2560x1440_fit_box_2.png title="Después del proceso de despliegue rolling update en Nomad" data-gallery><img src=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/images/nomad-rolling-update-after_hu07bde1516a5a8318da3a99b05cb30d02_122603_300x200_fit_box_2.png width=196></a><figcaption>Proceso de despliegue rolling update en Nomad</figcaption></figure></div><p>En este ejemplo los servicios están en contenedores docker, también se observa que la versión de los contenedores en ejecución pasan de la versión <em>stable-alpine</em> a <em>alpine</em>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ docker ps
CONTAINER ID        IMAGE                 COMMAND                  CREATED              STATUS              PORTS                                              NAMES
8d09e91f7306        nginx:stable-alpine   <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>53</span> seconds ago       Up <span class=m>52</span> seconds       <span class=m>127</span>.0.0.1:20093-&gt;80/tcp, <span class=m>127</span>.0.0.1:20093-&gt;80/udp   nginx-e974a9c1-0d6b-4d4b-59e7-c86570260509
fa53aa43eccc        nginx:stable-alpine   <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   About a minute ago   Up About a minute   <span class=m>127</span>.0.0.1:31503-&gt;80/tcp, <span class=m>127</span>.0.0.1:31503-&gt;80/udp   nginx-3014056a-a8a5-e63c-c6e6-e9c2e9cafde1
12f482b6fe67        nginx:stable-alpine   <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   About a minute ago   Up About a minute   <span class=m>127</span>.0.0.1:22122-&gt;80/tcp, <span class=m>127</span>.0.0.1:22122-&gt;80/udp   nginx-a55d7647-a48e-eace-c40f-b2a9abd0ad17
3d09a4329279        nginx:stable-alpine   <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   About a minute ago   Up About a minute   <span class=m>127</span>.0.0.1:24899-&gt;80/tcp, <span class=m>127</span>.0.0.1:24899-&gt;80/udp   nginx-d682548a-d3d3-bddb-2cd8-cfe489a492b3
24e70fe9443a        nginx:stable-alpine   <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   About a minute ago   Up About a minute   <span class=m>127</span>.0.0.1:20772-&gt;80/tcp, <span class=m>127</span>.0.0.1:20772-&gt;80/udp   nginx-99dab397-69fd-97b0-6507-39195931031c</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/docker-ps-before.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/docker-ps-before.sh target=_blank>docker-ps-before.sh</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                              NAMES
0495fd1b6261        nginx:alpine        <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>6</span> minutes ago       Up <span class=m>6</span> minutes        <span class=m>127</span>.0.0.1:27703-&gt;80/tcp, <span class=m>127</span>.0.0.1:27703-&gt;80/udp   nginx-a6a1423a-896d-5716-34bc-533630f45c93
ecb361f99b57        nginx:alpine        <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>6</span> minutes ago       Up <span class=m>6</span> minutes        <span class=m>127</span>.0.0.1:23859-&gt;80/tcp, <span class=m>127</span>.0.0.1:23859-&gt;80/udp   nginx-c529ec57-ff92-73ae-6e68-46a2d5c55bed
82429bac4974        nginx:alpine        <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>6</span> minutes ago       Up <span class=m>6</span> minutes        <span class=m>127</span>.0.0.1:27878-&gt;80/tcp, <span class=m>127</span>.0.0.1:27878-&gt;80/udp   nginx-1cda0083-9fa0-6e6d-5276-ab0bd1de8762
69cbf7fd37d8        nginx:alpine        <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>7</span> minutes ago       Up <span class=m>7</span> minutes        <span class=m>127</span>.0.0.1:24634-&gt;80/tcp, <span class=m>127</span>.0.0.1:24634-&gt;80/udp   nginx-aff0eaf9-a099-42fd-58ea-4603f96ccd3f
4935502d58ce        nginx:alpine        <span class=s2>&#34;nginx -g &#39;daemon of…&#34;</span>   <span class=m>7</span> minutes ago       Up <span class=m>7</span> minutes        <span class=m>127</span>.0.0.1:22657-&gt;80/tcp, <span class=m>127</span>.0.0.1:22657-&gt;80/udp   nginx-d9e3a0c9-82bd-8b19-14a7-0a663f539c00</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/docker-ps-after.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/docker-ps-after.sh target=_blank>docker-ps-after.sh</a></div></div><p>Nomad y <a href=https://www.consul.io/>Consul</a> se inician con los siguientes comandos en modo desarrollo comentados en el artículo <a href=https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/>Introducción a Nomad para gestionar aplicaciones y microservicios</a>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Bash data-lang=Bash>$ consul agent -dev -datacenter localhost
$ sudo nomad agent -dev -dc localhost</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-consul.sh target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/code/nomad-consul.sh target=_blank>nomad-consul.sh</a></div></div></div></article></div></div><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/>Introducción a Nomad para gestionar aplicaciones y microservicios</a></li><li><a href=/blog-bitix/2019/02/servidor-oauth-gateway-y-servicio-rest-utilizando-tokens-jwt-con-spring/>Servidor OAuth, gateway y servicio REST utilizando tokens JWT con Spring</a></li><li><a href=/blog-bitix/2018/12/hemeroteca-14/>Hemeroteca #14</a></li><li><a href=/blog-bitix/2018/12/exponer-las-metricas-de-hystrix-en-grafana-con-prometheus-de-una-aplicacion-spring-boot/>Exponer las métricas de Hystrix en Grafana con Prometheus de una aplicación Spring Boot</a></li><li><a href=/blog-bitix/2018/12/monitorizar-una-aplicacion-java-de-spring-boot-con-micrometer-prometheus-y-grafana/>Monitorizar una aplicación Java de Spring Boot con Micrometer, Prometheus y Grafana</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2019\/04\/estrategias-de-despliegue-para-microservicios-con-nomad\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2019\/04\/estrategias-de-despliegue-para-microservicios-con-nomad\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div><div class="col-12 col-lg-4"><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class=row><div class="col-md-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class="row text-center banner"><div class=col-12><a href=https://picodotdev.github.io/blog-bitix/2015/12/yo-apoyo-al-software-libre-tu-tambien/><img src=assets/images/i-support-fs_red-bg-es.png alt="Yo apoyo al software libre"></a></div></div><div class=row><div class=col-md-12><hr></div></div><div class=row><div class=col-md-12><ul class="list-unstyled recents"><li><span class="glyphicon glyphicon-hand-right"></span><a href=archive/>Más artículos recientes en el archivo</a></li></ul></div></div></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
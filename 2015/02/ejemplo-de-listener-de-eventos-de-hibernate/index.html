<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="En alguna ocasión puede que tengamos la necesidad de realizar alguna acción cuando una entidad es guardada en base de datos, actualizada, eliminada, cargada, &hellip; . Algunos casos de uso pueden ser:
 Establecer la fecha de creación o de actualización del objeto cuando es persistido en base de datos. Cifrar un dato del objeto al ser persistido en base de datos. Proporcionar seguridad de modo que un usuario solo pueda modificar o acceder a los objetos a los que tenga acceso. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Ejemplo de listener de eventos de Hibernate</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.3.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script type=text/javascript src=assets/js/require-config.js data-main=js/main defer></script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-left"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><div class="adblock-sidebar adblock-sidebar-right"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="blog-stack, java, planeta-codigo, programacion"><h1 itemprop=name>Ejemplo de listener de eventos de Hibernate</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2015-02-20>20/02/2015</time>, actualizado el <time itemprop=dateModified datetime=2015-02-21>21/02/2015</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/programacion/>programacion</a><br><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/#comments>Comentarios</a></p><div><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=1388><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>En alguna ocasión puede que tengamos la necesidad de realizar alguna acción cuando una entidad es guardada en base de datos, actualizada, eliminada, cargada, &hellip; . Algunos casos de uso pueden ser:</p><ul><li>Establecer la fecha de creación o de actualización del objeto cuando es persistido en base de datos.</li><li>Cifrar un dato del objeto al ser persistido en base de datos.</li><li>Proporcionar seguridad de modo que un usuario solo pueda modificar o acceder a los objetos a los que tenga acceso.</li><li>Al persistir el objeto guardar en un campo el valor calculado resultado de una función.</li><li>Cualquier otra restricción, cálculos o acciones.</li></ul><p>Para realizar estas operaciones podemos hacerlas de varias formas, una puede ser usando <em>triggers</em> de la base de datos disponibles en <a href=https://www.oracle.com/database/>Oracle</a> y <a href=https://www.postgresql.org/>PostgreSQL</a>. Si usamos <a href=https://hibernate.org/>Hibernate</a> como librería ORM de persistencia en una aplicación el equivalente a los <em>triggers</em> de BBDD es mediante un <em>listener</em> que sea llamado al ocurrir ciertos eventos. En la clase <a href=https://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/event/spi/EventType.html><em>EventType</em></a> está la lista completa de los eventos que podemos recibir y la clase <em>listener</em> que debemos implementar para recibir cada uno de los eventos. Esta es la lista de los eventos disponibles según los conceptos que usa Hibernate:</p><ul><li>AUTO_FLUSH</li><li>CLEAR</li><li>DELETE</li><li>DIRTY_CHECK</li><li>EVICT</li><li>FLUSH</li><li>FLUSH_ENTITY</li><li>INIT_COLLECTION</li><li>LOAD</li><li>LOCK</li><li>MERGE</li><li>PERSIST</li><li>PERSIST_ONFLUSH</li><li>POST_COLLECTION_RECREATE</li><li>POST_COLLECTION_REMOVE</li><li>POST_COLLECTION_UPDATE</li><li>POST_COMMIT_DELETE</li><li>POST_COMMIT_INSERT</li><li>POST_COMMIT_UPDATE</li><li>POST_DELETE</li><li>POST_INSERT</li><li>POST_LOAD</li><li>POST_UPDATE</li><li>PRE_COLLECTION_RECREATE</li><li>PRE_COLLECTION_REMOVE</li><li>PRE_COLLECTION_UPDATE</li><li>PRE_DELETE</li><li>PRE_INSERT</li><li>PRE_LOAD</li><li>PRE_UPDATE</li><li>REFRESH</li><li>REPLICATE</li><li>RESOLVE_NATURAL_ID</li><li>SAVE</li><li>SAVE_UPDATE</li><li>UPDATE</li></ul><p>Con estos eventos podemos ser notificados de muchas cosas que suceden internamente en Hibernate en algunos casos antes y/o después del evento. En JPA se dispone de varias anotaciones (@PreInsert, @PostInsert, &hellip;) con las que podemos marcar un determinado método como <em>listener</em> de un evento pero no funcionan si usamos únicamente Hibernate.</p><p>En este artículo explicaré como implementar un <em>listener</em> de ejemplo que reciba parte de estos eventos usando solo Hibernate. Primeramente e importante, debemos tener en cuenta que el proceso como reacción a uno de estos eventos ha de ser muy ligero y tardar poco tiempo ya que algunos eventos son lanzados por cada instancia de entidad como consecuencia de operaciones muy frecuentes en una aplicación, si tardasen mucho o consumiesen mucha memoria o tiempo de procesador probablemente el rendimiento de la aplicación disminuiría notablemente.</p><p>Como se ve en la clase <a href=https://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/event/spi/EventType.html>EventType</a> cada evento tiene un <em>listener</em> distinto, para evitar crear una clase diferente por cada <em>listener</em> podemos emplear el <a href=https://es.wikipedia.org/wiki/Adapter_%28patr%C3%B3n_de_dise%C3%B1o%29>patrón de diseño <em>Adapter</em></a> de forma que implemente las diferentes interfaces en las que estamos interesados. La implementación de la clase <em>Adapter</em> y una implementación de esta clase <em>Adapter</em> si nos interesasen los eventos PRE_INSERT, PRE_UPDATE, PRE_DELETE, POST_INSERT, POST_UPDATE, POST_DELETE sería la siguiente:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.hibernate</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostDeleteEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostDeleteEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostInsertEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostInsertEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostUpdateEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostUpdateEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreDeleteEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreDeleteEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreInsertEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreInsertEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreUpdateEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreUpdateEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.persister.entity.EntityPersister</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HibernateEventAdapter</span> <span class=kd>implements</span> <span class=n>PreInsertEventListener</span><span class=o>,</span> <span class=n>PostInsertEventListener</span><span class=o>,</span> <span class=n>PreUpdateEventListener</span><span class=o>,</span> <span class=n>PostUpdateEventListener</span><span class=o>,</span> <span class=n>PreDeleteEventListener</span><span class=o>,</span>
        <span class=n>PostDeleteEventListener</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>long</span> <span class=n>serialVersionUID</span> <span class=o>=</span> <span class=n>1L</span><span class=o>;</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>requiresPostCommitHanding</span><span class=o>(</span><span class=n>EntityPersister</span> <span class=n>persister</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostDelete</span><span class=o>(</span><span class=n>PostDeleteEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreDelete</span><span class=o>(</span><span class=n>PreDeleteEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostUpdate</span><span class=o>(</span><span class=n>PostUpdateEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreUpdate</span><span class=o>(</span><span class=n>PreUpdateEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostInsert</span><span class=o>(</span><span class=n>PostInsertEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreInsert</span><span class=o>(</span><span class=n>PreInsertEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/HibernateEventAdapter.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/HibernateEventAdapter.java target=_blank>HibernateEventAdapter.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.hibernate</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostDeleteEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostInsertEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PostUpdateEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreDeleteEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreInsertEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.PreUpdateEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.spring.DummyService</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ProductoEventAdapter</span> <span class=kd>extends</span> <span class=n>HibernateEventAdapter</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>long</span> <span class=n>serialVersionUID</span> <span class=o>=</span> <span class=n>1L</span><span class=o>;</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>DummyService</span> <span class=n>dummy</span><span class=o>;</span>
    
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setDummy</span><span class=o>(</span><span class=n>DummyService</span> <span class=n>dummy</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>dummy</span> <span class=o>=</span> <span class=n>dummy</span><span class=o>;</span>      
    <span class=o>}</span>
    
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostDelete</span><span class=o>(</span><span class=n>PostDeleteEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;postDelete&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreDelete</span><span class=o>(</span><span class=n>PreDeleteEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;preDelete&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostUpdate</span><span class=o>(</span><span class=n>PostUpdateEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;postUpdate&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreUpdate</span><span class=o>(</span><span class=n>PreUpdateEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;preUpdate&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onPostInsert</span><span class=o>(</span><span class=n>PostInsertEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;postInsert&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onPreInsert</span><span class=o>(</span><span class=n>PreInsertEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>dummy</span><span class=o>.</span><span class=na>process</span><span class=o>(</span><span class=s>&#34;preInsert&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>.</span><span class=na>getEntity</span><span class=o>());</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/ProductoEventAdapter.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/ProductoEventAdapter.java target=_blank>ProductoEventAdapter.java</a></div></div><p>Una vez que tenemos la clase que va a recibir los eventos para que Hibernate la use debemos crear un <a href=http://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/integrator/spi/Integrator.html>Integrator</a> que lo instanciará y la dará a conocer a Hibernate. En el siguiente código puede verse una implementación de un Integrator de Hibernate, en el se instancia el <em>listener</em> y se asocia a los diferentes eventos. En este caso solo se crea un <em>listener</em> pero perfectamente podríamos asociar varios <em>listeners</em> al mismo evento:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.hibernate</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.hibernate.cfg.Configuration</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.engine.spi.SessionFactoryImplementor</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.service.spi.EventListenerRegistry</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.event.spi.EventType</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.integrator.spi.Integrator</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.metamodel.source.MetadataImplementor</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.hibernate.service.spi.SessionFactoryServiceRegistry</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.spring.DummyService</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HibernateIntegrator</span> <span class=kd>implements</span> <span class=n>Integrator</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>integrate</span><span class=o>(</span><span class=n>Configuration</span> <span class=n>configuration</span><span class=o>,</span> <span class=n>SessionFactoryImplementor</span> <span class=n>sessionFactory</span><span class=o>,</span> <span class=n>SessionFactoryServiceRegistry</span> <span class=n>serviceRegistry</span><span class=o>)</span> <span class=o>{</span>
        <span class=c1>// As you might expect, an EventListenerRegistry is the place with which event listeners are registered. It is a service
</span><span class=c1></span>        <span class=c1>// so we look it up using the service registry
</span><span class=c1></span>        <span class=kd>final</span> <span class=n>EventListenerRegistry</span> <span class=n>eventListenerRegistry</span> <span class=o>=</span> <span class=n>serviceRegistry</span><span class=o>.</span><span class=na>getService</span><span class=o>(</span><span class=n>EventListenerRegistry</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

        <span class=n>ProductoEventAdapter</span> <span class=n>pea</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ProductoEventAdapter</span><span class=o>();</span>
        <span class=n>pea</span><span class=o>.</span><span class=na>setDummy</span><span class=o>(</span><span class=k>new</span> <span class=n>DummyService</span><span class=o>());</span>
        
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>PRE_INSERT</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>PRE_UPDATE</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>PRE_DELETE</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>POST_INSERT</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>POST_UPDATE</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
        <span class=n>eventListenerRegistry</span><span class=o>.</span><span class=na>setListeners</span><span class=o>(</span><span class=n>EventType</span><span class=o>.</span><span class=na>POST_INSERT</span><span class=o>,</span> <span class=n>pea</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>integrate</span><span class=o>(</span><span class=n>MetadataImplementor</span> <span class=n>metadata</span><span class=o>,</span> <span class=n>SessionFactoryImplementor</span> <span class=n>sessionFactory</span><span class=o>,</span> <span class=n>SessionFactoryServiceRegistry</span> <span class=n>serviceRegistry</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>disintegrate</span><span class=o>(</span><span class=n>SessionFactoryImplementor</span> <span class=n>sessionFactory</span><span class=o>,</span> <span class=n>SessionFactoryServiceRegistry</span> <span class=n>serviceRegistry</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/HibernateIntegrator.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/HibernateIntegrator.java target=_blank>HibernateIntegrator.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.services.spring</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>es.com.blogspot.elblogdepicodev.plugintapestry.entities.Producto</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DummyService</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>process</span><span class=o>(</span><span class=n>String</span> <span class=n>action</span><span class=o>,</span> <span class=n>Object</span> <span class=n>entity</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>entity</span> <span class=k>instanceof</span> <span class=n>Producto</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>Producto</span> <span class=n>p</span> <span class=o>=</span> <span class=o>(</span><span class=n>Producto</span><span class=o>)</span> <span class=n>entity</span><span class=o>;</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Action: %s, Id: %d&#34;</span><span class=o>,</span> <span class=n>action</span><span class=o>,</span> <span class=n>p</span><span class=o>.</span><span class=na>getId</span><span class=o>()));</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/DummyService.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/DummyService.java target=_blank>DummyService.java</a></div></div><p>Finalmente, para que Hibernate conozca la existencia de este Integrator debemos crear un archivo que contenga el nombre completo de la clase <em>Integrator</em>. El archivo ha de estar en de un librería .jar en la ubicación <em>/META-INF/services/org.hibernate.integrator.spi.Integrator</em> y disponible en el classpath. El contenido de este archivo para el ejemplo es:</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>es.com.blogspot.elblogdepicodev.plugintapestry.services.hibernate.HibernateIntegrator
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/Integrator target=_blank>view raw</a></span>
<a href=/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/code/Integrator target=_blank>Integrator</a></div></div><p>Con esto ya recibiremos los eventos cuando ocurran. En el ejemplo aparecerá en la consola los mensajes cuando se inserte, actualice o elimine una fila de base de datos. En las capturas de imagen se muestran las trazas de una inserción, una traza para la preinseción <em>Action: preInsert, Id: null</em> donde se ve que la entidad no tienen identificativo asignado y otra traza después de la inserción <em>Action: postInsert, Id: 1</em> donde la entidad ya tiene identificativo asignado y la sentencia SQL se ha ejecutado, como se ve en la captura los mensajes salen antes y después de ejecutarse la sentencia SQL que se envía a la base de datos.</p><div class=media style=text-align:center><figure><a href=assets/images/posts/2015/68/aplicacion.png title="Creando un registro en la base de datos" data-gallery><img src=assets/images/posts/2015/68/aplicacion-thumb.png></a>
<a href=assets/images/posts/2015/68/consola.png title="Trazas de ejecución del listener" data-gallery><img src=assets/images/posts/2015/68/consola-thumb.png></a></figure></div><p>Otra implementación distinta a la expuesta en este artículo es con anotaciones tal y como hace JPA, podríamos hacer una implementación de <em>listener</em> que busque una anotación en la entidad y llame a ese método cuando se produzca el evento. Depende de como prefiramos organizar el código, si preferimos tener el código del <em>listener</em> separado de la entidad o todo el código en la propia entidad.</p><p>Esto así puede servirnos pero si el <em>listeners</em> es más complejo debamos hacer uso de un servicio de <a href=https://spring.io/>Spring</a>, en el ejemplo mostrado se usa la clase <em>DummyService.java</em> que es instanciada por <em>HibernateIntegrator.java</em> e inyectada en la clase adaptador <em>ProductoEventAdapter.java</em>. En el siguiente artículo explicaré lo que debemos hacer para <a href=https://picodotdev.github.io/blog-bitix/2015/02/ejemplo-de-listener-de-eventos-de-hibernate/>crear un <em>listener</em> de Hibernate que use servicios de Spring</a> e inyecte dependencias de otros servicios, de esta forma el listener o adaptador podrá usar todas las funcionalidades de los servicios disponibles en el contenedor IoC de Spring.</p><p>El <a href=https://github.com/picodotdev/elblogdepicodev/tree/master/PlugInTapestry>código fuente completo del ejemplo</a> lo puedes encontrar en mi <a href=https://github.com/picodotdev/>repositorio de GitHub</a>.</p><div class=reference>Referencia:<br><ul><li><a href=http://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html_single/>Documentación hibernate</a></li><li><a href=http://docs.jboss.org/hibernate/orm/3.6/reference/es-ES/html/events.html>Interceptores y eventos</a></li><li><a href=http://docs.jboss.org/hibernate/orm/4.3/devguide/en-US/html_single/#d5e2282>Special service registries</a></li><li><a href=http://planet.jboss.org/post/event_listener_registration>Event Listener Registration</a></li><li><a href="http://cursohibernate.es/doku.php?id=unidades:06_objetos_validaciones:04_listeners">Listeners y reglas de negocio</a></li></ul></div></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2015/02/la-palabra-clave-assert-de-java-y-un-ejemplo/>La palabra clave assert de Java y un ejemplo</a></li><li><a href=/blog-bitix/2015/01/convertir-fechas-y-husos-horarios-en-java/>Convertir fechas y husos horarios en Java</a></li><li><a href=/blog-bitix/2015/01/como-hacer-un-substring-de-una-cadena-html/>Cómo hacer un substring de una cadena HTML</a></li><li><a href=/blog-bitix/2014/12/ejercicios-katas-para-mejorar-habilidades-de-programacion-practicando/>Ejercicios (katas) para mejorar habilidades de programación practicando</a></li><li><a href=/blog-bitix/2014/12/8-plus-libros-para-mejorar-como-programadores/>8&#43; libros para mejorar como programadores</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/02\/ejemplo-de-listener-de-eventos-de-hibernate\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2015\/02\/ejemplo-de-listener-de-eventos-de-hibernate\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
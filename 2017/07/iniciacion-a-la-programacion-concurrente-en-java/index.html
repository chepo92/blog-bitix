<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Java proporciona en su API numerosas primitivas para realizar programación concurrente. La programación concurrente permite realizar varias tareas simultáneamente aprovechando los múltiples núcleos de los procesadores modernos con un tiempo de ejecución total para un conjunto de tareas significativamente menor. Dos de los problemas de concurrencia más conocidos son el problema de los filósofos y del barbero que en este artículo muestro como implementar usando varias de las primitivas ofrecidas por Java. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Iniciación a la programación concurrente en Java</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.2.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript defer>var require={baseUrl:'assets',paths:{'jquery':'libs/jquery.slim.min','bootstrap':'libs/bootstrap-4.2.1/js/bootstrap.min','blueimp-helper':'libs/Gallery-2.33.0/js/blueimp-helper','blueimp-gallery':'libs/Gallery-2.33.0/js/blueimp-gallery','blueimp-gallery-indicator':'libs/Gallery-2.33.0/js/blueimp-gallery-indicator','blueimp-gallery-video':'libs/Gallery-2.33.0/js/blueimp-gallery-video','blueimp-gallery-vimeo':'libs/Gallery-2.33.0/js/blueimp-gallery-vimeo','blueimp-gallery-youtube':'libs/Gallery-2.33.0/js/blueimp-gallery-youtube','jquery-blueimp-gallery':'libs/Gallery-2.33.0/js/jquery.blueimp-gallery'},shim:{'jquery':{exports:'jquery'},'blueimp-gallery':{exports:'blueimp'}}};</script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><div><ins class=adsbygoogle style=display:inline-block;width:300px;height:600px data-ad-client=ca-pub-3533636310991304 data-ad-slot=9559414587 data-type=large-skycraper></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><ins class=adsbygoogle style=display:inline-block;width:336px;height:280px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2873752587 data-type=large-rectangle></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="blog-stack, java, planeta-codigo, programacion"><h1 itemprop=name>Iniciación a la programación concurrente en Java</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2017-07-15>15/07/2017</time>.<br><a href=tags/blog-stack/>blog-stack</a> <a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/programacion/>programacion</a><br><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/#comments>Comentarios</a></p><p class=summary itemprop=about>Java proporciona en su API numerosas primitivas para realizar programación concurrente. La programación concurrente permite realizar varias tareas simultáneamente aprovechando los múltiples núcleos de los procesadores modernos con un tiempo de ejecución total para un conjunto de tareas significativamente menor. Dos de los problemas de concurrencia más conocidos son el problema de los filósofos y del barbero que en este artículo muestro como implementar usando varias de las primitivas ofrecidas por Java.</p><div class=ad><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=2522><div class=logotypes style=float:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>En todo el tiempo que llevo programando en Java no he tenido necesidad de conocer en detalle las primitivas de concurrencia que ofrece el lenguaje y la API. Java desde sus primeras versiones ya ofrecía el soporte básico para la programación concurrente con las clases <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html>Thread</a> y <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html>Runnable</a> y algunas primitivas de sincronización como la palabra clave reservada <em>syncrhonized</em>, los <em>locks</em> intrínsecos de los objetos y algunos métodos de la clase <em>Thread</em> como <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#sleep-long->sleep</a>, <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-->wait</a> y <a href=https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#join-->join</a>. Entre la documentación de Java está el siguiente <a href=https://docs.oracle.com/javase/tutorial/essential/concurrency/>tutorial sobre la concurrencia en Java</a> que es muy recomendable leer.</p><p>Las computadoras realizan varias tareas de forma concurrente con la ayuda del sistema operativo que permite compartir el procesador para realizar diferentes tareas (navegar por internet, editar un documento, escuchar música, &hellip;) cambiando cada muy poco tiempo (medido en ms) entre procesos, con los procesadores de varios núcleos las tareas se ejecutan silmultáneamente en diferentes núcleos. Los <em>threads</em> en Java se comunican principalmente compartiendo referencias a objetos, este tipo de comunicación es eficiente pero posibilita dos tipos de errores, interferencias entre <em>threads</em> y errores de consistencia, la herramienta para evitarlos es la sincronización. Sin embargo, la sincronización introduce contención cuando dos o más hilos intentan acceder al mismo recurso simultáneamente y provocan una pérdida de rendimiento. El bloqueo mutuo o <em>deadlock</em>, la inanición o <em>starvation</em> y un bloqueo vivo o <em>livelock</em> son problemas de la sincronización. Seguramente te suenen los objetos inmutables, en la programación concurrente son especialmente útiles dado que su estado no cambia y no pueden corromperse ni quedar en un estado inconsistente por la interferencia entre <em>threads</em> evitando de esta manera errores que suelen ser difíciles de depurar por ofrecer un comportamiento errático.</p><p>En vez de usar los <em>locks</em> implícitos de los objetos la API de Java para concurrencia ofrece varios tipos más con propiedades adicionales como la habilidad de salir si el intento de adquirir el <em>lock</em> falla. En el paquete <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/package-summary.html>java.util.concurrent.locks</a> está listados. Otro tipo de primitivas de sincronización para <em>threads</em> son los <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Semaphore.html>Semaphore</a>, <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CyclicBarrier.html>CyclicBarrier</a> y <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CountDownLatch.html>CountDownLatch</a> entre otros como <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Phaser.html>Phaser</a> y <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html>Exchanger</a>. En el paquete <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html>java.util.concurrent.atomic</a> hay varios tipos de datos básicos que realizan sus operaciones de forma atómica como por ejemplo contadores.</p><p>Con los <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html>Executors</a> y <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html>ExecutorService</a> no hace falta que manejemos los hilos a bajo nivel, es posible obtener un <em>pool</em> de <em>threads</em> de una tamaño específico y enviar clases <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html>Callable</a> o <em>Runnable</em> que devuelven un resultado para que se ejecuten con un <em>thread</em> del <em>pool</em> cuando esté libre. Con la clase <a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html>ScheduledExecutorService</a> se programa la ejecución de tareas de forma periódica. En los <em>streams</em> añadidos a Java 8 el procesamiento se puede realizar de forma paralela aprovechando los microprocesadores multinúcleo sin tener que usar de forma explícita ninguna de las utilidades anteriores, internamente usa el <em>Fork/Join</em>.</p><p>El soporte para la programación concurrente ofrecido en Java es suficiente para la mayoría de tareas que podamos necesitar y ha mejorado bastante desde las primeras versiones.</p><p>El primer ejemplo que muestro es usando concurrencia ejecutar varias tareas y como realizándolas de forma secuencial el tiempo total empleado es la suma del tiempo de las tareas individuales y como usando concurrencia es la suma de la tarea que más tarda. El ejemplo se trata de 8 tareas que de forma secuencial tardan aproximadamente 24 segundos ya que cada tarea emplea 3 segundos, en el caso empleando concurrencia el tiempo es de aproximadamente 6 segundos ya se se emplea en <em>pool</em> de <em>threads</em> de 4 de capacidad con lo que las primeras 4 tareas tardan 3 segundos y el siguiente lote de 4 tareas tarda otros 3 segundos para un total de 6 segundos.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.threadpool</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.UUID</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.*</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>Main</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Callable</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;&gt;</span> <span class=n>tasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>();</span>
        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>8</span><span class=o>;</span> <span class=o>++</span><span class=n>i</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>newTask</span><span class=o>());</span>
        <span class=o>}</span>

        <span class=o>{</span>
            <span class=kt>long</span> <span class=n>start</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Executing secuential...&#34;</span><span class=o>);</span>

            <span class=n>List</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;</span> <span class=n>results</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
            <span class=k>for</span> <span class=o>(</span><span class=n>Callable</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;</span> <span class=n>task</span> <span class=o>:</span> <span class=n>tasks</span><span class=o>)</span> <span class=o>{</span>
                 <span class=n>UUID</span> <span class=n>uuid</span> <span class=o>=</span> <span class=n>task</span><span class=o>.</span><span class=na>call</span><span class=o>();</span>
                <span class=n>results</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>uuid</span><span class=o>);</span>
            <span class=o>};</span>
            <span class=k>for</span><span class=o>(</span><span class=n>UUID</span> <span class=n>uuid</span> <span class=o>:</span> <span class=n>results</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>uuid</span><span class=o>);</span>
            <span class=o>}</span>

            <span class=kt>long</span> <span class=n>end</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Secuential time ({} ms)...&#34;</span><span class=o>,</span> <span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=o>);</span>
        <span class=o>}</span>

        <span class=o>{</span>
            <span class=kt>long</span> <span class=n>start</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Executing concurrent...&#34;</span><span class=o>);</span>

            <span class=n>ExecutorService</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=n>4</span><span class=o>);</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>Future</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;&gt;</span> <span class=n>results</span> <span class=o>=</span> <span class=n>executor</span><span class=o>.</span><span class=na>invokeAll</span><span class=o>(</span><span class=n>tasks</span><span class=o>);</span>
            <span class=n>executor</span><span class=o>.</span><span class=na>shutdown</span><span class=o>();</span>
            <span class=k>for</span><span class=o>(</span><span class=n>Future</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;</span> <span class=n>uuid</span> <span class=o>:</span> <span class=n>results</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>uuid</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
            <span class=o>}</span>

            <span class=kt>long</span> <span class=n>end</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Concurrent time ({} ms)...&#34;</span><span class=o>,</span> <span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Callable</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;</span> <span class=nf>newTask</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>Callable</span><span class=o>&lt;</span><span class=n>UUID</span><span class=o>&gt;()</span> <span class=o>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=n>UUID</span> <span class=nf>call</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
                <span class=n>UUID</span> <span class=n>uuid</span> <span class=o>=</span> <span class=n>UUID</span><span class=o>.</span><span class=na>randomUUID</span><span class=o>();</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Starting task {}&#34;</span><span class=o>,</span> <span class=n>uuid</span><span class=o>);</span>
                <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>3000</span><span class=o>);</span>
                <span class=k>return</span> <span class=n>uuid</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>};</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Main.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Main.java target=_blank>Main.java</a></div></div><div class=media style=text-align:center><figure><script type=text/javascript src=https://asciinema.org/a/129084.js id=asciicast-129084 async></script><noscript><a href=https://asciinema.org/a/129084 target=_blank><img src=https://asciinema.org/a/129084.png width=734></a></noscript><figcaption>Ejecución secuencial y concurrente de tareas</figcaption></figure></div><p>Dos de los problemas más conocidos en la programación concurrente son el de <a href=https://es.wikipedia.org/wiki/Problema_de_la_cena_de_los_fil%C3%B3sofos>La cena de los filósofos</a> y el de <a href=https://es.wikipedia.org/wiki/Problema_del_barbero_durmiente>El barbero durmiente</a>. Usando algunas de las primitivas comentadas en este artículo este sería el código para para resolver ambos problemas en Java.</p><p>En este código del problema de los filósofos la clase <em>Table</em> crea los filósofos asignándoles los <em>Fork</em> que tienen que compartir para comer después de estar un tiempo pensando. En la ejecución se observa que el primer filósofo que intenta comer puede hacerlo ya que sus tenedores adyacentes está libres pero posteriormente se observa que en algunas ocasiones algún filósofo no puede hacerlo porque sus tenedores están siendo usados por alguno de sus compañeros adyacentes.</p><div class="alert alert-warning"><p>Esta implementación de los filósofos no es del todo correcta debido a que un filósofo podría quedarse sin comer o quedarse sin comer duramente mucho tiempo. En el artículo <a href=https://picodotdev.github.io/blog-bitix/2018/02/el-problema-de-concurrencia-de-la-cena-de-los-filosofos-resuelto-con-java/>El problema de concurrencia de la cena de los filósofos resuelto con Java</a> expongo otra solución sin este problema y resuelto correctamente.</p></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.philosophers</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PhilosophersMain</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>PhilosophersMain</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Setuping dinner...&#34;</span><span class=o>);</span>
        <span class=n>Table</span> <span class=n>table</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Table</span><span class=o>(</span><span class=n>5</span><span class=o>);</span>
        <span class=n>Thread</span> <span class=n>dinner</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>table</span><span class=o>);</span>

        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Starting dinner...&#34;</span><span class=o>);</span>
        <span class=n>dinner</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
        <span class=n>dinner</span><span class=o>.</span><span class=na>join</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/PhilosophersMain.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/PhilosophersMain.java target=_blank>PhilosophersMain.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.philosophers</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.ExecutorService</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Executors</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Table</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Philosopher</span><span class=o>&gt;</span> <span class=n>philosophers</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Table</span><span class=o>(</span><span class=kt>int</span> <span class=n>numPhilosophers</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>numPhilosophers</span> <span class=o>&lt;</span> <span class=n>2</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;There should be more than one philosopher&#34;</span><span class=o>);</span>
        <span class=o>}</span>

        <span class=k>this</span><span class=o>.</span><span class=na>philosophers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>

        <span class=n>Fork</span> <span class=n>leftFork</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Fork</span><span class=o>();</span>
        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numPhilosophers</span><span class=o>;</span> <span class=o>++</span><span class=n>i</span><span class=o>)</span> <span class=o>{</span>
            <span class=kt>boolean</span> <span class=n>isLastPhilosopher</span> <span class=o>=</span> <span class=o>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>numPhilosophers</span> <span class=o>-</span><span class=n>1</span><span class=o>);</span>
            <span class=n>Fork</span> <span class=n>rightFork</span> <span class=o>=</span> <span class=o>(</span><span class=n>isLastPhilosopher</span><span class=o>)</span> <span class=o>?</span> <span class=n>philosophers</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getLeftFork</span><span class=o>()</span> <span class=o>:</span> <span class=k>new</span> <span class=n>Fork</span><span class=o>();</span>

            <span class=n>Philosopher</span> <span class=n>philosopher</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Philosopher</span><span class=o>(</span><span class=s>&#34;Philosopher &#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>),</span> <span class=n>leftFork</span><span class=o>,</span> <span class=n>rightFork</span><span class=o>);</span>
            <span class=n>philosophers</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>philosopher</span><span class=o>);</span>
            <span class=n>leftFork</span> <span class=o>=</span> <span class=n>rightFork</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>ExecutorService</span> <span class=n>executorService</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=n>philosophers</span><span class=o>.</span><span class=na>size</span><span class=o>());</span>
        <span class=k>for</span> <span class=o>(</span><span class=n>Philosopher</span> <span class=n>p</span> <span class=o>:</span> <span class=n>philosophers</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>executorService</span><span class=o>.</span><span class=na>submit</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Table.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Table.java target=_blank>Table.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.philosophers</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.concurrent.TimeUnit</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.locks.ReentrantLock</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fork</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>ReentrantLock</span> <span class=n>lock</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Fork</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>lock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantLock</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>take</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>lock</span><span class=o>.</span><span class=na>tryLock</span><span class=o>(</span><span class=n>250</span><span class=o>,</span> <span class=n>TimeUnit</span><span class=o>.</span><span class=na>MILLISECONDS</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isHeld</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>lock</span><span class=o>.</span><span class=na>isHeldByCurrentThread</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>drop</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>isHeld</span><span class=o>())</span> <span class=o>{</span>
            <span class=n>lock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Fork.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Fork.java target=_blank>Fork.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.philosophers</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.Iterator</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Philosopher</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>Philosopher</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Fork</span> <span class=n>leftFork</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Fork</span> <span class=n>rightFork</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span> <span class=n>times</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Philosopher</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Fork</span> <span class=n>leftFork</span><span class=o>,</span> <span class=n>Fork</span> <span class=n>rightFork</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>leftFork</span> <span class=o>=</span> <span class=n>leftFork</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>rightFork</span> <span class=o>=</span> <span class=n>rightFork</span><span class=o>;</span>

        <span class=k>this</span><span class=o>.</span><span class=na>times</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>longs</span><span class=o>(</span><span class=n>2000</span><span class=o>,</span> <span class=n>7000</span><span class=o>).</span><span class=na>iterator</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>eat</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} trying eat...&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
            <span class=kt>boolean</span> <span class=n>leftTaked</span> <span class=o>=</span> <span class=n>leftFork</span><span class=o>.</span><span class=na>take</span><span class=o>();</span>
            <span class=k>if</span> <span class=o>(</span><span class=n>leftTaked</span><span class=o>)</span> <span class=o>{</span>
                <span class=kt>boolean</span> <span class=n>rightTaked</span> <span class=o>=</span> <span class=n>rightFork</span><span class=o>.</span><span class=na>take</span><span class=o>();</span>
                <span class=k>if</span> <span class=o>(</span><span class=n>rightTaked</span><span class=o>)</span> <span class=o>{</span>
                    <span class=kt>long</span> <span class=n>time</span> <span class=o>=</span> <span class=n>getTime</span><span class=o>();</span>
                    <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} eating during {}ms&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>time</span><span class=o>);</span>
                    <span class=n>spendTime</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
                <span class=o>}</span>
            <span class=o>}</span>
            <span class=k>if</span> <span class=o>(!</span><span class=n>leftFork</span><span class=o>.</span><span class=na>isHeld</span><span class=o>()</span> <span class=o>||</span> <span class=o>!</span><span class=n>rightFork</span><span class=o>.</span><span class=na>isHeld</span><span class=o>())</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} cannot eat&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
            <span class=n>leftFork</span><span class=o>.</span><span class=na>drop</span><span class=o>();</span>
            <span class=n>rightFork</span><span class=o>.</span><span class=na>drop</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>think</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=kt>long</span> <span class=n>time</span> <span class=o>=</span> <span class=n>getTime</span><span class=o>();</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} thinkink during {}ms&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>time</span><span class=o>);</span>
        <span class=n>spendTime</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
    <span class=o>}</span>


    <span class=kd>public</span> <span class=n>Fork</span> <span class=nf>getLeftFork</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>leftFork</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Fork</span> <span class=nf>getRightFork</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>rightFork</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>think</span><span class=o>();</span>
                <span class=n>eat</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>long</span> <span class=nf>getTime</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>times</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>spendTime</span><span class=o>(</span><span class=kt>long</span> <span class=n>time</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Philosopher.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Philosopher.java target=_blank>Philosopher.java</a></div></div><div class=media style=text-align:center><figure><script type=text/javascript src=https://asciinema.org/a/129083.js id=asciicast-129083 async></script><noscript><a href=https://asciinema.org/a/129083 target=_blank><img src=https://asciinema.org/a/129083.png width=734></a></noscript><figcaption>Ejemplo de concurrencia de los filósofos</figcaption></figure></div><p>En el caso de ejemplo del barbero cuando solo hay un barbero los clientes se acumulan ya que estos entran en la tienda a razón de 1 entre 1500 y 3500ms y el barbero tarda afeitar un cliente entre 2000 y 7000ms. Poniendo en la barbería dos barberos los clientes ya no se acumulan en la sala de espera.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.barber</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.ExecutorService</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Executors</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BarberShopMain</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>BarberShopMain</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>BarberShop</span> <span class=n>shop</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BarberShop</span><span class=o>(</span><span class=n>5</span><span class=o>,</span> <span class=n>2</span><span class=o>);</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Barber</span><span class=o>&gt;</span> <span class=n>barbers</span> <span class=o>=</span> <span class=n>shop</span><span class=o>.</span><span class=na>getBarbers</span><span class=o>();</span>
        <span class=n>Street</span> <span class=n>street</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Street</span><span class=o>(</span><span class=n>shop</span><span class=o>);</span>

        <span class=n>ExecutorService</span> <span class=n>executorService</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=n>barbers</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>
        <span class=n>executorService</span><span class=o>.</span><span class=na>submit</span><span class=o>(</span><span class=n>street</span><span class=o>);</span>
        <span class=n>barbers</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=nl>executorService:</span><span class=o>:</span><span class=n>submit</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/BarberShopMain.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/BarberShopMain.java target=_blank>BarberShopMain.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.barber</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.*</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BarberShop</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>BarberShop</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>ArrayBlockingQueue</span><span class=o>&lt;</span><span class=n>Client</span><span class=o>&gt;</span> <span class=n>clients</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Semaphore</span> <span class=n>chairs</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Barber</span><span class=o>&gt;</span> <span class=n>barbers</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span> <span class=n>times</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>BarberShop</span><span class=o>(</span><span class=kt>int</span> <span class=n>capacity</span><span class=o>,</span> <span class=kt>int</span> <span class=n>numBarbers</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>clients</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayBlockingQueue</span><span class=o>&lt;</span><span class=n>Client</span><span class=o>&gt;(</span><span class=n>capacity</span><span class=o>);</span>
        <span class=k>this</span><span class=o>.</span><span class=na>chairs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Semaphore</span><span class=o>(</span><span class=n>numBarbers</span><span class=o>);</span>

        <span class=k>this</span><span class=o>.</span><span class=na>barbers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numBarbers</span><span class=o>;</span> <span class=o>++</span><span class=n>i</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>Barber</span> <span class=n>barber</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Barber</span><span class=o>(</span><span class=s>&#34;Barber &#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>),</span> <span class=k>this</span><span class=o>);</span>
            <span class=n>barbers</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>barber</span><span class=o>);</span>
        <span class=o>}</span>

        <span class=k>this</span><span class=o>.</span><span class=na>times</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>longs</span><span class=o>(</span><span class=n>1000</span><span class=o>,</span> <span class=n>4000</span><span class=o>).</span><span class=na>iterator</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Barber</span><span class=o>&gt;</span> <span class=nf>getBarbers</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>barbers</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>enter</span><span class=o>(</span><span class=n>Client</span> <span class=n>client</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=kt>boolean</span> <span class=n>entered</span> <span class=o>=</span> <span class=n>clients</span><span class=o>.</span><span class=na>offer</span><span class=o>(</span><span class=n>client</span><span class=o>,</span> <span class=n>1</span><span class=o>,</span> <span class=n>TimeUnit</span><span class=o>.</span><span class=na>SECONDS</span><span class=o>);</span>
        <span class=k>if</span> <span class=o>(!</span><span class=n>entered</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} awaiting to barber ({})&#34;</span><span class=o>,</span> <span class=n>client</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>clients</span><span class=o>.</span><span class=na>size</span><span class=o>());</span>
        <span class=n>chairs</span><span class=o>.</span><span class=na>acquire</span><span class=o>();</span>
        <span class=n>client</span><span class=o>.</span><span class=na>awaitShave</span><span class=o>();</span>
        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Client</span> <span class=nf>next</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>clients</span><span class=o>.</span><span class=na>take</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>long</span> <span class=nf>getTime</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>times</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>spendTime</span><span class=o>(</span><span class=kt>long</span> <span class=n>time</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/BarberShop.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/BarberShop.java target=_blank>BarberShop.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.barber</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.Iterator</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.atomic.AtomicLong</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Street</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>Street</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>AtomicLong</span> <span class=n>counter</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>BarberShop</span> <span class=n>shop</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span> <span class=n>times</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Street</span><span class=o>(</span><span class=n>BarberShop</span> <span class=n>shop</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>counter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicLong</span><span class=o>();</span>
        <span class=k>this</span><span class=o>.</span><span class=na>shop</span> <span class=o>=</span> <span class=n>shop</span><span class=o>;</span>

        <span class=k>this</span><span class=o>.</span><span class=na>times</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>longs</span><span class=o>(</span><span class=n>1500</span><span class=o>,</span> <span class=n>3500</span><span class=o>).</span><span class=na>iterator</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=kt>long</span> <span class=n>i</span> <span class=o>=</span> <span class=n>counter</span><span class=o>.</span><span class=na>incrementAndGet</span><span class=o>();</span>
                <span class=n>Client</span> <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Client</span><span class=o>(</span><span class=s>&#34;Client &#34;</span> <span class=o>+</span> <span class=n>i</span><span class=o>,</span> <span class=n>shop</span><span class=o>);</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;New client {}&#34;</span><span class=o>,</span> <span class=n>client</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
                <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>client</span><span class=o>).</span><span class=na>start</span><span class=o>();</span>

                <span class=n>spendTime</span><span class=o>(</span><span class=n>getTime</span><span class=o>());</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>long</span> <span class=nf>getTime</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>times</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>spendTime</span><span class=o>(</span><span class=kt>long</span> <span class=n>time</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Street.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Street.java target=_blank>Street.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.barber</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.Iterator</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.UUID</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Semaphore</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.locks.Lock</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.locks.ReentrantLock</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Barber</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>Barber</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>BarberShop</span> <span class=n>shop</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span> <span class=n>times</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Barber</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>BarberShop</span> <span class=n>shop</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>shop</span> <span class=o>=</span> <span class=n>shop</span><span class=o>;</span>

        <span class=k>this</span><span class=o>.</span><span class=na>times</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>longs</span><span class=o>(</span><span class=n>2000</span><span class=o>,</span> <span class=n>7000</span><span class=o>).</span><span class=na>iterator</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>shave</span><span class=o>(</span><span class=n>Client</span> <span class=n>client</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=kt>long</span> <span class=n>time</span> <span class=o>=</span> <span class=n>getTime</span><span class=o>();</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} shaving {} during {}ms&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>client</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>time</span><span class=o>);</span>
        <span class=n>spendTime</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} shaved {}&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>client</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
        <span class=n>client</span><span class=o>.</span><span class=na>shaved</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} awaiting client&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
                <span class=n>Client</span> <span class=n>client</span> <span class=o>=</span> <span class=n>shop</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
                <span class=n>shave</span><span class=o>(</span><span class=n>client</span><span class=o>);</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>long</span> <span class=nf>getTime</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>times</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>spendTime</span><span class=o>(</span><span class=kt>long</span> <span class=n>time</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>time</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Barber.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Barber.java target=_blank>Barber.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.javaconcurrency.barber</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.Iterator</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.UUID</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Semaphore</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Client</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>Client</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>BarberShop</span> <span class=n>shop</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span> <span class=n>times</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>Semaphore</span> <span class=n>shave</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Client</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>BarberShop</span> <span class=n>shop</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>shop</span> <span class=o>=</span> <span class=n>shop</span><span class=o>;</span>

        <span class=k>this</span><span class=o>.</span><span class=na>shave</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Semaphore</span><span class=o>(</span><span class=n>0</span><span class=o>);</span>
        <span class=k>this</span><span class=o>.</span><span class=na>times</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>longs</span><span class=o>(</span><span class=n>2000</span><span class=o>,</span> <span class=n>7000</span><span class=o>).</span><span class=na>iterator</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getName</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>name</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>awaitShave</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>shave</span><span class=o>.</span><span class=na>acquire</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>shaved</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>shave</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=kt>boolean</span> <span class=n>entered</span> <span class=o>=</span> <span class=n>shop</span><span class=o>.</span><span class=na>enter</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
            <span class=k>if</span> <span class=o>(!</span><span class=n>entered</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} exited, barbershop at full capacity&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;{} exited&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>logger</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Client.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2017/07/iniciacion-a-la-programacion-concurrente-en-java/code/Client.java target=_blank>Client.java</a></div></div><div class=media style=text-align:center><figure><script type=text/javascript src=https://asciinema.org/a/129098.js id=asciicast-129098 async></script><noscript><a href=https://asciinema.org/a/129098 target=_blank><img src=https://asciinema.org/a/129098.png width=734></a></noscript><figcaption>Ejemplo de concurrencia del barbero (1 barbero)</figcaption></figure></div><div class=media style=text-align:center><figure><script type=text/javascript src=https://asciinema.org/a/129099.js id=asciicast-129099 async></script><noscript><a href=https://asciinema.org/a/129099 target=_blank><img src=https://asciinema.org/a/129099.png width=734></a></noscript><figcaption>Ejemplo de concurrencia del barbero (2 barberos)</figcaption></figure></div><p>Estos no son los únicos ejemplos clásicos otro es el del <a href=https://picodotdev.github.io/blog-bitix/2018/03/el-problema-de-concurrencia-del-agente-y-los-fumadores-resuelto-en-java/>agente y los fumadores</a>.</p><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/JavaconCurrency>código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en <a href=https://github.com/>GitHub</a> y probarlo en tu equipo ejecutando el comando <code>./gradlew run</code>.</p><div class=reference>Referencia:<br><ul><li><a href=https://docs.oracle.com/javase/tutorial/essential/concurrency/>Tutorial sobre la concurrencia en Java</a></li></ul></div></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2017/07/iniciar-rapido-un-proyecto-de-java-con-gradle-o-de-spring-con-spring-initializr/>Iniciar rápido un proyecto de Java con Gradle o de Spring con Spring Initializr</a></li><li><a href=/blog-bitix/2017/07/portlets-con-el-framework-apache-tapestry-y-apache-pluto/>Portlets con el framework Apache Tapestry y Apache Pluto</a></li><li><a href=/blog-bitix/2017/07/introduccion-a-los-portales-y-ejemplo-de-portlet-con-liferay/>Introducción a los portales y ejemplo de portlet con Liferay</a></li><li><a href=/blog-bitix/2017/06/hemeroteca-11/>Hemeroteca #11</a></li><li><a href=/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/>Autenticación mutua de cliente y servidor con certificados</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class="col-12 ad"><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/07\/iniciacion-a-la-programacion-concurrente-en-java\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2017\/07\/iniciacion-a-la-programacion-concurrente-en-java\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
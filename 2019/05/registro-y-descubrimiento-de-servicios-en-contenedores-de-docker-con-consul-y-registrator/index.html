<!doctype html><html lang=es><head><meta name=base href=/blog-bitix/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="picodotdev"><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="En los microservicios se hace necesario un servicio de registro y descubrimiento como Eureka o Consul que permita conocer la ubicación de las instancias en cada momento. Las instancias de los servicios se pueden registrar ellas mismas o esta tarea se puede delegar en una en otro servicio. Al usar contenedores de Docker una herramienta que permite delegar el registro y desregistro en Consul de los servicios es GliderLabs Registrator. &mldr;"><title>Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator</title><link rel="shortcut icon" href=/blog-bitix/assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=/blog-bitix/assets/apple-touch-icon-144-precomposed.png><link rel=canonical type=text/html href=https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/><link rel=amphtml type=text/html href=https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/index.amp.html><link rel=alternate type=application/rss+xml href=index.xml title="Blog Bitix"><link rel=humans type=text/plain href=/blog-bitix/humans.txt><link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel=stylesheet><meta property="og:title" content="Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator"><meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/"><meta property="og:image" content="https://picodotdev.github.io/blog-bitix//blog-bitix/static/assets/images/structured-data/blogbitix-1200.png"><meta property="og:site_name" content="Blog Bitix"><meta property="og:description" content="En los microservicios se hace necesario un servicio de registro y descubrimiento como Eureka o Consul que permita conocer la ubicación de las instancias en cada momento. Las instancias de los servicios se pueden registrar ellas mismas o esta tarea se puede delegar en una en otro servicio. Al usar contenedores de Docker una herramienta que permite delegar el registro y desregistro en Consul de los servicios es GliderLabs Registrator. &mldr;"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><meta property="og:image" content="https://picodotdev.github.io/blog-bitix//blog-bitix/static/assets/images/structured-data/blogbitix-1200.png"><meta name=twitter:site content="@picodotdev"><meta name=twitter:title content="Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator"><meta name=twitter:description content="En los microservicios se hace necesario un servicio de registro y descubrimiento como Eureka o Consul que permita conocer la ubicación de las instancias en cada momento. Las instancias de los servicios se pueden registrar ellas mismas o esta tarea se puede delegar en una en otro servicio. Al usar contenedores de Docker una herramienta que permite delegar el registro y desregistro en Consul de los servicios es GliderLabs Registrator. &mldr;"><meta name=twitter:creator content="@picodotdev"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/"},"headline":"Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator","image":{"@type":"ImageObject","url":"https://picodotdev.github.io/blog-bitix//blog-bitix/static/assets/images/structured-data/blogbitix-1200.png"},"datePublished":"2019-05-26T11:30:00+02:00","dateModified":"2019-05-26T11:30:00+02:00","inLanguage":"es","wordCount":"739","license":"https://creativecommons.org/licenses/by-sa/4.0/","author":{"@type":"Person","name":"picodotdev","url":"https://twitter.com/picodotdev/"},"publisher":{"@type":"Organization","name":"Blog Bitix","logo":{"@type":"ImageObject","url":"https://picodotdev.github.io/blog-bitix/assets/images/logotypes/blogbitix.png"}},"description":"En los microservicios se hace necesario un servicio de registro y descubrimiento como Eureka o Consul que permita conocer la ubicación de las instancias en cada momento. Las instancias de los servicios se pueden registrar ellas mismas o esta tarea se puede delegar en una en otro servicio. Al usar contenedores de Docker una herramienta que permite delegar el registro y desregistro en Consul de los servicios es GliderLabs Registrator."}</script><link rel=stylesheet type=text/css href=/blog-bitix/assets/libs/bootstrap-4.4.1-dist/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/blog-bitix/assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=/blog-bitix/assets/css/syntax.css><link rel=stylesheet type=text/css href=/blog-bitix/assets/css/main.css><link rel=stylesheet type=text/css href=/blog-bitix/assets/css/main-cookieconsent.css><script type=text/javascript src=/blog-bitix/assets/js/require-config.js defer></script><script type=text/javascript src=/blog-bitix/assets/libs/require.js data-main=/blog-bitix/assets/js/main defer></script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript src=/blog-bitix/assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col-12><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=/blog-bitix/assets/images/rss.png width=50 height=50 class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=/blog-bitix/assets/images/twitter.svg width=50 height=50 class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=/blog-bitix/assets/images/github.svg width=50 height=50 class=icon></a></div></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class="col-12 text-center"><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins></div></div><div class=row><div class=col-12><div class=adblock-sidebar-container><div class=adblock-sidebar-container-left></div><div class=adblock-sidebar-container-right><ins class="adsbygoogle adblock-sidebar-vertical" data-ad-client=ca-pub-3533636310991304 data-ad-slot=9933840986 data-ad-format=vertical,rectangle data-type=auto></ins></div></div><article><h1>Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator</h1><p class=information>Escrito por
<span>picodotdev</span> el <time>26/05/2019</time>.<br><a href=/blog-bitix/tags/planeta-codigo/>planeta-codigo</a>
<a href=/blog-bitix/tags/programacion/>programacion</a>
<a href=/blog-bitix/tags/software/>software</a><br><a href=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/>Enlace permanente</a>
<a href=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/#comments>Comentarios</a></p><p class=summary>En los microservicios se hace necesario un servicio de registro y descubrimiento como Eureka o Consul que permita conocer la ubicación de las instancias en cada momento. Las instancias de los servicios se pueden registrar ellas mismas o esta tarea se puede delegar en una en otro servicio. Al usar contenedores de Docker una herramienta que permite delegar el registro y desregistro en Consul de los servicios es GliderLabs Registrator.</p><div><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins></div><div class=content><div class=logotypes><img src=/blog-bitix/assets/images/logotypes/consul.svg class=right width=200 height layout=responsive alt=Consul title=Consul></div><div class=logotypes><img src=/blog-bitix/assets/images/logotypes/docker.svg class=right width=200 height layout=responsive alt=Docker title=Docker></div><p>El registro y descubrimiento de servicios permite a los servicios registrase y a los clientes descubrir la ubicación de otros servicios, la ubicación consiste en la dirección IP y el puerto en el que contactarles. Dado la naturaleza efímera de los servicios donde nuevas instancias de servicios se inician y se detienen en diferentes máquinas y puertos el servicio de descubrimiento es esencial.</p><p>La funcionalidad de registro y descubrimiento consiste en dos partes, por un lado cuando se inicia una instancia de un servicio se registra su ubicación en el servicio de registro y descubrimiento y por otro lado los clientes cuando requieren una instancia de un servicio la buscan en el servicio de descubrimiento.</p><p>El registro en el servicio de descubrimiento puede hacerse de dos formas, que sea el propio servicio el que se registra en el servicio de descubrimiento o que se sea otro servicio el que lo registra. Para el primer caso escribí un artículo con <a href=https://www.consul.io/>Consul</a> como servicio de descubrimiento en una aplicación de <a href=https://projects.spring.io/spring-boot/>Spring Boot</a> que se registra al iniciarse. La ventaja es que es autosuficiente pero adquiere la tarea de autoregistrarse. Por el contrario delegar la trea de registro permite extraerla de los servicios y ofrecer esa funcionalidad por un servicio con esa misión específicamente.</p><ul><li><a href=https://picodotdev.github.io/blog-bitix/2017/01/registro-y-descubrimiento-de-servicios-con-spring-cloud-y-consul/>Registro y descubrimiento de servicios con Spring Cloud y Consul</a></li></ul><p>En este artículo se usa <a href=https://github.com/gliderlabs/registrator>GliderLabs Registrator</a> como servicio que se encarga de registrar en un servicio de descubrimiento como Consul los servicios que se inicien en <a href=https://www.docker.com/>Docker</a>, aunque soporta otros como <a href=https://etcd.io/>etcd</a>.</p><p>Registrator es un contenedor de Docker, su funcionamiento es escuchar los eventos del demonio de Docker y monitorizar cuando se inician nuevos contenedores o cuando se paran. La monitorización la hace a través del <em>socket</em> del servicio de Docker, para lo que hay que montar un volumen en este contenedor con el archivo <em>/var/run/docker.sock</em> del <em>host</em>.</p><p>Primero se inicia el servicio de Consul.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ consul agent -dev&#10;</code></pre></td></tr></table></div></div><div class=highlight-meta><span>consul.sh</span></div></div><p>Luego se inicia el contenedor Registrator indicando la ubicación con dirección IP y puerto del servicio de Consul.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ docker run --rm --name<span class=o>=</span>registrator --net<span class=o>=</span>host --volume<span class=o>=</span>/var/run/docker.sock:/tmp/docker.sock gliderlabs/registrator:latest consul://localhost:8500&#10;</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-registrator.sh</span></div></div><p>Iniciados estos dos servicios en la interfaz de estado de Consul se observa que no hay ningún servicio pero cuando se inicie un nuevo contenedor será registrado en Consul por Registrator.</p><div class=media><figure><a href=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul_hudf2f8b03877264bacf83a564e5686ede_36482_2560x1440_fit_box_2.png title=Dirección data-gallery=data-gallery><img data-src=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul_hudf2f8b03877264bacf83a564e5686ede_36482_300x200_fit_box_2.png width=287 height=200 layout=responsive class=lozad></a></figure></div><p>En este caso se utiliza como servicio una base de datos <a href=https://www.postgresql.org/>PostgreSQL</a>. Dado que el puerto en el que esté disponible el servicio de PostgreSQL es indiferente al utilizar un servicio de registro y descubrimiento se indica el <em>-p</em> sin indicar el puerto del <em>host</em>, de este modo Docker le asigna un puerto público aleatorio.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ docker run --rm --name postgres -e <span class=nv>POSTGRES_USER</span><span class=o>=</span>user -e <span class=nv>POSTGRES_PASSWORD</span><span class=o>=</span>password -e <span class=nv>POSTGRES_DB</span><span class=o>=</span>database -p <span class=m>5432</span> postgres:alpine&#10;</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-postgres.sh</span></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span><span class=lnt>2&#10;</span><span class=lnt>3&#10;</span><span class=lnt>4&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ docker ps&#10;CONTAINER ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAMES&#10;cb7602605725&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postgres:alpine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>54</span> seconds ago&nbsp;&nbsp;&nbsp;&nbsp;   Up <span class=m>53</span> seconds&nbsp;&nbsp;&nbsp;&nbsp;   0.0.0.0:32777-&gt;5432/tcp   postgres&#10;d286341148cb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gliderlabs/registrator:latest   <span class=s2>&#34;/bin/registrator co…&#34;</span>   About a minute ago   Up About a minute&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; registrator</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-ps.sh</span></div></div><p>En la salida del contenedor de Registrator se emite una traza indicando que el servicio de postgres ha sido registrado en Consul.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span><span class=lnt>2&#10;</span><span class=lnt>3&#10;</span><span class=lnt>4&#10;</span><span class=lnt>5&#10;</span><span class=lnt>6&#10;</span><span class=lnt>7&#10;</span><span class=lnt>8&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-plaintext data-lang=plaintext>2019/05/26 11:05:29 Starting registrator v7 ...&#10;2019/05/26 11:05:29 Using consul adapter: consul://localhost:8500&#10;2019/05/26 11:05:29 Connecting to backend (0/0)&#10;2019/05/26 11:05:29 consul: current leader  127.0.0.1:8300&#10;2019/05/26 11:05:29 Listening for Docker events ...&#10;2019/05/26 11:05:29 Syncing services on 1 containers&#10;2019/05/26 11:05:29 ignored: d286341148cb no published ports&#10;2019/05/26 11:05:50 added: cb7602605725 archlinux:postgres:5432</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-registrator.out</span></div></div><p>Una vez iniciado el servicio de postgres en la consola de Consul se muestra con su dirección y puerto en el que se encuentra, en el contenedor utiliza su puerto por defecto <em>5432</em> pero hacia el exterior en este caso al no haber especificado uno Docker le asigna un puerto aleatorio en este caso el <em>32777</em>. Este puerto aleatorio es con el que los clientes acceden a la base de datos.</p><div class=media><figure><a href=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul-postgres-1_hu5336dadbc35299bcca8969f84d373cf0_39850_2560x1440_fit_box_2.png title="Servicio de postgres registrado en Consul" data-gallery=data-gallery><img data-src=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul-postgres-1_hu5336dadbc35299bcca8969f84d373cf0_39850_300x200_fit_box_2.png width=300 height=165 layout=responsive class=lozad></a>
<a href=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul-postgres-2_huf0df6f6a3d2138a93d9a38f4927788b0_43545_2560x1440_fit_box_2.png title="Servicio de postgres registrado en Consul" data-gallery=data-gallery><img data-src=/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/images/consul-postgres-2_huf0df6f6a3d2138a93d9a38f4927788b0_43545_300x200_fit_box_2.png width=300 height=165 layout=responsive class=lozad></a><figcaption>Servicio de postgres registrado en Consul por Registrator</figcaption></figure></div><p>En vez de iniciar los servicios individualmente con comandos de Docker creando un archivo de <a href=https://docs.docker.com/compose/>Docker Compose</a> con la definición de todos los contenedores se facilita iniciar todos los contenedores con un comando.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ docker-compose up</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-compose-up.sh</span></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1&#10;</span><span class=lnt> 2&#10;</span><span class=lnt> 3&#10;</span><span class=lnt> 4&#10;</span><span class=lnt> 5&#10;</span><span class=lnt> 6&#10;</span><span class=lnt> 7&#10;</span><span class=lnt> 8&#10;</span><span class=lnt> 9&#10;</span><span class=lnt>10&#10;</span><span class=lnt>11&#10;</span><span class=lnt>12&#10;</span><span class=lnt>13&#10;</span><span class=lnt>14&#10;</span><span class=lnt>15&#10;</span><span class=lnt>16&#10;</span><span class=lnt>17&#10;</span><span class=lnt>18&#10;</span><span class=lnt>19&#10;</span><span class=lnt>20&#10;</span><span class=lnt>21&#10;</span><span class=lnt>22&#10;</span><span class=lnt>23&#10;</span><span class=lnt>24&#10;</span><span class=lnt>25&#10;</span><span class=lnt>26&#10;</span><span class=lnt>27&#10;</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-YAML data-lang=YAML>version<span class=p>:</span><span class=w> </span><span class=s2>&#34;3.7&#34;</span><span class=w>&#10;</span><span class=w></span>services<span class=p>:</span><span class=w>&#10;</span><span class=w>  </span>consul<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>image<span class=p>:</span><span class=w> </span>consul<span class=p>:</span>latest<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>container_name<span class=p>:</span><span class=w> </span>consul<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>network_mode<span class=p>:</span><span class=w> </span><span class=s2>&#34;host&#34;</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>command<span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;consul&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-dev&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-ui&#34;</span><span class=p>]</span><span class=w>&#10;</span><span class=w>  </span>registrator<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>image<span class=p>:</span><span class=w> </span>gliderlabs/registrator<span class=p>:</span>latest<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>container_name<span class=p>:</span><span class=w> </span>registrator<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>network_mode<span class=p>:</span><span class=w> </span><span class=s2>&#34;host&#34;</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>volumes<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;  </span>-<span class=w> </span>/var/run/docker.sock<span class=p>:</span>/tmp/docker.sock<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>entrypoint<span class=p>:</span><span class=w> </span>/bin/registrator<span class=w> </span>consul<span class=p>:</span>//localhost<span class=p>:</span><span class=m>8500</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>depends_on<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;  </span>-<span class=w> </span>consul<span class=w>&#10;</span><span class=w>  </span>postgres<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>image<span class=p>:</span><span class=w> </span>postgres<span class=p>:</span>alpine<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>container_name<span class=p>:</span><span class=w> </span>postgres<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>ports<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-<span class=w> </span><span class=s2>&#34;5432&#34;</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>environment<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-<span class=w> </span>POSTGRES_USER=user<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-<span class=w> </span>POSTGRES_PASSWORD=password<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-<span class=w> </span>POSTGRES_DB=database<span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;</span>depends_on<span class=p>:</span><span class=w>&#10;</span><span class=w>&nbsp;&nbsp;&nbsp;&nbsp;  </span>-<span class=w> </span>registrator</code></pre></td></tr></table></div></div><div class=highlight-meta><span>docker-compose.yml</span></div></div><p>El proyecto de <a href=https://projects.spring.io/spring-cloud/>Spring Cloud</a> ofrece soporte para ambas tareas de registrar y descubrir servicios, aunque perfectamente la tarea de registro se puede delegar como en este caso a Registrator y utilizar en los servicios de Spring Boot únicamente la parte de descubrimiento.</p><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/Registrator>código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en <a href=https://github.com/>GitHub</a> y probarlo en tu equipo ejecutando el comando <code>./docker-compose-up.sh</code>.</p></div></article><div class="row serie"><div class=col-md-12><h3>Este artículo forma parte de la serie <strong>docker</strong>:</h3><ol class=serie-articles><li><a href=https://picodotdev.github.io/blog-bitix/2014/10/introduccion-y-caracteristicas-de-docker/>Introducción y características de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/inicio-basico-de-docker/>Inicio básico de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/como-crear-una-imagen-para-docker-usando-un-dockerfile/>Cómo crear una imagen para Docker usando un Dockerfile</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2014/11/integracion-entre-ansible-y-docker/>Integración entre Ansible y Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/aplicaciones-multicontenedor-con-docker-compose/>Aplicaciones multicontenedor con Docker Compose</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/crear-y-usar-un-repositorio-en-docker-hub/>Crear y usar un repositorio en Docker Hub</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/usar-docker-con-docker-machine-en-linux-windows-o-mac/>Usar docker con Docker Machine en Linux, Windows o Mac</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2015/07/cambiar-la-ruta-raiz-del-entorno-de-docker/>Cambiar la ruta raíz del entorno de Docker</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/03/introduccion-y-ejemplo-de-cluster-de-contenedores-con-docker-swarm/>Introducción y ejemplo de cluster de contenedores con Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/iniciar-un-stack-de-servicios-en-un-cluster-de-docker-swarm/>Iniciar un stack de servicios en un cluster de Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/escalar-y-actualizar-un-servicio-de-un-cluster-de-docker-swarm/>Escalar y actualizar un servicio de un cluster de Docker Swarm</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/contenedores-en-docker-swarm-con-volumenes-de-datos-persistentes-usando-rex-ray-y-virtualbox/>Contenedores en Docker Swarm con volúmenes de datos persistentes usando REX-Ray y VirtualBox</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/informacion-sensible-en-los-contenedores-con-docker-secrets/>Información sensible en los contenedores con Docker Secrets</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2017/04/imagenes-de-docker-con-alpine-linux/>Imágenes de Docker con Alpine Linux</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/>Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator</a></li></ol><h3>Este artículo forma parte de la serie <strong>hashicorp</strong>:</h3><ol class=serie-articles><li><a href=https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/>Introducción a Nomad para gestionar aplicaciones y microservicios</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/>Estrategias de despliegue para microservicios con Nomad</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/04/servicios-con-persistencia-en-el-orquestador-de-microservicos-nomad/>Servicios con persistencia en el orquestador de microservicos Nomad</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/05/crear-de-forma-sencilla-y-rapida-maquinas-virtuales-de-virtualbox-con-vagrant/>Crear de forma sencilla y rápida máquinas virtuales de VirtualBox con Vagrant</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/>Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/07/administrar-secretos-y-proteger-datos-sensibles-con-vault/>Administrar secretos y proteger datos sensibles con Vault</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/08/generar-credenciales-de-conexion-a-base-de-datos-bajo-demanda-con-vault/>Generar credenciales de conexión a base de datos bajo demanda con Vault</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/08/utilizar-credenciales-de-conexion-a-la-base-de-datos-generadas-por-vault-en-una-aplicacion-de-spring/>Utilizar credenciales de conexión a la base de datos generadas por Vault en una aplicación de Spring</a></li><li><a href=https://picodotdev.github.io/blog-bitix/2019/10/microservicios-con-spring-cloud-consul-nomad-y-traefik/>Microservicios con Spring Cloud, Consul, Nomad y Traefik</a></li></ol></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class="col-12 text-center"><a id=pageBottom></a><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins></div></div><div class=row><div class=col-md-12><a id=comments></a><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='blog-bitix-408';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2019\/05\/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator\/';var disqus_script='embed.js';</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=/blog-bitix/assets/images/rss.png width=50 height=50 class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=/blog-bitix/assets/images/twitter.svg width=50 height=50 class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=/blog-bitix/assets/images/github.svg width=50 height=50 class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2020 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow><img src=https://licensebuttons.net/l/by-sa/4.0/80x15.png width=80 height=15 alt="Creative Commons License" title="Creative Commons License"></a><br><a href=https://www.planetacodigo.com/ rel=nofollow><img src=/blog-bitix/assets/images/planeta-codigo.png width=80 height=15 alt="Planeta código" title="Planeta código"></a><br><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a> by <a href=https://picodotdev.github.io/blog-bitix/>pico.dev</a> is licensed under a <a href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&#215;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>
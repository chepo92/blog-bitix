<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=picodotdev><meta name=keywords content="java,programacion,software,hardware,tapestry,software libre,gnu,linux,gnu/linux,unix,arch,arch linux,html,css,javascript"><meta name=description content="Hace ya unos años escribí un ejemplo y un artículo con una implementación propia de una máquina de estado en Java, para algún caso muy básico puede ser suficiente pero para algo serio no es la opción a elegir. Pasado un tiempo de ese ejemplo y artículo descubrí uno de los muchos proyectos de Spring útiles para una aplicación, para las necesidades más habítuales tiene un proyecto que lo proporciona y para las menos habituales es también posible que la proporcione como en el caso del proyecto Spring Statemachine que precisamente tiene el mismo objetivo de implementar una máquina de estados cubriendo muchos casos de uso. &hellip;"><base href=https://picodotdev.github.io/blog-bitix/><title>Ejemplo de máquina de estados con Spring Statemachine</title><link rel=author type=text/plain href=humans.txt><link rel="shortcut icon" href=assets/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=assets/apple-touch-icon-144-precomposed.png><link rel=canonical href=https://picodotdev.github.io/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/><link href=index.xml rel=alternate type=application/rss+xml title="Blog Bitix"><link rel=stylesheet type=text/css href="//fonts.googleapis.com/css?family=PT+Serif:400,400i,700"><link rel=stylesheet type=text/css href=assets/libs/bootstrap-4.3.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=assets/libs/Gallery-2.33.0/css/blueimp-gallery.min.css><link rel=stylesheet type=text/css href=assets/css/syntax.css><link rel=stylesheet type=text/css href=assets/css/main.css><script type=text/javascript src=assets/js/require-config.js data-main=js/main defer></script><script type=text/javascript src=assets/libs/require.js data-main=js/main defer></script><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js defer></script><script type=text/javascript defer>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:'ca-pub-3533636310991304',enable_page_level_ads:true});</script><script type=text/javascript defer>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-12874075-4','picodotdev.github.io');ga('send','pageview');</script><script type=text/javascript src="//platform-api.sharethis.com/js/sharethis.js#property=5920c4ce1bd0670011e06acd&product=inline-share-buttons" defer></script><script type=text/javascript src=assets/js/app.js defer></script></head><body><div class=container><div class=row><div class=col><header><div class=row><div class="col-12 col-lg-4"></div><div class="col-12 col-lg-4"><h2 class=title><a href=https://picodotdev.github.io/blog-bitix/>Blog Bitix</a></h2><div class=links><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class="col-12 col-lg-4 text-center"><form name=query class="form-inline search" onsubmit="return false;"><div class=input-group><input type=text name=q class=form-control placeholder="Buscar en Blog Bitix">
<span class=input-group-btn><button class="btn btn-secondary" type=submit>Buscar</button></span></div></form><form name=search action=https://duckduckgo.com/ method=get class=hidden data-site=https://picodotdev.github.io/blog-bitix/><input type=hidden name=q></form></div></div><div class=row><div class=col-12><nav class="nav nav-pills nav-fill"><a href=/blog-bitix/tags/java/ class="nav-item nav-link">Java</a>
<a href=/blog-bitix/tags/gnu-linux/ class="nav-item nav-link">GNU/Linux</a>
<a href=/blog-bitix/tags/javascript/ class="nav-item nav-link">JavaScript</a>
<a href=/blog-bitix/tags/tapestry/ class="nav-item nav-link">Tapestry</a>
<a href=/blog-bitix/archive/ class="nav-item nav-link">Archivo y hemeroteca</a>
<a href=/blog-bitix/pages/links/ class="nav-item nav-link">Enlaces</a>
<a href=/blog-bitix/pages/about/ class="nav-item nav-link">Acerca de...</a></nav></div></div></header></div></div><div class=row><div class=col-12><div class="adblock-sidebar adblock-sidebar-right"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3533636310991304 data-ad-slot=9933840986 data-ad-format=auto data-type=auto></ins><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3533636310991304 data-ad-slot=9933840986 data-ad-format=auto data-type=auto></ins></div><article itemprop=mainEntity itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=inLanguage content=es><meta itemprop=keywords content="java, planeta-codigo, spring"><h1 itemprop=name>Ejemplo de máquina de estados con Spring Statemachine</h1><p class=information>Escrito por
<span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>picodotdev</span></span> el <time itemprop=datePublished datetime=2019-03-31>31/03/2019</time>, actualizado el <time itemprop=dateModified datetime=2019-03-31>31/03/2019</time>.<br><a href=tags/java/>java</a> <a href=tags/planeta-codigo/>planeta-codigo</a> <a href=tags/spring/>spring</a><br><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/ itemprop=url>Enlace permanente</a>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/#comments>Comentarios</a></p><div><ins class=adsbygoogle style=display:inline-block;width:728px;height:90px data-ad-client=ca-pub-3533636310991304 data-ad-slot=5966819782 data-type=leaderboard></ins></div><div class=content itemprop=articleBody><meta itemprop=wordCount content=5781><div class=logotypes style=float:right><img src=assets/images/logotipos/spring.svg class=right width=200 alt=Spring title=Spring></div><div class=logotypes style=float:right;clear:right><img src=assets/images/logotipos/java.svg class=right width=200 alt=Java title=Java></div><p>Hace ya unos años escribí un <a href=https://picodotdev.github.io/blog-bitix/2015/08/implementacion-de-maquina-de-estados-finita-fsm-con-java-8/>ejemplo y un artículo con una implementación propia de una máquina de estado en Java</a>, para algún caso muy básico puede ser suficiente pero para algo serio no es la opción a elegir. Pasado un tiempo de ese ejemplo y artículo descubrí uno de los muchos proyectos de <a href=https://spring.io/>Spring</a> útiles para una aplicación, para las necesidades más habítuales tiene un proyecto que lo proporciona y para las menos habituales es también posible que la proporcione como en el caso del proyecto <a href=https://projects.spring.io/spring-statemachine/>Spring Statemachine</a> que precisamente tiene el mismo objetivo de implementar una máquina de estados cubriendo muchos casos de uso.</p><p>El uso de una máquina de estados permite modelar un proceso con cierta complejidad. Puede ser el ciclo de vida de una compra, un envío, un proceso documental, financiero, &hellip; cualquiera en el que intervengan estados, transiciones entre esos estados y realización de acciones necesarias para proporcionar la funcionalidad deseada.</p><p>Una máquina de estados se compone de un conjunto de estados finito, de transiciones en esos estados, de eventos que disparan las transiciones y cambios de estado, de acciones asociadas a los estados, a las transiciones o a la entrada o salida de un estado, <em>guards</em> que permiten decidir que transición se escoge entre varias en los <em>choices</em>, <em>forks</em> en las que el flujo sigue por varios caminos en paralelo, temporizadores que pasado un tiempo disparan una transición, seguridad para proteger la ejecución de eventos, transiciones y acciones con <a href=https://spring.io/projects/spring-security>Spring Security</a>, persistencia tanto para la configuración como para el estado en bases de datos relacionales o NoSQL como <a href=https://redis.io/>Redis</a> y <a href=https://www.mongodb.com/>MongoDB</a>. Una lista bastante completa de características que cubrirá las necesidades de la mayoría de aplicaciones.</p><p>Aparte de proporcionar una librería para crear máquinas de estados en Java otra ventaja es que el fujo de un proceso queda recogido y documentado en la implementación de la máquina de estados. De que estados, transiciones y eventos se compone en un punto más centralizado lo que en otro caso podría estar repartido por el código de la aplicación utilizando una solución propia codificada expresamente para el caso.</p><p>En el ejemplo he definido el siguente grafo de estados y transiciones que contiene estado inicial, <em>choice</em>, <em>fork</em>, <em>join</em>, jerarquía de estados con en el estado <em>Tasks</em> y un estado final. Una selección completa del conjunto de tipos de estados. En este caso las flechas van únicamente en una dirección pero perfectamente el flujo podría tener transiciones que volviesen a estados anteriores creando ciclos.</p><div class=media style=text-align:center><figure><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/images/graph_hue3316206d4ba6e494d0821f7656ed998_24142_2560x1440_fit_box_2.png title="Grafo de la máquina de estados" data-gallery><img src=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/images/graph_hue3316206d4ba6e494d0821f7656ed998_24142_600x450_fit_box_2.png width=600></a><figcaption>Grafo de la máquina de estados</figcaption></figure></div><p>El uso de <em>Spring Statemachine</em> es relativamente sencillo. En el ejemplo se define en un enumerado la lista de estados, también la lista de eventos o transiciones. Una de las formas de definir el grafo dela máquina de estados es mediante código Java y utilizando Spring definiendo un <em>bean</em>. La clase <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/StateMachineBuilder.html>StateMachineBuilder</a> facilita la construcción de la definición de la máquina de estados, por una parte está la configuración general o de infraestructura con el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/StateMachineBuilder.Builder.html#configureConfiguration-->configureConfiguration()</a>. Con el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/StateMachineBuilder.Builder.html#configureStates-->configureStates()</a> se define los estados de la máquina y su tipo (inicial, final, normal, <em>choice</em>, <em>fork</em>, <em>join</em>,) así como las acciones que se deseen ejecutar al entrar, en el estado y al salir del estado con los métodos <em>stateEntry()</em>, <em>stateDo()</em> y <em>stateExit()</em>. Con el método <em>withStates()()</em> se pueden definir submáquinas o una jerarquía de estados como en el caso del estado <em>Tasks</em>. Finalmente hay que definir cuales son las posibles transiciones de los estados y que eventos las disparan. Normalmente las transiciones se definen con el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/builders/StateMachineTransitionConfigurer.html#withExternal-->withExternal()</a> pero en los casos de los estados de tipo <em>choice</em>, <em>fork</em> y <em>join</em> se define con los métodos <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/builders/StateMachineTransitionConfigurer.html#withChoice-->withChoice()</a>, <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/builders/StateMachineTransitionConfigurer.html#withFork-->withFork()</a> y <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/builders/StateMachineTransitionConfigurer.html#withJoin-->withJoin()</a>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=o>...</span>

<span class=nd>@SpringBootApplication</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=kd>implements</span> <span class=n>CommandLineRunner</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>enum</span> <span class=n>States</span> <span class=o>{</span>
        <span class=n>START</span><span class=o>,</span> <span class=n>STATE1</span><span class=o>,</span> <span class=n>CHOICE</span><span class=o>,</span> <span class=n>CHOICE1</span><span class=o>,</span> <span class=n>CHOICE2</span><span class=o>,</span> <span class=n>FORK</span><span class=o>,</span> <span class=n>TASKS</span><span class=o>,</span> <span class=n>TASK11</span><span class=o>,</span> <span class=n>TASK12</span><span class=o>,</span> <span class=n>TASK13</span><span class=o>,</span> <span class=n>TASK21</span><span class=o>,</span> <span class=n>TASK22</span><span class=o>,</span> <span class=n>TASK23</span><span class=o>,</span> <span class=n>JOIN</span><span class=o>,</span> <span class=n>STATE2</span><span class=o>,</span> <span class=n>END</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>enum</span> <span class=n>Events</span> <span class=o>{</span>
        <span class=n>START_STATE1</span><span class=o>,</span> <span class=n>STATE1_CHOICE</span><span class=o>,</span> <span class=n>CHOICE1_FORK</span><span class=o>,</span> <span class=n>CHOICE2_FORK</span><span class=o>,</span> <span class=n>TASK11_TASK12</span><span class=o>,</span> <span class=n>TASK12_TASK13</span><span class=o>,</span> <span class=n>TASK21_TASK22</span><span class=o>,</span> <span class=n>TASK22_TASK23</span><span class=o>,</span> <span class=n>STATE2_END</span>
    <span class=o>}</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>ApplicationContext</span> <span class=n>context</span><span class=o>;</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>States</span><span class=o>,</span> <span class=n>Events</span><span class=o>&gt;</span> <span class=n>machine1</span><span class=o>;</span>

    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>States</span><span class=o>,</span> <span class=n>Events</span><span class=o>&gt;</span> <span class=nf>buildMachine</span><span class=o>(</span><span class=n>DefaultAction</span> <span class=n>action</span><span class=o>,</span> <span class=n>DefaultErrorAction</span> <span class=n>errorAction</span><span class=o>,</span> <span class=n>DefaultStateMachineEventListener</span> <span class=n>listener</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>StateMachineBuilder</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>States</span><span class=o>,</span> <span class=n>Events</span><span class=o>&gt;</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>StateMachineBuilder</span><span class=o>.</span><span class=na>builder</span><span class=o>();</span>

        <span class=c1>// https://github.com/spring-projects/spring-statemachine/issues/354
</span><span class=c1></span>        <span class=n>ThreadPoolTaskScheduler</span> <span class=n>taskScheduler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ThreadPoolTaskScheduler</span><span class=o>();</span>
        <span class=n>taskScheduler</span><span class=o>.</span><span class=na>setDaemon</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
        <span class=n>taskScheduler</span><span class=o>.</span><span class=na>initialize</span><span class=o>();</span>

        <span class=n>builder</span><span class=o>.</span><span class=na>configureConfiguration</span><span class=o>().</span><span class=na>withConfiguration</span><span class=o>()</span>
                <span class=o>.</span><span class=na>taskScheduler</span><span class=o>(</span><span class=n>taskScheduler</span><span class=o>);</span>

        <span class=n>builder</span><span class=o>.</span><span class=na>configureStates</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withStates</span><span class=o>()</span>
                <span class=o>.</span><span class=na>initial</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>START</span><span class=o>)</span>
                <span class=o>.</span><span class=na>stateEntry</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE1</span><span class=o>,</span> <span class=n>action</span><span class=o>,</span> <span class=n>errorAction</span><span class=o>)</span>
                <span class=o>.</span><span class=na>stateDo</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE1</span><span class=o>,</span> <span class=n>action</span><span class=o>,</span> <span class=n>errorAction</span><span class=o>)</span>
                <span class=o>.</span><span class=na>stateExit</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE1</span><span class=o>,</span> <span class=n>action</span><span class=o>,</span> <span class=n>errorAction</span><span class=o>)</span>
                <span class=o>.</span><span class=na>choice</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE</span><span class=o>)</span>
                <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE1</span><span class=o>)</span>
                <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>fork</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASKS</span><span class=o>)</span>
                <span class=o>.</span><span class=na>join</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>JOIN</span><span class=o>)</span>
                <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>end</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>END</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
                <span class=o>.</span><span class=na>withStates</span><span class=o>()</span>
                    <span class=o>.</span><span class=na>parent</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASKS</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>initial</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK11</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK12</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>end</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK13</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
                <span class=o>.</span><span class=na>withStates</span><span class=o>()</span>
                    <span class=o>.</span><span class=na>parent</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASKS</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>initial</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK21</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK22</span><span class=o>)</span>
                    <span class=o>.</span><span class=na>end</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK23</span><span class=o>);</span>

        <span class=n>builder</span><span class=o>.</span><span class=na>configureTransitions</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>START</span><span class=o>).</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE1</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>START_STATE1</span><span class=o>)</span>
                <span class=o>.</span><span class=na>action</span><span class=o>(</span><span class=n>Actions</span><span class=o>.</span><span class=na>errorCallingAction</span><span class=o>(</span><span class=n>action</span><span class=o>,</span> <span class=n>errorAction</span><span class=o>))</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE1</span><span class=o>).</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>STATE1_CHOICE</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withChoice</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE</span><span class=o>)</span>
                <span class=o>.</span><span class=na>first</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE1</span><span class=o>,</span> <span class=k>new</span> <span class=n>RandomGuard</span><span class=o>())</span>
                <span class=o>.</span><span class=na>last</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE1</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>CHOICE1_FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>CHOICE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>CHOICE2_FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withFork</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>FORK</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASKS</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASKS</span><span class=o>)</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK11</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK12</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK11_TASK12</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK12</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK13</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK12_TASK13</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK21</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK22</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK21_TASK22</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK22</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK23</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK22_TASK23</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withJoin</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK13</span><span class=o>)</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>TASK23</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>JOIN</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>JOIN</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>withExternal</span><span class=o>()</span>
                <span class=o>.</span><span class=na>source</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>STATE2</span><span class=o>)</span>
                <span class=o>.</span><span class=na>target</span><span class=o>(</span><span class=n>States</span><span class=o>.</span><span class=na>END</span><span class=o>)</span>
                <span class=o>.</span><span class=na>event</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>STATE2_END</span><span class=o>);</span>

        <span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>States</span><span class=o>,</span> <span class=n>Events</span><span class=o>&gt;</span> <span class=n>stateMachine</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
        <span class=n>stateMachine</span><span class=o>.</span><span class=na>addStateListener</span><span class=o>(</span><span class=n>listener</span><span class=o>);</span>
        <span class=k>return</span> <span class=n>stateMachine</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=o>...</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>SpringApplication</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=n>Main</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-1.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-1.java target=_blank>Main-1.java</a></div></div><p>Las acciones asociadas a los estados del ejemplo simplemente emiten trazas pero tienen disponible el parámetro <em>context</em> para obtener datos e implementar su lógica, como es un componente de Spring podría incluso hacer uso de inyección de dependencias para utilizar otros servicios que necesitase.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.StateContext</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.action.Action</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.stereotype.Component</span><span class=o>;</span>

<span class=nd>@Component</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultAction</span> <span class=kd>implements</span> <span class=n>Action</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>DefaultAction</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>(</span><span class=n>StateContext</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Action Source: {}, State: {}, Target: {}, Event: {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>context</span><span class=o>.</span><span class=na>getSource</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>context</span><span class=o>.</span><span class=na>getSource</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=n>context</span><span class=o>.</span><span class=na>getStateMachine</span><span class=o>().</span><span class=na>getState</span><span class=o>().</span><span class=na>getId</span><span class=o>(),</span> <span class=o>(</span><span class=n>context</span><span class=o>.</span><span class=na>getTarget</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>context</span><span class=o>.</span><span class=na>getTarget</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=n>context</span><span class=o>.</span><span class=na>getEvent</span><span class=o>());</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultAction.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultAction.java target=_blank>DefaultAction.java</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.springframework.statemachine.StateContext</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.action.Action</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.stereotype.Component</span><span class=o>;</span>

<span class=nd>@Component</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultErrorAction</span> <span class=kd>implements</span> <span class=n>Action</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>(</span><span class=n>StateContext</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>context</span><span class=o>.</span><span class=na>getException</span><span class=o>().</span><span class=na>printStackTrace</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultErrorAction.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultErrorAction.java target=_blank>DefaultErrorAction.java</a></div></div><p>En el caso de un <em>choice</em> se utilizan los métodos <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/configurers/ChoiceTransitionConfigurer.html#first-S-org.springframework.statemachine.guard.Guard->first()</a>, <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/configurers/ChoiceTransitionConfigurer.html#then-S-org.springframework.statemachine.guard.Guard->then()</a> y <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/config/configurers/ChoiceTransitionConfigurer.html#last-S->last()</a> que una cláusula <em>guard</em> en los dos primeros determinan a que estado se transiciona. Una clásula <em>guard</em> es una instancia de la clase <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/guard/Guard.html>Guard</a> que contiene un método que devuelve un <em>boolean</em> según su lógica. Si es verdadero se seleciona el estado asociado, para la lógical se puede utilizar la información de contexto <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/StateContext.html>StateContext</a> entre otra información como la que se haya asociado en los diferentes estados con el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/StateContext.html#getExtendedState-->getExtendedState()</a> y la proporcionada en la ejecución del evento con <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/StateContext.html#getMessageHeaders-->getMessageHeaders()</a>.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.springframework.statemachine.StateContext</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.guard.Guard</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomGuard</span> <span class=kd>implements</span> <span class=n>Guard</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>evaluate</span><span class=o>(</span><span class=n>StateContext</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextBoolean</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/RandomGuard.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/RandomGuard.java target=_blank>RandomGuard.java</a></div></div><p>En este ejemplo se utiliza <a href=https://projects.spring.io/spring-boot/>Spring Boot</a>, aparte de las configuraciones anteriores se realizan dos cosas adicionales. Una de ellas es utilizar un <a href=https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskScheduler.html>ThreadPoolTaskScheduler</a> en modo demonio de modo que la máquina virtual y el programa pueda finalizar correctamente. La otra es que con una implementación de la clase <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/listener/StateMachineListenerAdapter.html>StateMachineListenerAdapter</a> se pueden recibir que acciones realiza la máquina de estados, en este caso para emitir trazas.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>org.slf4j.Logger</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.slf4j.LoggerFactory</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.messaging.Message</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.StateContext</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.StateMachine</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.listener.StateMachineListenerAdapter</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.state.State</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.statemachine.transition.Transition</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.stereotype.Component</span><span class=o>;</span>

<span class=nd>@Component</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultStateMachineEventListener</span> <span class=kd>extends</span> <span class=n>StateMachineListenerAdapter</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=o>{</span>
    
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>DefaultStateMachineEventListener</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
    
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateChanged</span><span class=o>(</span><span class=n>State</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>from</span><span class=o>,</span> <span class=n>State</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>to</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateChanged from {} to {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>from</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>from</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=o>(</span><span class=n>to</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>to</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateEntered</span><span class=o>(</span><span class=n>State</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>state</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateEntered in {}&#34;</span><span class=o>,</span> <span class=n>state</span><span class=o>.</span><span class=na>getId</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateExited</span><span class=o>(</span><span class=n>State</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>state</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateExited in {}&#34;</span><span class=o>,</span> <span class=n>state</span><span class=o>.</span><span class=na>getId</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>transition</span><span class=o>(</span><span class=n>Transition</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>transition</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener transition from {} to {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span><span class=kc>null</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>transitionStarted</span><span class=o>(</span><span class=n>Transition</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>transition</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener transitionStarted from {} to {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>transitionEnded</span><span class=o>(</span><span class=n>Transition</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>transition</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener transitionEnded from {} to {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getSource</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=o>(</span><span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>transition</span><span class=o>.</span><span class=na>getTarget</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateMachineStarted</span><span class=o>(</span><span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>stateMachine</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateMachineStarted&#34;</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateMachineStopped</span><span class=o>(</span><span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>stateMachine</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateMachineStopped&#34;</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>eventNotAccepted</span><span class=o>(</span><span class=n>Message</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener eventNotAccepted {}&#34;</span><span class=o>,</span> <span class=n>event</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>extendedStateChanged</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>,</span> <span class=n>Object</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener extendedStateChanged {} to {}&#34;</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateMachineError</span><span class=o>(</span><span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>stateMachine</span><span class=o>,</span> <span class=n>Exception</span> <span class=n>exception</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateMachineError {}&#34;</span><span class=o>,</span> <span class=n>exception</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateContext</span><span class=o>(</span><span class=n>StateContext</span><span class=o>&lt;</span><span class=n>Main</span><span class=o>.</span><span class=na>States</span><span class=o>,</span> <span class=n>Main</span><span class=o>.</span><span class=na>Events</span><span class=o>&gt;</span> <span class=n>stateContext</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Listener stateContext (Message Payload: {}, Message Headers: {}, Variables: {}&#34;</span><span class=o>,</span> <span class=o>(</span><span class=n>stateContext</span><span class=o>.</span><span class=na>getMessage</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>stateContext</span><span class=o>.</span><span class=na>getMessage</span><span class=o>().</span><span class=na>getPayload</span><span class=o>()</span> <span class=o>:</span> <span class=kc>null</span><span class=o>,</span> <span class=n>stateContext</span><span class=o>.</span><span class=na>getMessageHeaders</span><span class=o>(),</span> <span class=n>stateContext</span><span class=o>.</span><span class=na>getExtendedState</span><span class=o>().</span><span class=na>getVariables</span><span class=o>());</span>
    <span class=o>}</span>    
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultStateMachineEventListener.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/DefaultStateMachineEventListener.java target=_blank>DefaultStateMachineEventListener.java</a></div></div><p>Una vez definida la máquina de estados su uso comienza con el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/region/Region.html#start-->start()</a>, a continuación ya se pueden enviar eventos par provocar cambios de estado y ejecución de acciones. Se puede proporcionar información de contexto para la máquina accesible desde cualquier estado en el mapa obtenido con <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/ExtendedState.html#getVariables-->ExtendedState.getVariables()</a> y al provocar eventos con la clase <a href=https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/support/GenericMessage.html>GenericMessage</a>. En cualquier momento el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/support/AbstractStateMachine.html#getState-->getState()</a> devuelve en que estado se encuentra la máquina. Según la rama que haya elegido la clase <em>RandomGuard</em> en la bifurcación y el estado en el que esté la máquina se envía la transición <em>CHOICE1_FORK</em> o <em>CHOICE2_FORK</em>. El <em>fork</em> provoca que la máquina de estados ejecute en paralelo dos caminos, enviados los eventos correctos se llega a los estados finales de las dos ramas del subestado y se pasa automáticamente al estado <em>JOIN</em> que a su vez pasa automáticamente a <em>STATE2</em>, finalmente se pasa al estado <em>END</em> y termina la máquina de estados.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=o>...</span>

<span class=nd>@SpringBootApplication</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=kd>implements</span> <span class=n>CommandLineRunner</span> <span class=o>{</span>

    <span class=o>...</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>(</span><span class=n>String</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>Random</span> <span class=n>random</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>

        <span class=n>machine1</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>getExtendedState</span><span class=o>().</span><span class=na>getVariables</span><span class=o>().</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;variable&#34;</span><span class=o>,</span> <span class=n>42</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=k>new</span> <span class=n>GenericMessage</span><span class=o>&lt;&gt;(</span><span class=n>Events</span><span class=o>.</span><span class=na>START_STATE1</span><span class=o>,</span> <span class=n>Collections</span><span class=o>.</span><span class=na>singletonMap</span><span class=o>(</span><span class=s>&#34;key&#34;</span><span class=o>,</span> <span class=n>31</span><span class=o>)));</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>STATE1_CHOICE</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>((</span><span class=n>machine1</span><span class=o>.</span><span class=na>getState</span><span class=o>().</span><span class=na>getId</span><span class=o>()</span> <span class=o>==</span> <span class=n>States</span><span class=o>.</span><span class=na>CHOICE1</span><span class=o>)</span> <span class=o>?</span> <span class=n>Events</span><span class=o>.</span><span class=na>CHOICE1_FORK</span> <span class=o>:</span> <span class=n>Events</span><span class=o>.</span><span class=na>CHOICE2_FORK</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK11_TASK12</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK21_TASK22</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK12_TASK13</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK22_TASK23</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>STATE2_END</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>stop</span><span class=o>();</span>

        <span class=o>...</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>SpringApplication</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=n>Main</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-2.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-2.java target=_blank>Main-2.java</a></div></div><p>Otro caso de uso posible es en vez de iniciar la máquina de estados desde el inicio es iniciarla en un determinado estado para continuar con el flujo de una entidad que anteriormente se quedó en ese estado. En el caso del ejemplo la máquina de estados se continua desde el estado <em>TASK11</em> y <em>TASK22</em> utilizando el método <a href=https://docs.spring.io/spring-statemachine/docs/current/api/org/springframework/statemachine/support/AbstractStateMachine.html#resetStateMachine-org.springframework.statemachine.StateMachineContext->resetStateMachine()</a>, se vuelve a iniciar la máquina y se envían los eventos adecuados a partir de esos estados.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Java data-lang=Java><span class=kn>package</span> <span class=nn>io.github.picodotdev.blogbitix.springstatemachine</span><span class=o>;</span>

<span class=o>...</span>

<span class=nd>@SpringBootApplication</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=kd>implements</span> <span class=n>CommandLineRunner</span> <span class=o>{</span>

    <span class=o>...</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>(</span><span class=n>String</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=o>...</span>

        <span class=n>machine1</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK11_TASK12</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK22_TASK23</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>TASK12_TASK13</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>sendEvent</span><span class=o>(</span><span class=n>Events</span><span class=o>.</span><span class=na>STATE2_END</span><span class=o>);</span>
        <span class=n>machine1</span><span class=o>.</span><span class=na>stop</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>SpringApplication</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=n>Main</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-3.java target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/Main-3.java target=_blank>Main-3.java</a></div></div><p>Por defecto el contenedor de dependencias de Spring utiliza el <a href=https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/config/Scope.html>@Scope</a> <em>singleton</em> para los <em>beans</em> de modo que solo existe una única instancia, como las máquinas tiene estado no pueden compartirse, hay que crear una nueva en caso de querer utilizar dos simultáneamente como sería el caso de una aplicación web o un proceso que escucha mensajes de una cola, utilizando el <em>scope prototype</em> se crea una instancia cada vez que se necesite. La creación de más máquina de estado se indica en la documentación que es algo costoso para no tener que crearlas, tener varias instancias y limitado a cierto número se puede utilizar un <a href=https://docs.spring.io/spring-statemachine/docs/2.1.1.RELEASE/reference/htmlsingle/#statemachine-examples-eventservice><em>pool</em> de máquinas de estado</a>.</p><p>En un cambio de estado se produce la siguiente secuencia de eventos y acciones.</p><ul><li>Se notifica del inicio de la transición.</li><li>Se ejecuta la acción asociada a la transición.</li><li>Se notifica de la transición, de la salida del estado anterior y de la entrada en el nuevo.</li><li>Se ejecuta la acción de entrada al estado y del estado.</li><li>Se notifica del cambio de estado.</li><li>Se notifica de la finalización de la transición.</li></ul><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>... : Listener transitionStarted from START to STATE1
... : Action Source: START, State: START, Target: STATE1, Event: START_STATE1
... : Listener transition from START to STATE1
... : Listener stateExited in START
... : Listener stateEntered in STATE1
... : Action Source: START, State: STATE1, Target: STATE1, Event: START_STATE1
... : Action Source: START, State: STATE1, Target: STATE1, Event: START_STATE1
... : Listener stateChanged from START to STATE1
... : Listener transitionEnded from START to STATE1</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-3 target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-3 target=_blank>System.out-3</a></div></div><p>Estas son las dependencias necesarias a añadir n la herramienta de construcción y la salida en la terminal de las trazas ejecutando la máquina de estados desde el estado inicial e inicializada desde un estado en concreto.</p><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Groovy data-lang=Groovy><span class=n>plugins</span> <span class=o>{</span>
    <span class=n>id</span> <span class=s1>&#39;java&#39;</span>
    <span class=n>id</span> <span class=s1>&#39;application&#39;</span>
<span class=o>}</span>

<span class=n>mainClassName</span> <span class=o>=</span> <span class=s1>&#39;io.github.picodotdev.blogbitix.springstatemachine.Main&#39;</span>

<span class=n>ext</span> <span class=o>{</span>
    <span class=n>versions</span> <span class=o>=</span> <span class=o>[</span>
        <span class=nl>springBoot:</span> <span class=s1>&#39;2.1.3.RELEASE&#39;</span><span class=o>,</span>
    <span class=o>]</span>
<span class=o>}</span>

<span class=n>repositories</span> <span class=o>{</span>
    <span class=n>jcenter</span><span class=o>()</span>
<span class=o>}</span>

<span class=n>dependencies</span> <span class=o>{</span>
    <span class=n>implementation</span> <span class=nf>platform</span><span class=o>(</span><span class=s2>&#34;org.springframework.boot:spring-boot-dependencies:$versions.springBoot&#34;</span><span class=o>)</span>

    <span class=n>compile</span><span class=o>(</span><span class=s2>&#34;org.springframework.boot:spring-boot-starter&#34;</span><span class=o>)</span>
    <span class=n>compile</span><span class=o>(</span><span class=s2>&#34;org.springframework.boot:spring-boot-autoconfigure&#34;</span><span class=o>)</span>

    <span class=n>compile</span><span class=o>(</span><span class=s2>&#34;org.springframework.statemachine:spring-statemachine-core:2.1.1.RELEASE&#34;</span><span class=o>)</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/build.gradle target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/build.gradle target=_blank>build.gradle</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.1.3.RELEASE)
...
... : Starting Main on archlinux with PID 32679 (/home/picodotdev/Software/personal/blog-ejemplos/SpringStatemachine/build/classes/java/main started by picodotdev in /home/picodotdev/Software/personal/blog-ejemplos/SpringStatemachine)
... : No active profile set, falling back to default profiles: default
... : Initializing ExecutorService
... : Started Main in 0.719 seconds (JVM running for 0.948)
... : Listener transitionStarted from null to START
... : Listener stateContext (Message Payload: null, Message Headers: {id=8b954f2b-aeef-48dd-a4ca-e799c188d476, timestamp=1554007267639}, Variables: {}
... : Listener transition from null to START
... : Listener stateContext (Message Payload: null, Message Headers: {id=e1bf1cb1-c597-4975-6874-580b8d7c6a0a, timestamp=1554007267640}, Variables: {}
... : Listener stateEntered in START
... : Listener stateContext (Message Payload: null, Message Headers: {id=e938b91d-bada-c56b-d845-5f3958bba4f8, timestamp=1554007267641}, Variables: {}
... : Listener stateChanged from null to START
... : Listener stateContext (Message Payload: null, Message Headers: {id=b58324de-f43d-417b-cc38-86efdea7274f, timestamp=1554007267641}, Variables: {}
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=747d233f-0d46-0bd0-78be-6cf026739dd8, timestamp=1554007267642}, Variables: {}
... : Listener transitionEnded from null to START
... : Listener stateContext (Message Payload: null, Message Headers: {id=1fe8b3a2-e176-4791-dcab-d8759b2e4dc6, timestamp=1554007267642}, Variables: {}
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@51e37590
... : started STATE1 TASKS TASK13 TASK11 TASK12 TASK21 TASK23 TASK22 CHOICE1 CHOICE2 START STATE2 END JOIN FORK CHOICE  / START / uuid=a2882db4-b636-4fac-93d0-87c50434401e / id=null
... : Listener extendedStateChanged variable to 42
... : Listener stateContext (Message Payload: null, Message Headers: {id=afa8655f-09a8-a551-c11e-36a36cd2c92a, timestamp=1554007267643}, Variables: {variable=42}
... : Listener transitionStarted from START to STATE1
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Action Source: START, State: START, Target: STATE1, Event: START_STATE1
... : Listener transition from START to STATE1
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Listener stateExited in START
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Listener stateEntered in STATE1
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Action Source: START, State: STATE1, Target: STATE1, Event: START_STATE1
... : Action Source: START, State: STATE1, Target: STATE1, Event: START_STATE1
... : Listener stateChanged from START to STATE1
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Listener transitionEnded from START to STATE1
... : Listener stateContext (Message Payload: START_STATE1, Message Headers: {key=31, id=bf50ec37-b6f7-32d5-fd59-292d7f1ea265, timestamp=1554007267643}, Variables: {variable=42}
... : Listener transitionStarted from STATE1 to CHOICE
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Listener transition from STATE1 to CHOICE
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Action Source: STATE1, State: STATE1, Target: CHOICE, Event: STATE1_CHOICE
... : Listener stateExited in STATE1
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Listener stateEntered in CHOICE1
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Listener stateChanged from STATE1 to CHOICE1
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Listener transitionEnded from STATE1 to CHOICE
... : Listener stateContext (Message Payload: STATE1_CHOICE, Message Headers: {id=8c969225-fec1-6603-63dd-7ae00f8ead10, timestamp=1554007267650}, Variables: {variable=42}
... : Listener transitionStarted from CHOICE1 to FORK
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener transition from CHOICE1 to FORK
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener stateExited in CHOICE1
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener stateEntered in TASKS
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener transitionStarted from null to TASK11
... : Listener stateContext (Message Payload: null, Message Headers: {id=37715a25-6933-14b8-2e25-756a447a3630, timestamp=1554007267652}, Variables: {variable=42}
... : Listener transition from null to TASK11
... : Listener stateContext (Message Payload: null, Message Headers: {id=62093291-042b-cd75-1405-4a96be2b5682, timestamp=1554007267652}, Variables: {variable=42}
... : Listener stateEntered in TASK11
... : Listener stateContext (Message Payload: null, Message Headers: {id=a7c34605-3515-c56f-ff7a-8977d2331fd9, timestamp=1554007267652}, Variables: {variable=42}
... : Listener stateChanged from null to TASK11
... : Listener stateContext (Message Payload: null, Message Headers: {id=7b000dca-0fb2-f95a-a6db-aaf6600e1f5f, timestamp=1554007267653}, Variables: {variable=42}
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=908bcc73-0466-dec2-14b6-2822ad56c7ba, timestamp=1554007267653}, Variables: {variable=42}
... : Listener transitionEnded from null to TASK11
... : Listener stateContext (Message Payload: null, Message Headers: {id=e262f0fe-6047-9638-b592-c6e4bbc4e2ef, timestamp=1554007267653}, Variables: {variable=42}
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@5a865416
... : started TASK13 TASK11 TASK12  / TASK11 / uuid=b703837b-1a49-4dc4-83aa-5420f6cf0517 / id=null#8dd81b65-183c-43d0-8d27-c5ff71d2968a
... : Listener transitionStarted from null to TASK21
... : Listener stateContext (Message Payload: null, Message Headers: {id=fe645a0b-2b28-8734-e09a-271a7df04d17, timestamp=1554007267653}, Variables: {variable=42}
... : Listener transition from null to TASK21
... : Listener stateContext (Message Payload: null, Message Headers: {id=ab063429-8d97-27ce-c25b-3d8488bbc03f, timestamp=1554007267653}, Variables: {variable=42}
... : Listener stateEntered in TASK21
... : Listener stateContext (Message Payload: null, Message Headers: {id=309a6395-2545-89c6-833f-ba49a7893e2f, timestamp=1554007267654}, Variables: {variable=42}
... : Listener stateChanged from null to TASK21
... : Listener stateContext (Message Payload: null, Message Headers: {id=014531de-2bb4-efc8-1b8c-1bfcaf6f445c, timestamp=1554007267654}, Variables: {variable=42}
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=1375e1a3-b78f-7efb-84ed-3536e7198715, timestamp=1554007267654}, Variables: {variable=42}
... : Listener transitionEnded from null to TASK21
... : Listener stateContext (Message Payload: null, Message Headers: {id=4fe6a6a2-f279-33fb-58fa-14731e111b70, timestamp=1554007267654}, Variables: {variable=42}
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@6dc1484
... : started TASK21 TASK23 TASK22  / TASK21 / uuid=74691d25-219e-4dca-83ff-2e80ffc74f93 / id=null#5260c53d-1cbb-47a6-984a-8ef1ceb3ab31
... : Listener stateChanged from CHOICE1 to TASKS
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener transitionEnded from CHOICE1 to FORK
... : Listener stateContext (Message Payload: CHOICE1_FORK, Message Headers: {id=1f2f3a68-19e1-29d4-8677-2c63c5e360a3, timestamp=1554007267651}, Variables: {variable=42}
... : Listener transitionStarted from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener transition from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener stateExited in TASK11
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener stateEntered in TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener stateChanged from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener transitionEnded from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK11_TASK12, headers={id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}]
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=a5f14519-e027-16b9-e718-7884633feb01, timestamp=1554007267655}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK21_TASK22, headers={id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}]
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK21_TASK22, headers={id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}]
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener transitionStarted from TASK21 to TASK22
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener transition from TASK21 to TASK22
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener stateExited in TASK21
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener stateEntered in TASK22
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener stateChanged from TASK21 to TASK22
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener transitionEnded from TASK21 to TASK22
... : Listener stateContext (Message Payload: TASK21_TASK22, Message Headers: {id=2f048198-ef29-0b11-53d9-c22202b3a023, timestamp=1554007267656}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK12_TASK13, headers={id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}]
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK12_TASK13, headers={id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}]
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener transitionStarted from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener transition from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener stateExited in TASK12
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener stateEntered in TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener stateChanged from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@5a865416
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=887ca4d7-226b-9f99-3955-dce7151dcbae, timestamp=1554007267659}, Variables: {variable=42}
... : stopped TASK13 TASK11 TASK12  /  / uuid=b703837b-1a49-4dc4-83aa-5420f6cf0517 / id=null#8dd81b65-183c-43d0-8d27-c5ff71d2968a
... : Listener transitionEnded from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=1fd4d183-88d0-f30e-34a8-530c23e66b23, timestamp=1554007267657}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK22_TASK23, headers={id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}]
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener eventNotAccepted GenericMessage [payload=TASK22_TASK23, headers={id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}]
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionStarted from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transition from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener stateExited in TASK22
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener stateEntered in TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionStarted from TASK13 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transition from TASK13 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener stateExited in TASK13
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionEnded from TASK13 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionStarted from TASK23 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transition from TASK23 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener stateExited in TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionEnded from TASK23 to JOIN
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@6dc1484
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=b65b9ec8-ef97-dba7-aa77-44b8b5588ff9, timestamp=1554007267662}, Variables: {variable=42}
... : stopped TASK21 TASK23 TASK22  /  / uuid=74691d25-219e-4dca-83ff-2e80ffc74f93 / id=null#5260c53d-1cbb-47a6-984a-8ef1ceb3ab31
... : Listener stateExited in TASKS
... : Listener stateContext (Message Payload: null, Message Headers: {id=2664aa9e-1ec2-593f-3016-81231e9551a2, timestamp=1554007267662}, Variables: {variable=42}
... : Listener stateEntered in STATE2
... : Listener stateContext (Message Payload: null, Message Headers: {id=8510c1b9-6b2f-46ae-9412-9542b0098fec, timestamp=1554007267662}, Variables: {variable=42}
... : Listener stateChanged from TASKS to STATE2
... : Listener stateContext (Message Payload: null, Message Headers: {id=8d650465-62b7-f71a-070e-9b1dadf29861, timestamp=1554007267662}, Variables: {variable=42}
... : Listener stateChanged from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionEnded from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=592d65e8-6ccc-b942-0d10-d5b9b645c558, timestamp=1554007267659}, Variables: {variable=42}
... : Listener transitionStarted from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
... : Listener transition from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
... : Listener stateExited in STATE2
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
... : Listener stateEntered in END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
... : Listener stateChanged from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@51e37590
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=cf95710c-ecb5-3df6-61e3-11799f0925d7, timestamp=1554007267664}, Variables: {variable=42}
... : stopped STATE1 TASKS TASK13 TASK11 TASK12 TASK21 TASK23 TASK22 CHOICE1 CHOICE2 START STATE2 END JOIN FORK CHOICE  /  / uuid=a2882db4-b636-4fac-93d0-87c50434401e / id=null
... : Listener transitionEnded from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=f84d435c-bc74-e23d-f0b5-3191241118ef, timestamp=1554007267663}, Variables: {variable=42}
...</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-1 target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-1 target=_blank>System.out-1</a></div></div><div class=code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Plaintext data-lang=Plaintext>... : started ObjectState [getIds()=[TASK11], getClass()=class org.springframework.statemachine.state.ObjectState, hashCode()=1584833211, toString()=AbstractState [id=TASK11, pseudoState=org.springframework.statemachine.state.DefaultPseudoState@757194dc, deferred=[], entryActions=[], exitActions=[], stateActions=[], regions=[], submachine=null]]
... : started ObjectState [getIds()=[TASK22], getClass()=class org.springframework.statemachine.state.ObjectState, hashCode()=800456240, toString()=AbstractState [id=TASK22, pseudoState=null, deferred=[], entryActions=[], exitActions=[], stateActions=[], regions=[], submachine=null]]
... : started RegionState [getIds()=[TASKS, TASK11, TASK22], getClass()=class org.springframework.statemachine.state.RegionState, hashCode()=1311544814, toString()=AbstractState [id=TASKS, pseudoState=org.springframework.statemachine.state.DefaultPseudoState@d0ec63, deferred=[], entryActions=[], exitActions=[], stateActions=[], regions=[TASK13 TASK11 TASK12  / TASK11 / uuid=b703837b-1a49-4dc4-83aa-5420f6cf0517 / id=null, TASK21 TASK23 TASK22  / TASK22 / uuid=74691d25-219e-4dca-83ff-2e80ffc74f93 / id=null], submachine=null]]
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@51e37590
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=a6be7fdd-8685-5b21-1f34-9dcf718ec374, timestamp=1554007267665}, Variables: {}
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@5a865416
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=3eef6870-ee58-fa1d-8798-71987d336914, timestamp=1554007267665}, Variables: {}
... : started TASK13 TASK11 TASK12  / TASK11 / uuid=b703837b-1a49-4dc4-83aa-5420f6cf0517 / id=null
... : started org.springframework.statemachine.support.DefaultStateMachineExecutor@6dc1484
... : Listener stateMachineStarted
... : Listener stateContext (Message Payload: null, Message Headers: {id=aef5d00b-59ea-8eed-81ff-c840b1ce2b94, timestamp=1554007267666}, Variables: {}
... : started TASK21 TASK23 TASK22  / TASK22 / uuid=74691d25-219e-4dca-83ff-2e80ffc74f93 / id=null
... : started STATE1 TASKS TASK13 TASK11 TASK12 TASK21 TASK23 TASK22 CHOICE1 CHOICE2 START STATE2 END JOIN FORK CHOICE  / TASKS,TASK11,TASK22 / uuid=a2882db4-b636-4fac-93d0-87c50434401e / id=null
... : Listener transitionStarted from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener transition from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener stateExited in TASK11
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener stateEntered in TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener stateChanged from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener transitionEnded from TASK11 to TASK12
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener eventNotAccepted GenericMessage [payload=TASK11_TASK12, headers={id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}]
... : Listener stateContext (Message Payload: TASK11_TASK12, Message Headers: {id=dd47c963-48b4-a47b-093a-bd52cc4371f8, timestamp=1554007267666}, Variables: {}
... : Listener eventNotAccepted GenericMessage [payload=TASK22_TASK23, headers={id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}]
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener eventNotAccepted GenericMessage [payload=TASK22_TASK23, headers={id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}]
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener transitionStarted from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener transition from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener stateExited in TASK22
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener stateEntered in TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener stateChanged from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@6dc1484
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=ff2f4d56-fde7-2ab0-c412-e5307b52cfc1, timestamp=1554007267668}, Variables: {}
... : stopped TASK21 TASK23 TASK22  /  / uuid=74691d25-219e-4dca-83ff-2e80ffc74f93 / id=null
... : Listener transitionEnded from TASK22 to TASK23
... : Listener stateContext (Message Payload: TASK22_TASK23, Message Headers: {id=285c9e5d-930d-c150-0ef0-2de6cec651ab, timestamp=1554007267667}, Variables: {}
... : Listener eventNotAccepted GenericMessage [payload=TASK12_TASK13, headers={id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}]
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener eventNotAccepted GenericMessage [payload=TASK12_TASK13, headers={id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}]
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener transitionStarted from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener transition from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener stateExited in TASK12
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener stateEntered in TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@5a865416
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=ee20242f-e669-8719-8cef-869d2c7bbb13, timestamp=1554007267669}, Variables: {}
... : stopped TASK13 TASK11 TASK12  /  / uuid=b703837b-1a49-4dc4-83aa-5420f6cf0517 / id=null
... : Listener stateExited in TASKS
... : Listener stateContext (Message Payload: null, Message Headers: {id=9835d889-b3e4-b056-2e8d-1dfc3850907e, timestamp=1554007267670}, Variables: {}
... : Listener stateEntered in STATE2
... : Listener stateContext (Message Payload: null, Message Headers: {id=e9f3c6bb-b384-455e-354c-7cc6d8b2f6a1, timestamp=1554007267670}, Variables: {}
... : Listener stateChanged from TASKS to STATE2
... : Listener stateContext (Message Payload: null, Message Headers: {id=6c0826b9-8ec5-84a8-f6d4-53b1c3311334, timestamp=1554007267670}, Variables: {}
... : Listener stateChanged from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener transitionEnded from TASK12 to TASK13
... : Listener stateContext (Message Payload: TASK12_TASK13, Message Headers: {id=5ff52736-4f77-7bf1-e0ad-9e9cef73e1aa, timestamp=1554007267668}, Variables: {}
... : Listener transitionStarted from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : Listener transition from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : Listener stateExited in STATE2
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : Listener stateEntered in END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : Listener stateChanged from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : stopped org.springframework.statemachine.support.DefaultStateMachineExecutor@51e37590
... : Listener stateMachineStopped
... : Listener stateContext (Message Payload: null, Message Headers: {id=3825827b-07cb-6df6-f6bb-ebb391030e1e, timestamp=1554007267671}, Variables: {}
... : stopped STATE1 TASKS TASK13 TASK11 TASK12 TASK21 TASK23 TASK22 CHOICE1 CHOICE2 START STATE2 END JOIN FORK CHOICE  /  / uuid=a2882db4-b636-4fac-93d0-87c50434401e / id=null
... : Listener transitionEnded from STATE2 to END
... : Listener stateContext (Message Payload: STATE2_END, Message Headers: {id=6be8a081-daec-2aca-268b-3f0af8940247, timestamp=1554007267670}, Variables: {}
... : destroy called</code></pre></td></tr></table></div></div><div class=highlight-meta><span class=raw><a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-2 target=_blank>view raw</a></span>
<a href=/blog-bitix/2019/03/ejemplo-de-maquina-de-estados-con-spring-statemachine/code/System.out-2 target=_blank>System.out-2</a></div></div><p>El <a href=https://github.com/picodotdev/blog-ejemplos/tree/master/SpringStatemachine>código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en <a href=https://github.com/>GitHub</a> y probarlo en tu equipo ejecutando el comando <code>./gradle run</code>.</p><div class=reference>Referencia:<br><ul><li><a href=https://docs.spring.io/spring-statemachine/docs/current/api/>Spring Statemachine Javadoc</a></li><li><a href=https://www.baeldung.com/spring-state-machine>A Guide to the Spring State Machine Project</a></li><li><a href=https://codeburst.io/spring-state-machine-what-is-it-and-do-you-need-it-e894c78f5d84>Spring State Machine: what is it and do you need it?</a></li></ul></div></div></article><div class="row related"><div class=col-md-12>Artículos relacionados:<ul><li><a href=/blog-bitix/2019/02/servidor-oauth-gateway-y-servicio-rest-utilizando-tokens-jwt-con-spring/>Servidor OAuth, gateway y servicio REST utilizando tokens JWT con Spring</a></li><li><a href=/blog-bitix/2018/12/exponer-las-metricas-de-hystrix-en-grafana-con-prometheus-de-una-aplicacion-spring-boot/>Exponer las métricas de Hystrix en Grafana con Prometheus de una aplicación Spring Boot</a></li><li><a href=/blog-bitix/2018/12/monitorizar-una-aplicacion-java-de-spring-boot-con-micrometer-prometheus-y-grafana/>Monitorizar una aplicación Java de Spring Boot con Micrometer, Prometheus y Grafana</a></li><li><a href=/blog-bitix/2018/10/proxy-para-microservicios-con-spring-cloud-netflix-y-zuul/>Proxy para microservicios con Spring Cloud Netflix y Zuul</a></li><li><a href=/blog-bitix/2018/10/balanceo-de-carga-y-resilencia-en-un-microservicio-con-spring-cloud-netflix-y-ribbon/>Balanceo de carga y resilencia en un microservicio con Spring Cloud Netflix y Ribbon</a></li></ul></div></div><div class=row><div class=col-md-12><div class=sharethis-inline-share-buttons></div></div></div><div class=row><div class=col-12><ins class=adsbygoogle style=display:inline-block;width:970px;height:250px data-ad-client=ca-pub-3533636310991304 data-ad-slot=2975854584 data-type=billboard></ins></div></div><a id=comments></a><div class=row><div class=col-md-12><div id=disqus_thread></div></div></div><script type=text/javascript async>var disqus_shortname='blog-bitix';var disqus_identifier='https:\/\/picodotdev.github.io\/blog-bitix\/2019\/03\/ejemplo-de-maquina-de-estados-con-spring-statemachine\/';var disqus_url='https:\/\/picodotdev.github.io\/blog-bitix\/2019\/03\/ejemplo-de-maquina-de-estados-con-spring-statemachine\/';var disqus_script='embed.js';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script></div></div><div class=row><div class=col-12><hr></div></div><footer><div class=row><div class="col-12 col-sm-4"><p><strong>Blog Bitix</strong></p><p>Blog dedicado a la distribución GNU/Linux que uso habitualmente, Arch Linux, a mis andanzas alrededor del software libre, la programación y a otros temas relacionados con la tecnología y la informática.</p><p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p></div><div class="col-12 col-sm-4 text-center menu"><ul class=list-unstyled><li><a href=/blog-bitix/tags/java/>Java</a></li><li><a href=/blog-bitix/tags/gnu-linux/>GNU/Linux</a></li><li><a href=/blog-bitix/tags/javascript/>JavaScript</a></li><li><a href=/blog-bitix/tags/tapestry/>Tapestry</a></li><li><a href=/blog-bitix/archive/>Archivo y hemeroteca</a></li><li><a href=/blog-bitix/pages/links/>Enlaces</a></li><li><a href=/blog-bitix/pages/advertising/>Publicidad</a></li><li><a href=/blog-bitix/pages/donate/>Donaciones</a></li><li><a href=/blog-bitix/pages/about/>Acerca de...</a></li></ul></div><div class="col-12 col-sm-4 text-center links"><a href=index.xml title="¡Suscríbete a Blog Bitix!"><img src=assets/images/rss.png class=icon></a>
<a href=https://twitter.com/picodotdev/ title="¡Sígueme en twitter!"><img src=assets/images/twitter.svg class=icon></a>
<a href=https://github.com/picodotdev/blog-ejemplos/ title="¡Obtén el código fuente de los ejemplos!"><img src=assets/images/github.svg class=icon></a></div></div><div class=row><div class=col-12>Copyleft <span class=copyleft>&copy;</span> 2019 - <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=nofollow rel=license><img alt="Licencia de Creative Commons" title="Licencia de Creative Commons" style=border-width:0 src=https://licensebuttons.net/l/by-sa/4.0/80x15.png class=licencia></a><br><a href=https://twitter.com/blogstackinfo rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/blog-stack.png alt="Blog Stack" title="Blog Stack"></a>
<a href=https://www.planetacodigo.com/ rel=nofollow><img src=https://picodotdev.github.io/blog-bitix/assets/images/planeta-codigo.png alt="Planeta código" title="Planeta código"></a><br><span xmlns:dct=http://purl.org/dc/terms/ property=dct:title><a href=https://picodotdev.github.io/blog-bitix/ rel=nofollow>Blog Bitix</a></span> by <a xmlns:cc=https://creativecommons.org/ns# href=https://picodotdev.github.io/blog-bitix/ property=cc:attributionName rel=cc:attributionurl>pico.dev</a> is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.<br><span class=credit>Powered by <a href=https://gohugo.io/ rel=nofollow title="A fast and modern static website engine">Hugo</a> and <a href=https://pages.github.com/ title="Websites for you and your projects">GitHub Pages</a>.</span>
<span class=credit>Background patterns from <a href=https://www.toptal.com/designers/subtlepatterns/ rel=nofollow>Subtle Patterns</a>.</span></div></div></footer></div><div class=blueimp-gallery-container><div id=blueimp-gallery class="blueimp-gallery blueimp-gallery-controls" data-use-bootstrap-modal=false><div class=slides></div><h3 class=title></h3><a class=prev>‹</a>
<a class=next>›</a>
<a class=close>×</a>
<a class=play-pause></a><ol class=indicator></ol><div class="modal fade"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close aria-hidden=true>&times;</button><h4 class=modal-title></h4></div><div class="modal-body next"></div><div class=modal-footer><button type=button class="btn btn-default pull-left prev">
<i class="glyphicon glyphicon-chevron-left"></i>Anterior</button>
<button type=button class="btn btn-primary next">
Siguiente
<i class="glyphicon glyphicon-chevron-right"></i></button></div></div></div></div></div></div><script type=text/javascript>window.cookieconsent_options={"message":"Esta bitácora te informa de la obviedad de que utiliza «cookies», propias y de servicios como Google Analytics y Google AdSense entre otros.","dismiss":"Aceptar","learnMore":"Más información","link":null,"theme":"dark-bottom"};</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js async></script></body></html>